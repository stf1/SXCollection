#define SX_INIT_VARIABLES
  {VARIABLE item[0].x 999}
  {VARIABLE item[0].y 999}
  {VARIABLE item[0].type "NOTHING"}
  {VARIABLE item[0].image ""}
  {VARIABLE item[0].halo ""}
  {VARIABLE item[0].used 0}
  {VARIABLE itemx 999}
  {VARIABLE itemy 999}
  {VARIABLE itemtype "NOTHING"}
#enddef

#define SX_PLACE_ITEM X Y IMAGE HALO
  [item]
    x,y={X},{Y}
    image={IMAGE}
    halo={HALO}
  [/item]
#enddef

#define SX_REDRAW_ITEMS X Y
  [removeitem]
    x,y={X},{Y}
  [/removeitem]
  {FOREACH i}
    [if]
      [variable]
        name=item[$i|].x
        equals={X}
      [/variable]
      [variable]
        name=item[$i|].y
        equals={Y}
      [/variable]
      [variable]
        name=item[$i|].used
        equals=0
      [/variable]
      [then]
        {SX_PLACE_ITEM {X} {Y} $item[$i|].image}
      [/then]
    [/if]
  {NEXT i}
#enddef

#define SX_ITEM X Y ITEM IMAGE HALO
  {VARIABLE n itemx.length}
  {VARIABLE item[$n].x {X}}
  {VARIABLE item[$n].y {Y}}
  {VARIABLE item[$n].type {ITEM}}
  {VARIABLE item[$n].image {IMAGE}}
  {VARIABLE item[$n].halo {HALO}}
  {VARIABLE item[$n].used 0}
  {SX_PLACE_ITEM {X} {Y} {IMAGE} {HALO}}
  {VARIABLE_OP format "$itemx|,{X}"}
  {VARIABLE_OP format "$itemy|,{Y}"}
  {VARIABLE_OP format "$itemtype|,{ITEM}"}
  {CLEAR_VARIABLE n}
#enddef

#define SX_FIRE X Y
  [event]
    name=start
    {SX_ITEM {X} {Y} "FIRE" "scenery/fire3.png" "scenery/fire1.png:150,scenery/fire2.png:150,scenery/fire3.png:150,scenery/fire4.png:150"}
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x={X}
      y={Y}
      side="1,2,3,4,5"
    [/filter]
    [sound]
      name=fire.wav
    [/sound]
    [store_unit]
      [filter]
        x={X}
        y={Y}
      [/filter]
      variable=injured
    [/store_unit]
    {VARIABLE_OP injured.hitpoints add -25}
    [unstore_unit]
      variable=injured
      text=25
      {COLOR_HARM}
    [/unstore_unit]
  [/event]
#enddef

#define SX_ICE X Y
  [event]
    name=start
    {SX_ITEM {X} {Y} "ICE" "items/icee1.png" "items/icee1.png:150,items/icee2.png:150,items/icee3.png:150,items/icee4.png:150"}
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x={X}
      y={Y}
      side="1,2,3,4,5"
    [/filter]
    [sound]
      name=fire.wav
    [/sound]
    [store_unit]
      [filter]
        x={X}
        y={Y}
      [/filter]
      variable=injured
    [/store_unit]
    {VARIABLE_OP injured.hitpoints add -25}
    [unstore_unit]
      variable=injured
      text=25
      {COLOR_HARM}
    [/unstore_unit]
  [/event]
#enddef

#define SX_FIREBALL X Y
  [event]
    name=start
    {SX_ITEM {X} {Y} "FIREBALL" "projectiles/fire-burst-small-1.png" "projectiles/fire-burst-small-1.png:150,projectiles/fire-burst-small-2.png:150,projectiles/fire-burst-small-3.png:150,projectiles/fire-burst-small-4.png:150,projectiles/fire-burst-small-5.png:150,projectiles/fire-burst-small-6.png:150,projectiles/fire-burst-small-7.png:150"}
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x={X}
      y={Y}
      side="1,2,3,4,5"
    [/filter]
    [sound]
      name=fire.wav
    [/sound]
    [store_unit]
      [filter]
        x={X}
        y={Y}
      [/filter]
      variable=injured
    [/store_unit]
    {VARIABLE_OP injured.hitpoints add -100}
    [unstore_unit]
      variable=injured
      text=100
      {COLOR_HARM}
    [/unstore_unit]
  [/event]
#enddef

#define SX_CIRCLE X Y
  [event]
    name=start
    {SX_ITEM {X} {Y} "FIREBALL" "scenery/cicle-magic-glow.png" "scenery/circle-magic.png:150,scenery/circle-magic-glow.png:150"}
  [/event]
#enddef

#define SX_SHOP X Y
  {SX_ITEM {X} {Y} "SHOP" "scenery/signpost.png" ""}

  [event]
    name=side turn
    first_time_only=no
    [label]
      x={X}
      y={Y}
      text=""
    [/label]
    [label]
      x={X}
      y={Y}
      text= _ "Shop"
    [/label]
  [/event]
#enddef

#define SX_SHOP_ITEMS
  [option]
    message= _ {MENU_IMG_TXT "icons/potions+items.png" "~**<64,192,32>Potions & items"}
    [command]
      {VARIABLE finished_sub no}
      [while]
        [variable]
          name=finished_sub
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          [message]
            speaker=narrator
            message= _ {MENU_IMG_TXT "icons/potions+items.png" "~**<64,192,32>Potions & items
Here you can buy various useful potions or items, that you can use later
by right clicking on your unit and selecting them from context menu.

<225,225,25>Gold: $gold|

~<0,0,255>Blue potions: $blue_potion_store_$side_number
~<0,255,255>Cyan potions: $blue_potion_store_$side_number
~<0,255,0>Green potions: $blue_potion_store_$side_number
~<255,0,0>Red potions: $red_potion_store_$side_number
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number
Total number of potions: $potions_total_store_$side_number of max. 3"}
            [option]
              message= _ {MENU_IMG_TXT "icons/done.png" "Done"}
              [command]
                {VARIABLE finished_sub yes}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-blue-buy.png" "100 gold: buy blue potion (+5MP/enable attack, +150HP)"}
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=100
                  [/variable]
                  [then]
                    [gold]
                      amount=-100
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP blue_potion_store_$side_number add 1}
                    {VARIABLE_OP blue_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-blue-sell" "+100 gold: sell blue potion"}
              [show_if]
                [variable]
                  name=blue_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=blue_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=100
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP blue_potion_store_$side_number add -1}
                {VARIABLE_OP blue_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-blue-sell" "+80 gold: sell blue potion"}
              [show_if]
                [variable]
                  name=blue_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=blue_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=80
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP blue_potion_store_$side_number add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-cyan-buy.png" "40 gold: buy cyan potion (+9MP)"}
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    [gold]
                      amount=-40
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP cyan_potion_store_$side_number add 1}
                    {VARIABLE_OP cyan_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-cyan-sell" "+40 gold: sell cyan potion"}
              [show_if]
                [variable]
                  name=cyan_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=cyan_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=40
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP cyan_potion_store_$side_number add -1}
                {VARIABLE_OP cyan_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-cyan-sell" "+32 gold: sell cyan potion"}
              [show_if]
                [variable]
                  name=cyan_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=cyan_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=32
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP cyan_potion_store_$side_number add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-green-buy.png" "60 gold: buy green potion (enable attack, +100HP)"}
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=60
                  [/variable]
                  [then]
                    [gold]
                      amount=60
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP green_potion_store_$side_number add 1}
                    {VARIABLE_OP green_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-green-sell" "+60 gold: sell cyan potion"}
              [show_if]
                [variable]
                  name=green_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=green_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=60
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP green_potion_store_$side_number add -1}
                {VARIABLE_OP green_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-green-sell" "+48 gold: sell green potion"}
              [show_if]
                [variable]
                  name=green_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=green_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=48
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP cyan_potion_store_$side_number add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-red-buy" "50 gold: buy red potion (full heal)"}
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=50
                  [/variable]
                  [then]
                    [gold]
                      amount=-50
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP red_potion_store_$side_number add 1}
                    {VARIABLE_OP red_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-red-sell" "+50 gold: sell red potion"}
              [show_if]
                [variable]
                  name=red_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=red_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=50
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP red_potion_store_$side_number add -1}
                {VARIABLE_OP red_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-red-sell" "+40 gold: sell red potion"}
              [show_if]
                [variable]
                  name=red_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=red_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=40
                  side=$side_number
                 [/gold]
                 {VARIABLE_OP potions_total_store_$side_number add -1}
                 {VARIABLE_OP red_potion_store_$side_number add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-yellow-buy" "125 gold: buy yellow potion (+20HP permanent, 2x max. HP)"}
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=125
                  [/variable]
                  [then]
                    [gold]
                      amount=-125
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP yellow_potion_store_$side_number add 1}
                    {VARIABLE_OP yellow_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-yellow-sell" "+125 gold: sell yellow potion"}
              [show_if]
                [variable]
                  name=yellow_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=yellow_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=125
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP yellow_potion_store_$side_number add -1}
                {VARIABLE_OP yellow_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/potion-yellow-sell" "+100 gold: sell yellow potion"}
              [show_if]
                [variable]
                  name=yellow_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=yellow_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=100
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP yellow_potion_store_$side_number add -1}
              [/command]
            [/option]
          [/message]
          [redraw]
          [/redraw]
        [/do]
      [/while]
    [/command]
  [/option]
#enddef

#define SX_SHOP_ENHANCEMENTS
  [option]
    message= _ {MENU_IMG_TXT "icons/enhancements.png" "~**<64,192,32>Enhancements"}
    [command]
      {VARIABLE finished_sub no}
      [while]
        [variable]
          name=finished_sub
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          {VARIABLE_OP moveleft format $move_lefty_$side_number}
          [message]
            speaker=narrator
            message= _ {MENU_IMG_TXT "icons/enhancements.png" "~**<64,192,32>Enhancements
<225,225,25>Gold: $gold|"}
            [option]
              message= _ {MENU_IMG_TXT "icons/done.png" "Done"}
              [command]
                {VARIABLE finished_sub yes}
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/damage.png" "20 gold: +1 Melee Damage"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=20
                  [/variable]
                  [then]
                    [gold]
                      amount=-20
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=attack
                        range=melee
                        increase_damage=1
                      [/effect]
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/damage.png" "20 gold: +1 Ranged Damage"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=20
                  [/variable]
                  [then]
                    [gold]
                      amount=-20
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=attack
                        range=ranged
                        increase_damage=1
                      [/effect]
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/damage.png" "30 gold: +1 Both Damage"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=attack
                        range=melee
                        increase_damage=1
                      [/effect]
                      [effect]
                        apply_to=attack
                        range=ranged
                        increase_damage=1
                      [/effect]
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/strikes.png" "75 gold: +1 Melee Strikes"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=75
                  [/variable]
                  [then]
                    [gold]
                      amount=-75
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=attack
                        range=melee
                        increase_attacks=1
                      [/effect]
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/strikes.png" "75 gold: +1 Ranged Strikes"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=75
                  [/variable]
                  [then]
                    [gold]
                      amount=-75
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=attack
                        range=ranged
                        increase_attacks=1
                      [/effect]
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/strikes.png" "120 gold: +1 Both Strikes"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=120
                  [/variable]
                  [then]
                    [gold]
                      amount=-120
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=attack
                        range=melee
                        increase_attacks=1
                      [/effect]
                      [effect]
                        apply_to=attack
                        range=ranged
                        increase_attacks=1
                      [/effect]
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/health.png" "10 gold: +5 Max. HP"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=10
                  [/variable]
                  [then]
                    [gold]
                      amount=-10
                      side=$side_number
                    [/gold]
                    [object]
                      [effect]
                        apply_to=hitpoints
                        increase_total=5
                        violate_maximum=yes
                      [/effect]
                      [effect]
                        apply_to=hitpoints
                        increase=5
                        violate_maximum=yes
                      [/effect]
                      silent=yes
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/health.png" "100 gold: +50 Max. HP"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=100
                  [/variable]
                  [then]
                    [gold]
                      amount=-100
                      side=$side_number
                    [/gold]
                    [object]
                      [effect]
                        apply_to=hitpoints
                        increase_total=50
                        violate_maximum=yes
                      [/effect]
                      [effect]
                        apply_to=hitpoints
                        increase=50
                        violate_maximum=yes
                      [/effect]
                      silent=yes
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ {MENU_IMG_TXT "icons/movement.png" "30 gold: +1 Movement Points"}
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [variable]
                    name=moveleft
                    greater_than=0
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP move_lefty_$side_number add -1}
                    [object]
                      silent=yes
                      [effect]
                        apply_to=movement
                        increase=1
                      [/effect]
                    [/object]
                  [/then]
                [/if]
              [/command]
            [/option]
          [/message]
          [redraw]
          [/redraw]
        [/do]
      [/while]
    [/command]
  [/option]
#enddef
#--------------------------------------------------------------
# These two macro define extra weapons only used for the creep
# macro below. They should not be used regularly.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_WEAPON_HOLY_MISSILE DAM SRK
  [effect]
    apply_to=new_attack
    name= _ "DarkBlessing"
    icon=attacks/magic-missile.png
    type=arcane
    range=ranged
    damage={DAM}
    number={SRK}
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "sword"
      [/attack_filter]
      [missile_frame]
        begin=-180
        end=0
        image="projectiles/whitemissile-n.png"
        image_diagonal="projectiles/whitemissile-ne.png"
        halo=halo/holy/white-mage-halo1.png,halo/holy/white-mage-halo2.png,halo/holy/white-mage-halo3.png,halo/holy/white-mage-halo4.png
      [/missile_frame]
      [frame]
        begin=-300
        end=-225
      [/frame]
      [frame]
        begin=-225
        end=-150
      [/frame]
      [frame]
        begin=-150
        end=-75
        halo=halo/holy/halo6.png
      [/frame]
      [if]
        hits=yes
        [frame]
          begin=-75
          end=0
          sound={SOUND_LIST:HOLY}
          halo=halo/holy/halo1.png
        [/frame]
      [/if]
      [else]
        hits=no
        [frame]
          begin=-75
          end=0
          sound={SOUND_LIST:HOLY_MISS}
          halo=halo/holy/halo1.png
        [/frame]
      [/else]
      [frame]
        begin=0
        end=75
        halo=halo/holy/halo3.png
      [/frame]
      [frame]
        begin=75
        end=150
        halo=halo/holy/halo5.png
      [/frame]
      [frame]
        begin=150
        end=200
        halo=halo/holy/halo6.png
      [/frame]
      [frame]
        begin=200
        end=250
      [/frame]
      [frame]
        begin=250
        end=300
      [/frame]
    [/attack_anim]
  [/effect]
#enddef

#define SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER DAM SRK
  [effect]
    apply_to=new_attack
    name= _ "DarkBlessing"
    icon=attacks/dagger-human.png
    type=arcane
    range=melee
    damage={DAM}
    number={SRK}
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "sword"
      [/attack_filter]
      hits=no
      [frame]
        begin=-150
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=100
        sound={SOUND_LIST:MISS},{SOUND_LIST:HOLY_MISS}
      [/frame]
      [frame]
        begin=100
        end=150
      [/frame]
    [/attack_anim]
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "sword"
      [/attack_filter]
      hits=yes
      [frame]
        begin=-150
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=100
        sound=dagger-swish.wav,{SOUND_LIST:HOLY}
      [/frame]
      [frame]
        begin=100
        end=150
      [/frame]
    [/attack_anim]
  [/effect]
#enddef

#define SURVIVALX_ENEMY_GUARD_HOLY X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 5 2}
        {SURVIVALX_ENEMY_WEAPON_HOLY_MISSILE 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_GUARD_HOLY_MELEE X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_HOLY X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 5 2}
        {SURVIVALX_ENEMY_WEAPON_HOLY_MISSILE 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_HOLY_MELEE X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_UNDEAD_GUARD_HOLY X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      {TRAIT_UNDEAD}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 5 2}
        {SURVIVALX_ENEMY_WEAPON_HOLY_MISSILE 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_UNDEAD_GUARD_HOLY_MELEE X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      {TRAIT_UNDEAD}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_UNDEAD_HOLY X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      {TRAIT_UNDEAD}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 5 2}
        {SURVIVALX_ENEMY_WEAPON_HOLY_MISSILE 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_UNDEAD_HOLY_MELEE X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      {TRAIT_UNDEAD}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_LEADER_HOLY X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    canrecruit=yes
    side={SIDE}
    {IS_HERO}
    generate_description=yes
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 5 2}
        {SURVIVALX_ENEMY_WEAPON_HOLY_MISSILE 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_LEADER_HOLY_MELEE X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    canrecruit=yes
    side={SIDE}
    {IS_HERO}
    generate_description=yes
    unrenamable=yes
    [modifications]
      {TRAIT_LOYAL}
      [object]
        silent=yes
        {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 8 3}
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SURVIVALX_ENEMY_MODIFICATION_HOLY MP HP MA MD RA RD RES
  {IS_HERO}
  [modifications]
    [object]
      {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 5 2}
      {SURVIVALX_ENEMY_WEAPON_HOLY_MISSILE 8 3}
      silent=yes
      [effect]
        apply_to=movement
        increase={MP}
      [/effect]
      [effect]
        apply_to=hitpoints
        increase={HP}
        increase_total={HP}
      [/effect]
      [effect]
        apply_to=attack
        range=melee
        increase_attacks={MA}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=melee
        increase_damage={MD}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=ranged
        increase_attacks={RA}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=ranged
        increase_damage={RD}
        duration=forever
      [/effect]
      [effect]
        apply_to=resistance
        replace=no
        [resistance]
          blade=-{RES}
          pierce=-{RES}
          impact=-{RES}
          fire=-{RES}
          cold=-{RES}
          arcane=-{RES}
        [/resistance]
      [/effect]
    [/object]
  [/modifications]
#enddef

#define SURVIVALX_ENEMY_MODIFICATION_HOLY_MELEE MP HP MA MD RA RD RES
  {IS_HERO}
  [modifications]
    [object]
      {SURVIVALX_ENEMY_WEAPON_HOLY_DAGGER 8 3}
      silent=yes
      [effect]
        apply_to=movement
        increase={MP}
      [/effect]
      [effect]
        apply_to=hitpoints
        increase={HP}
        increase_total={HP}
      [/effect]
      [effect]
        apply_to=attack
        range=melee
        increase_attacks={MA}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=melee
        increase_damage={MD}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=ranged
        increase_attacks={RA}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=ranged
        increase_damage={RD}
        duration=forever
      [/effect]
      [effect]
        apply_to=resistance
        replace=no
        [resistance]
          blade=-{RES}
          pierce=-{RES}
          impact=-{RES}
          fire=-{RES}
          cold=-{RES}
          arcane=-{RES}
        [/resistance]
      [/effect]
    [/object]
  [/modifications]
#enddef

#--------------------------------------------------------------
# This macro introcudes the final, ultimate challenge. However,
# I didn't see it in use yet... Maybe it activiates too lately?
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_MEGA_CHALLENGE
  [event]
    name=turn 125
    [sound]
      name=dragonstick.ogg
    [/sound]
    [gold]
      side=6
      amount=9000
    [/gold]
    [gold]
      side=7
      amount=9000
    [/gold]
    [gold]
      side=8
      amount=9000
    [/gold]
    [gold]
      side=9
      amount=9000
    [/gold]
  [/event]
#enddef

#define SX_ITEM FILE X Y
  [item]
    x,y={X},{Y}
    image={FILE}
  [/item]
 #enddef

#define SX_FIRE X Y
  [event]
    name=start
    [item]
      x={X}
      y={Y}
      halo="scenery/fire1.png:150,scenery/fire2.png:150,scenery/fire3.png:150,scenery/fire4.png:150"
    [/item]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x={X}
      y={Y}
      side="1,2,3,4,5"
    [/filter]
    [sound]
      name=fire.wav
    [/sound]
    [store_unit]
      [filter]
        x={X}
        y={Y}
      [/filter]
      variable=injured
    [/store_unit]
    {VARIABLE_OP injured.hitpoints add -25}
    [unstore_unit]
      variable=injured
      text=25
      {COLOR_HARM}
    [/unstore_unit]
  [/event]
#enddef

#define SX_ICE X Y
  [event]
    name=start
    [item]
      x={X}
      y={Y}
      halo="items/icee1.png:150,items/icee2.png:150,items/icee3.png:150,items/icee4.png:150"
    [/item]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x={X}
      y={Y}
      side="1,2,3,4,5"
    [/filter]
    [sound]
      name=fire.wav
    [/sound]
    [store_unit]
      [filter]
        x={X}
        y={Y}
      [/filter]
      variable=injured
    [/store_unit]
    {VARIABLE_OP injured.hitpoints add -25}
    [unstore_unit]
      variable=injured
      text=25
      {COLOR_HARM}
    [/unstore_unit]
  [/event]
#enddef

#define SX_FIREBALL X Y
  [event]
    name=start
    [item]
      x={X}
      y={Y}
      halo="projectiles/fire-burst-small-1.png:150,projectiles/fire-burst-small-2.png:150,projectiles/fire-burst-small-3.png:150,projectiles/fire-burst-small-4.png:150,projectiles/fire-burst-small-5.png:150,projectiles/fire-burst-small-6.png:150,projectiles/fire-burst-small-7.png:150"
    [/item]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x={X}
      y={Y}
      side="1,2,3,4,5"
    [/filter]
    [sound]
      name=fire.wav
    [/sound]
    [store_unit]
      [filter]
        x={X}
        y={Y}
      [/filter]
      variable=injured
    [/store_unit]
    {VARIABLE_OP injured.hitpoints add -100}
    [unstore_unit]
      variable=injured
      text=100
      {COLOR_HARM}
    [/unstore_unit]
  [/event]
#enddef

#define SX_CIRCLE X Y
  [event]
    name=start
    [item]
      x={X}
      y={Y}
      halo="scenery/circle-magic.png:150,scenery/circle-magic-glow.png:150"
    [/item]
  [/event]
#enddef

#define SX_PLACE_ATTACKER TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_ATTACKER_AMBUSH TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=new_ability
          [abilities]
            {ABILITY_AMBUSH}
          [/abilities]
        [/effect]
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_ATTACKER_UNDEAD TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_DEFENDER_WOOD TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=1
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_UNDEAD_WOOD TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=1
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_DEFENDER_CAVE TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=1
            mountains=100
            village=100
            castle=100
            cave=1
            tundra=100
            canyon=100
            cavewall=100
            fungus=1
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_UNDEAD_CAVE TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=1
            mountains=100
            village=100
            castle=100
            cave=1
            tundra=100
            canyon=100
            cavewall=100
            fungus=1
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_DEFENDER_ROAD TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=1
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_UNDEAD_ROAD TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=1
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_DEFENDER_CASTLE TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=1
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_UNDEAD_CASTLE TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=1
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#define SX_PLACE_DEFENDER_SEA TYPE X Y SIDE MP HP MA MD RA RD RES
  [unit]
    type={TYPE}
    side={SIDE}
    generate_description=yes
    ai_special=guardian
    x={X}
    y={Y}
    random_traits=no
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=new_ability
          [abilities]
            {ABILITY_SUBMERGE}
          [/abilities]
        [/effect]
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=1
            shallow_water=1
            swamp_water=1
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#-------------------------------------------------------------
# This macro places a shop in which players can enhance their
# stats, buy new weapons and give gold to other players.
# The sandwich has to look like this:
# SURVIVALX_BEFORE_SHOPS
# SURVIVALX_SHOP X Y
# SURVIVALX_SHOP_EVENT
# Usage: X Y are the coordinates where the shop should appear.
#-------------------------------------------------------------

#---------------------------------------------------------------------------
# An unreachable coordinate to make sure the list doesn't start with a comma
#---------------------------------------------------------------------------
#define SURVIVALX_TERRAIN_CHECK_LIMIT DEFVAR DEF
  {VARIABLE_OP unit_defense_terrain format ${DEFVAR}}
  [if]
    [variable]
      name=unit_defense_terrain
      less_than_equal_to=0
    [/variable]
    [then]
      {VARIABLE unit_defense_terrain 50}
    [/then]
  [/if]
  [if]
    [variable]
      name=unit_defense_terrain
      greater_than_equal_to=100
    [/variable]
    [then]
      {VARIABLE unit_defense_terrain 50}
    [/then]
  [/if]
  {VARIABLE_OP unit_defense_terrain add {DEF}}
  [if]
    [variable]
      name=unit_defense_terrain
      less_than_equal_to=0
    [/variable]
    [then]
      {VARIABLE unit_defense_terrain 1}
    [/then]
  [/if]
  [if]
    [variable]
      name=unit_defense_terrain
      greater_than_equal_to=100
    [/variable]
    [then]
      {VARIABLE unit_defense_terrain 99}
    [/then]
  [/if]
  {VARIABLE {DEFVAR} $unit_defense_terrain}
  {CLEAR_VARIABLE unit_defense_terrain}
#enddef

#define SURVIVALX_UNIT_DEFENSE SIDE DEF
  [store_unit]
    [filter]
      side={SIDE}
      canrecruit=yes
    [/filter]
    variable=unit_defs
  [/store_unit]
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.cavewall {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.canyon {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.castle {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.cave {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.deep_water {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.forest {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.fungus {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.grassland {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.hills {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.mountains {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.sand {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.shallow_water {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.swamp_water {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.tundra {DEF}}
  {SURVIVALX_TERRAIN_CHECK_LIMIT unit_defs.defense.village {DEF}}
  [unstore_unit]
    variable=unit_defs
  [/unstore_unit]
  {CLEAR_VARIABLE unit_defs}
#enddef

#define TRAINING_CHECK TRAINVAR
  [if]
    [variable]
      name={TRAINVAR}_$side_number
      equals="trained"
    [/variable]
    [then]
      {VARIABLE {TRAINVAR} "trained"}
    [/then]
    [else]
      {VARIABLE {TRAINVAR} "           "}
    [/else]
  [/if]
#enddef

#define SURVIVALX_UNIT_INFO SIDE
  [event]
    name=turn 2
    [store_unit]
      variable=saved_leader_{SIDE}
      [filter]
        side=1
        canrecruit=yes
      [/filter]
    [/store_unit]
    {VARIABLE id_{SIDE} $saved_leader_{SIDE}.id}
    {VARIABLE advanceto_{SIDE} $saved_leader_{SIDE}.advanceto}
    {VARIABLE flying_{SIDE} $saved_leader_{SIDE}.flying}
    {VARIABLE hitpoints_{SIDE} $saved_leader_{SIDE}.hitpoints}
    {VARIABLE level_{SIDE} $saved_leader_{SIDE}.level}
    {VARIABLE zoc_{SIDE} $saved_leader_{SIDE}.zoc}
  [/event]
#enddef

#define SURVIVALX_SPECIAL_VALUE SVVAR SPEC
  {VARIABLE special_name {SPEC}}
  [if]
    [variable]
      name=special_name
      equals=absorb
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 200}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=arson
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 30}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=attack_only
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 20}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=backstab
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 15}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=berserk
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 150}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=blind
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 1}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=charge
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 25}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=charm
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 40}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=circle
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 80}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=cleave
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 5}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=concentrated
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 250}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=counter
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 30}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=defend_only
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 10}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=drains
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 200}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=dread
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 40}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=evasion
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 40}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=ferocious
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 40}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=firststrike
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 5}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=focus
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 75}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=guided
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 20}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=highground
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 10}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=magical
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 50}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=marksman
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 35}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=massivestrike
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 15}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=nocounter
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 80}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=poison
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 10}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=precision
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 60}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=rage
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 75}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=rage2
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 60}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=rage3
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 75}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=recieve
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 5}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=return
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 10}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=slow
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 25}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=spread
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 5}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=triplestrike
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 10}
    [/then]
  [/if]
  [if]
    [variable]
      name=special_name
      equals=udbane
    [/variable]
    [then]
      {VARIABLE_OP {SVVAR} add 10}
    [/then]
  [/if]
  {CLEAR_VARIABLE special_name}
#enddef

#define SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST WSVAR SPEC NUM
  [if]
    [variable]
      name=specials_number
      numerical_equals=0
    [/variable]
    [then]
      {VARIABLE {WSVAR}_list_{NUM} "{SPEC}"}
      {VARIABLE {WSVAR}_{NUM}[$specials_number].value {SPEC}}
      {VARIABLE_OP specials_number add 1}
      {SURVIVALX_SPECIAL_VALUE specials_price_{NUM} {SPEC}}
    [/then]
    [else]
      [if]
        [not]
          [variable]
            name={WSVAR}_list_{NUM}
            contains={SPEC}
          [/variable]
        [/not]
        [then]
          {VARIABLE {WSVAR}_list_{NUM} "${WSVAR}_list_{NUM}|,{SPEC}"}
          {VARIABLE {WSVAR}_{NUM}[$specials_number].value {SPEC}}
          {VARIABLE_OP specials_number add 1}
          {SURVIVALX_SPECIAL_VALUE specials_price_{NUM} {SPEC}}
        [/then]
      [/if]
    [/else]
  [/if]
#enddef

#define SURVIVALX_WEAPON_SPECIALS WSVAR WA NUM2
  {VARIABLE specials_number 0}
  {VARIABLE specials_num ${WA}.attacks.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.attacks[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.berserk.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.berserk[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.chance_to_hit.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.chance_to_hit[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.damage.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.damage[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.dummy.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.dummy[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.drains.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.drains[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.firststrike.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.firststrike[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.poison.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.poison[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {VARIABLE specials_num ${WA}.slow.length}
  {VARIABLE spec_i 0}
  [while]
    [variable]
      name=spec_i
      less_than=$specials_num
    [/variable]
    [do]
      {SURVIVALX_WEAPON_SPECIALS_ADD_TO_LIST {WSVAR} ${WA}.slow[$spec_i].id {NUM2}}
      {VARIABLE_OP spec_i add 1}
    [/do]
  [/while]
  {CLEAR_VARIABLE specials_number}
  {CLEAR_VARIABLE specials_num}
  {CLEAR_VARIABLE spec_i}
#enddef

#define SURVIVALX_PLAYER_ADD_WEAPON AWVAR NUMBER
  {VARIABLE new_attack ${AWVAR}.length}
  {VARIABLE {AWVAR}[$new_attack].name $weapon_bought_$side_number|[{NUMBER}].name}
  {VARIABLE {AWVAR}[$new_attack].description $weapon_bought_$side_number|[{NUMBER}].description}
  {VARIABLE {AWVAR}[$new_attack].damage $weapon_bought_$side_number|[{NUMBER}].damage}
  {VARIABLE {AWVAR}[$new_attack].number $weapon_bought_$side_number|[{NUMBER}].number}
  {VARIABLE {AWVAR}[$new_attack].range $weapon_bought_$side_number|[{NUMBER}].range}
  {VARIABLE {AWVAR}[$new_attack].type $weapon_bought_$side_number|[{NUMBER}].type}
  {VARIABLE {AWVAR}[$new_attack].icon $weapon_bought_$side_number|[{NUMBER}].icon}
  {VARIABLE new_anim ${AWVAR}_anim.length}
  {VARIABLE existing_animation no}
  {VARIABLE anim_i 0}
  [while]
    [variable]
      name=anim_i
      less_than=$new_anim
    [/variable]
    [variable]
      name=existing_animation
      equals=no
    [/variable]
    [do]
      [if]
        [variable]
          name={AWVAR}_anim[$anim_i].attack_filter.name
          equals=$weapon_bought_$side_number|[{NUMBER}].name
        [/variable]
        [then]
          {VARIABLE existing_animation yes}
        [/then]
      [/if]
      {VARIABLE_OP anim_i add 1}
    [/do]
  [/while]
  [if]
    [variable]
      name=existing_animation
      equals=no
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_ANIMATION $weapon_bought_$side_number|[{NUMBER}].animation {AWVAR}_anim $weapon_bought_$side_number|[{NUMBER}].name $new_anim}
    [/then]
  [/if]
  {CLEAR_VARIABLE new_anim}
  {CLEAR_VARIABLE existing_animation}
  {CLEAR_VARIABLE anim_i}
  {CLEAR_VARIABLE new_attack}
#enddef

#define SURVIVALX_PLAYER_ADD_ANIMATION TYPE AWVAR NAME INDEX
  {VARIABLE type {TYPE}}
  [if]
    [variable]
      name=type
      equals=ARCANE_SWORD
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_ARCANE_SWORD_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=IRON_SWORD
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_IRON_SWORD_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=COLD_SWORD
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_COLD_SWORD_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=FLAMING_SWORD
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_FLAMING_SWORD_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=IRON_MACE
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_IRON_MACE_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=SPEAR
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_SPEAR_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=LIGHT_BEAM
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_LIGHT_BEAM_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=CHAKRAM
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_CHAKRAM_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=ICE_WAVE
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_ICE_WAVE_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=FIREBALL
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_FIREBALL_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=SLING
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_SLING_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  [if]
    [variable]
      name=type
      equals=CROSSBOW
    [/variable]
    [then]
      {SURVIVALX_PLAYER_ADD_CROSSBOW_ANIMATION {AWVAR} {NAME} {INDEX}}
    [/then]
  [/if]
  {CLEAR_VARIABLE type}
#enddef

#define SURVIVALX_PLAYER_ADD_ARCANE_SWORD_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:SWORD_SWISH},{SOUND_LIST:HOLY}}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:MISS},{SOUND_LIST:HOLY_MISS}}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_IRON_SWORD_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:SWORD_SWISH}}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:MISS}}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_COLD_SWORD_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:SWORD_SWISH}}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:MISS}}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_FLAMING_SWORD_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:SWORD_SWISH},flame-big.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:MISS},flame-big-miss.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_IRON_MACE_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:SWORD_SWISH},flame-big.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:MISS},flame-big-miss.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_SPEAR_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound spear.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound spear-miss.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_LIGHT_BEAM_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:HOLY}}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:HOLY_MISS}}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_CHAKRAM_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:THROW}}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:THROW}}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_CHAKRAM_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound {SOUND_LIST:THROW}}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound {SOUND_LIST:THROW}}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_ICE_WAVE_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound magic-dark.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound magic-dark-miss.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_FIREBALL_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound fire.wav}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound fire.wav}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_SLING_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound sling.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound sling-miss.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_PLAYER_ADD_CROSSBOW_ANIMATION AWVAR NAME INDEX
  {VARIABLE {AWVAR}[{INDEX}].attack_filter.name {NAME}}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].begin (-200)}
  {VARIABLE {AWVAR}[{INDEX}].frame[0].end (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.hits yes}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].if.frame.sound crossbow.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.hits no}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.begin (-150)}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.end 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[1].else.frame.sound crossbow-miss.ogg}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].begin 100}
  {VARIABLE {AWVAR}[{INDEX}].frame[2].end 200}
#enddef

#define SURVIVALX_BEFORE_SHOPS
  {VARIABLE shopxs 999}
  {VARIABLE shopys 999}
#enddef

#define SURVIVALX_SHOP X Y
  [item]
    x={X}
    y={Y}
    image=scenery/signpost.png
  [/item]
  [set_variable]
    name=shopxs
    format=$shopxs|,{X}
  [/set_variable]
  [set_variable]
    name=shopys
    format=$shopys|,{Y}
  [/set_variable]

  [event]
    name=side turn
    first_time_only=no
    [label]
      x={X}
      y={Y}
      text=
    [/label]
    [label]
      x={X}
      y={Y}
      text= _ "Shop"
    [/label]
    [remove_item]
    [/remove_item]
    [item]
      x={X}
      y={Y}
      image=scenery/signpost.png
    [/item]
  [/event]
#enddef

#define SURVIVALX_SHOP_ENHANCEMENTS_OLD
       [option]
        message= _ "Enhancements"
        [command]
         {VARIABLE finished_sub no}
         [while]
          [variable]
           name=finished_sub
           equals=no
          [/variable]
          [do]
           [store_gold]
            side=$side_number
            variable=gold
           [/store_gold]
	      {VARIABLE_OP moveleft format $move_lefty_$side_number}

           [message]
            speaker=narrator
            message= _ "<225,225,25>Gold: $gold|
@Movement left: $moveleft|"

       [option]
        message= _ "Done"
        [command]
         {VARIABLE finished_sub yes}
        [/command]
       [/option]

            [option]
             message= _ "20 gold: +1 Melee Damage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  increase_damage=1
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "20 gold: +1 Ranged Damage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  increase_damage=1
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "30 gold: +1 Both Damage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=30
               [/variable]
               [then]
                [gold]
                 amount=-30
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  increase_damage=1
                 [/effect]
                 [effect]
                  apply_to=attack
                  range=ranged
                  increase_damage=1
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "75 gold: +1 Melee Strikes"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=75
               [/variable]
               [then]
                [gold]
                 amount=-75
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  increase_attacks=1
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "75 gold: +1 Ranged Strikes"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=75
               [/variable]
               [then]
                [gold]
                 amount=-75
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  increase_attacks=1
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "120 gold: +1 Both Strikes"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=120
               [/variable]
               [then]
                [gold]
                 amount=-120
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  increase_attacks=1
                 [/effect]
                 [effect]
                  apply_to=attack
                  range=ranged
                  increase_attacks=1
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

[option]
message= _ "10 gold: +5 Max. HP"
[command]
[if]
[variable]
name=gold
greater_than_equal_to=10
[/variable]
[then]
[gold]
amount=-10
side=$side_number
[/gold]
[object]
[effect]
apply_to=hitpoints
increase_total=5
violate_maximum=yes
[/effect]
[effect]
apply_to=hitpoints
increase=5
violate_maximum=yes
[/effect]
silent=yes
[/object]
[/then]
[/if]
[/command]
[/option]

[option]
message= _ "100 gold: +50 Max. HP"
[command]
[if]
[variable]
name=gold
greater_than_equal_to=100
[/variable]
[then]
[gold]
amount=-100
side=$side_number
[/gold]
[object]
[effect]
apply_to=hitpoints
increase_total=50
violate_maximum=yes
[/effect]
[effect]
apply_to=hitpoints
increase=50
violate_maximum=yes
[/effect]
silent=yes
[/object]
[/then]
[/if]
[/command]
[/option]

[option]
message= _ "30 gold: +1 Movement Points"
[command]
[if]
[variable]
name=gold
greater_than_equal_to=30
[/variable]
[variable]
name=moveleft
greater_than=0
[/variable]
[then]
[gold]
amount=-30
side=$side_number
[/gold]
{VARIABLE_OP move_lefty_$side_number add -1}
[object]
silent=yes
[effect]
apply_to=movement
increase=1
[/effect]
[/object]
[/then]
[/if]
[/command]
[/option]
            [/message]
           [redraw]
           [/redraw]
          [/do]
         [/while]
        [/command]
       [/option]
#enddef

#define SURVIVALX_SHOP_SPECIALS_OLD
       [option]
        message= _ "Weapon Smith"
        [command]
         {VARIABLE finished_sub no}
         [while]
          [variable]
           name=finished_sub
           equals=no
          [/variable]
          [do]
           [store_gold]
            side=$side_number
            variable=gold
           [/store_gold]
           [message]
            speaker=narrator
            message= _ "<225,225,25>Gold: $gold|"

       [option]
        message= _ "Done     Warning : May only have 1 upgrade per weapon; replaces old special.
Rage and Berserk Weapons will not be used in Defense."
        [command]
         {VARIABLE finished_sub yes}
        [/command]
       [/option]

            [option]
             message= _ "20: Melee Blade weapons receive Firststrike"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_FIRSTSTRIKE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "125: Melee Blade weapons receive Charge"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=125
               [/variable]
               [then]
                [gold]
                 amount=-125
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_CHARGE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "210: Melee Blade weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=210
               [/variable]
               [then]
                [gold]
                 amount=-210
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Melee Blade weapons receive Rage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=blade
                  [set_specials]
				[berserk]
			        id=berserk
			        name= _ "rage"
			        description= _ "Rage:
Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
			        value=3
			    [/berserk]
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "275: Melee Blade weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=275
               [/variable]
               [then]
                [gold]
                 amount=-275
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "425: Melee Blade weapons receive Berserk"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=425
               [/variable]
               [then]
                [gold]
                 amount=-425
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_BERSERK}
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "20: Melee Pierce weapons receive Firststrike"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_FIRSTSTRIKE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "125: Melee Pierce weapons receive Charge"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=125
               [/variable]
               [then]
                [gold]
                 amount=-125
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_CHARGE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "210: Melee Pierce weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=210
               [/variable]
               [then]
                [gold]
                 amount=-210
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Melee Pierce weapons receive Rage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=pierce
                  [set_specials]
				[berserk]
			        id=berserk
			        name= _ "rage"
			        description= _ "Rage:
Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
			        value=3
			    [/berserk]
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "275: Melee Pierce weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=275
               [/variable]
               [then]
                [gold]
                 amount=-275
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "425: Melee Pierce weapons receive Berserk"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=425
               [/variable]
               [then]
                [gold]
                 amount=-425
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_BERSERK}
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "20: Melee Impact weapons receive Firststrike"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_FIRSTSTRIKE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "125: Melee Impact weapons receive Charge"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=125
               [/variable]
               [then]
                [gold]
                 amount=-125
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_CHARGE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "210: Melee Impact weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=210
               [/variable]
               [then]
                [gold]
                 amount=-210
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Melee Impact weapons receive Rage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=impact
                  [set_specials]
				[berserk]
			        id=berserk
			        name= _ "rage"
			        description= _ "Rage:
Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
			        value=3
			    [/berserk]
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "275: Melee Impact weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=275
               [/variable]
               [then]
                [gold]
                 amount=-275
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "425: Melee Impact weapons receive Berserk"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=425
               [/variable]
               [then]
                [gold]
                 amount=-425
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_BERSERK}
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "20: Melee Fire weapons receive Firststrike"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_FIRSTSTRIKE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "125: Melee Fire weapons receive Charge"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=125
               [/variable]
               [then]
                [gold]
                 amount=-125
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_CHARGE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "210: Melee Fire weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=210
               [/variable]
               [then]
                [gold]
                 amount=-210
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Melee Fire weapons receive Rage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=fire
                  [set_specials]
				[berserk]
			        id=berserk
			        name= _ "rage"
			        description= _ "Rage:
Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
			        value=3
			    [/berserk]
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "275: Melee Fire weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=275
               [/variable]
               [then]
                [gold]
                 amount=-275
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "425: Melee Fire weapons receive Berserk"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=425
               [/variable]
               [then]
                [gold]
                 amount=-425
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_BERSERK}
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "20: Melee Cold weapons receive Firststrike"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_FIRSTSTRIKE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "125: Melee Cold weapons receive Charge"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=125
               [/variable]
               [then]
                [gold]
                 amount=-125
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_CHARGE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "210: Melee Cold weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=210
               [/variable]
               [then]
                [gold]
                 amount=-210
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Melee Cold weapons receive Rage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=cold
                  [set_specials]
				[berserk]
			        id=berserk
			        name= _ "rage"
			        description= _ "Rage:
Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
			        value=3
			    [/berserk]
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "275: Melee Cold weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=275
               [/variable]
               [then]
                [gold]
                 amount=-275
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "425: Melee Cold weapons receive Berserk"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=425
               [/variable]
               [then]
                [gold]
                 amount=-425
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_BERSERK}
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "20: Melee Arcane weapons receive Firststrike"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=20
               [/variable]
               [then]
                [gold]
                 amount=-20
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_FIRSTSTRIKE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "125: Melee Arcane weapons receive Charge"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=125
               [/variable]
               [then]
                [gold]
                 amount=-125
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_CHARGE}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "210: Melee Arcane weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=210
               [/variable]
               [then]
                [gold]
                 amount=-210
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Melee Arcane weapons receive Rage"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=arcane
                  [set_specials]
				[berserk]
			        id=berserk
			        name= _ "rage"
			        description= _ "Rage:
Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
			        value=3
			    [/berserk]
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "275: Melee Arcane weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=275
               [/variable]
               [then]
                [gold]
                 amount=-275
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "425: Melee Arcane weapons receive Berserk"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=425
               [/variable]
               [then]
                [gold]
                 amount=-425
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=melee
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_BERSERK}
                  [/set_specials]
			defense_weight=0
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "225: Ranged Blade weapons receive Marksman"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=225
               [/variable]
               [then]
                [gold]
                 amount=-225
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_MARKSMAN}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Blade weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Blade weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=blade
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "330: Ranged Blade weapons receive Focus"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=330
               [/variable]
               [then]
                [gold]
                 amount=-330
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=blade
                  [set_specials]
		[damage]
			id=focus
			name= _ "focus"
			description= _ "Focus:
When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
			multiply=1.5
			apply_to=both
			active_on=offense
		[/damage]
		[chance_to_hit]
			id=focus
			value=70
			cumulative=no
			active_on=offense
		[/chance_to_hit]
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "225: Ranged Pierce weapons receive Marksman"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=225
               [/variable]
               [then]
                [gold]
                 amount=-225
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_MARKSMAN}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Pierce weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Pierce weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=pierce
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "330: Ranged Pierce weapons receive Focus"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=330
               [/variable]
               [then]
                [gold]
                 amount=-330
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=pierce
                  [set_specials]
		[damage]
			id=focus
			name= _ "focus"
			description= _ "Focus:
When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
			multiply=1.5
			apply_to=both
			active_on=offense
		[/damage]
		[chance_to_hit]
			id=focus
			value=70
			cumulative=no
			active_on=offense
		[/chance_to_hit]
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "225: Ranged Impact weapons receive Marksman"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=225
               [/variable]
               [then]
                [gold]
                 amount=-225
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_MARKSMAN}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Impact weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Impact weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=impact
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "330: Ranged Impact weapons receive Focus"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=330
               [/variable]
               [then]
                [gold]
                 amount=-330
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=impact
                  [set_specials]
		[damage]
			id=focus
			name= _ "focus"
			description= _ "Focus:
When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
			multiply=1.5
			apply_to=both
			active_on=offense
		[/damage]
		[chance_to_hit]
			id=focus
			value=70
			cumulative=no
			active_on=offense
		[/chance_to_hit]
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "225: Ranged Fire weapons receive Marksman"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=225
               [/variable]
               [then]
                [gold]
                 amount=-225
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_MARKSMAN}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Fire weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Fire weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=fire
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "330: Ranged Fire weapons receive Focus"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=330
               [/variable]
               [then]
                [gold]
                 amount=-330
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=fire
                  [set_specials]
		[damage]
			id=focus
			name= _ "focus"
			description= _ "Focus:
When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
			multiply=1.5
			apply_to=both
			active_on=offense
		[/damage]
		[chance_to_hit]
			id=focus
			value=70
			cumulative=no
			active_on=offense
		[/chance_to_hit]
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "225: Ranged Cold weapons receive Marksman"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=225
               [/variable]
               [then]
                [gold]
                 amount=-225
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_MARKSMAN}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Cold weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Cold weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=cold
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "330: Ranged Cold weapons receive Focus"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=330
               [/variable]
               [then]
                [gold]
                 amount=-330
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=cold
                  [set_specials]
		[damage]
			id=focus
			name= _ "focus"
			description= _ "Focus:
When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
			multiply=1.5
			apply_to=both
			active_on=offense
		[/damage]
		[chance_to_hit]
			id=focus
			value=70
			cumulative=no
			active_on=offense
		[/chance_to_hit]
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "225: Ranged Arcane weapons receive Marksman"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=225
               [/variable]
               [then]
                [gold]
                 amount=-225
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_MARKSMAN}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Arcane weapons receive Magical"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_MAGICAL}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "250: Ranged Arcane weapons receive Slow"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=250
               [/variable]
               [then]
                [gold]
                 amount=-250
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=arcane
                  [set_specials]
                  {WEAPON_SPECIAL_SLOW}
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [option]
             message= _ "330: Ranged Arcane weapons receive Focus"
             [command]
              [if]
               [variable]
                name=gold
                greater_than_equal_to=330
               [/variable]
               [then]
                [gold]
                 amount=-330
                 side=$side_number
                [/gold]
                [object]
                 silent=yes
                 [effect]
                  apply_to=attack
                  range=ranged
                  type=arcane
                  [set_specials]
		[damage]
			id=focus
			name= _ "focus"
			description= _ "Focus:
When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
			multiply=1.5
			apply_to=both
			active_on=offense
		[/damage]
		[chance_to_hit]
			id=focus
			value=70
			cumulative=no
			active_on=offense
		[/chance_to_hit]
                  [/set_specials]
                 [/effect]
                [/object]
               [/then]
              [/if]
             [/command]
            [/option]

            [/message]
           [redraw]
           [/redraw]
          [/do]
         [/while]
        [/command]
       [/option]
#enddef

#define SURVIVALX_SHOP_ITEMS
  [option]
    message= _ "Potions & items"
    [command]
      {VARIABLE finished_sub no}
      [while]
        [variable]
          name=finished_sub
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          [message]
            speaker=narrator
            message= _ "~**<64,192,32>Potions & items
Here you can various useful potions or items, that you can use later
by right clicking on your unit an selecting them from context menu.

<225,225,25>Gold: $gold|

~<0,0,255>Blue potions: $blue_potion_store_$side_number of max. 2
~<255,0,0>Red potions: $red_potion_store_$side_number of max 2
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number of max. 2
Total number of potions: $potions_total_store_$side_number of max. 3
"
            image=items/potion-grey.png
            [option]
              message= _ "Done"
              [command]
                {VARIABLE finished_sub yes}
              [/command]
            [/option]
            [option]
              message= _ "120 gold: buy blue potion (+5MP/enable attack, +150HP)"
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
                [variable]
                  name=blue_potion_store_$side_number
                  numerical_not_equals=2
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=120
                  [/variable]
                  [then]
                    [gold]
                      amount=-120
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP blue_potion_store_$side_number add 1}
                    {VARIABLE_OP blue_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ "+120 gold: sell blue potion"
              [show_if]
                [variable]
                  name=blue_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=blue_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=120
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP blue_potion_store_$side_number add -1}
                {VARIABLE_OP blue_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ "+96 gold: sell blue potion"
              [show_if]
                [variable]
                  name=blue_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=blue_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=96
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP blue_potion_store_$side_number add -1}
              [/command]
            [/option]
            [option]
              message= _ "50 gold: buy red potion (full heal)"
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
                [variable]
                  name=red_potion_store_$side_number
                  numerical_not_equals=2
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=50
                  [/variable]
                  [then]
                    [gold]
                      amount=-50
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP red_potion_store_$side_number add 1}
                    {VARIABLE_OP red_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ "+50 gold: sell red potion"
              [show_if]
                [variable]
                  name=red_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=red_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=50
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP red_potion_store_$side_number add -1}
                {VARIABLE_OP red_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ "+40 gold: sell red potion"
              [show_if]
                [variable]
                  name=red_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=red_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=40
                  side=$side_number
                 [/gold]
                 {VARIABLE_OP potions_total_store_$side_number add -1}
                 {VARIABLE_OP red_potion_store_$side_number add -1}
              [/command]
            [/option]
            [option]
              message= _ "160 gold: buy yellow potion (+20HP permanent, heal, 2xHP)"
              [show_if]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_not_equals=3
                [/variable]
                [variable]
                  name=yellow_potion_store_$side_number
                  numerical_not_equals=2
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=160
                  [/variable]
                  [then]
                    [gold]
                      amount=-160
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP potions_total_store_$side_number add 1}
                    {VARIABLE_OP yellow_potion_store_$side_number add 1}
                    {VARIABLE_OP yellow_potion_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ "+160 gold: sell yellow potion"
              [show_if]
                [variable]
                  name=yellow_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=yellow_potion_session
                  numerical_not_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=160
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP yellow_potion_store_$side_number add -1}
                {VARIABLE_OP yellow_potion_session add -1}
              [/command]
            [/option]
            [option]
              message= _ "+128 gold: sell yellow potion"
              [show_if]
                [variable]
                  name=yellow_potion_store_$side_number
                  numerical_not_equals=0
                [/variable]
                [variable]
                  name=yellow_potion_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=128
                  side=$side_number
                [/gold]
                {VARIABLE_OP potions_total_store_$side_number add -1}
                {VARIABLE_OP yellow_potion_store_$side_number add -1}
              [/command]
            [/option]
            [option]
              message= _ "300 gold: buy ancient magic shop scroll (2 uses left)"
              [show_if]
                [variable]
                  name=ancient_shop_uses_$side_number
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=300
                  [/variable]
                  [then]
                    [gold]
                      amount=-300
                      side=$side_number
                    [/gold]
                    {VARIABLE ancient_shop_uses_$side_number 2}
                    {VARIABLE_OP ancient_shop_session add 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              message= _ "+300 gold: sell ancient magic shop scroll (2 uses left)"
              [show_if]
                [variable]
                  name=ancient_shop_uses_$side_number
                  numerical_equals=2
                [/variable]
                [variable]
                  name=ancient_shop_session
                  numerical_equals=1
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=300
                  side=$side_number
                [/gold]
                {VARIABLE_OP ancient_shop_uses_$side_number add -2}
                {VARIABLE_OP ancient_shop_session add -1}
              [/command]
            [/option]
            [option]
              message= _ "+240 gold: sell ancient magic shop scroll (2 uses left)"
              [show_if]
                [variable]
                  name=ancient_shop_uses_$side_number
                  numerical_equals=2
                [/variable]
                [variable]
                  name=ancient_shop_session
                  numerical_equals=0
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=240
                  side=$side_number
                [/gold]
                {VARIABLE_OP ancient_shop_uses_$side_number add -2}
              [/command]
            [/option]
            [option]
              message= _ "+120 gold: sell ancient magic shop scroll (1 use left)"
              [show_if]
                [variable]
                  name=ancient_shop_uses_$side_number
                  numerical_equals=1
                [/variable]
              [/show_if]
              [command]
                [gold]
                  amount=120
                  side=$side_number
                [/gold]
                {VARIABLE_OP ancient_shop_uses_$side_number add -1}
              [/command]
            [/option]
          [/message]
          [redraw]
          [/redraw]
        [/do]
      [/while]
    [/command]
  [/option]
#enddef

#define SURVIVALX_SHOP_ENHANCEMENTS
#enddef

#define SURVIVALX_SHOP_WEAPONS
  [option]
    message= _ "Weapons"
    [command]
      {VARIABLE finished_sub no}
      [while]
        [variable]
          name=finished_sub
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          [store_unit]
            [filter]
              side=$side_number
              x,y=$x1,$y1
              canrecruit=yes
            [/filter]
            variable=weapons
          [/store_unit]
          {VARIABLE weapon_count $weapons.attack.length}
          {VARIABLE weapon_i 0}
          {VARIABLE weapon_j 0}
          [while]
            [variable]
              name=weapon_i
              less_than=$weapon_count
            [/variable]
            [do]
              [if]
                [variable]
                  name=weapons.attack[$weapon_i].name
                  not_equals=removed
                [/variable]
                [then]
                  {VARIABLE weapon_number_$weapon_j $weapon_i}
                  {VARIABLE weapon_name_$weapon_j $weapons.attack[$weapon_i].name}
                  [if]
                    [variable]
                      name=bought_$weapon_i
                      equals=new
                    [/variable]
                    [then]
                      {VARIABLE price_$weapon_j 40}
                    [/then]
                    [else]
                      {VARIABLE price_$weapon_j $weapons.attack[$weapon_i].damage}
                      {VARIABLE_OP price_$weapon_j multiply $weapons.attack[$weapon_i].number}
                      {VARIABLE_OP price_$weapon_j multiply $$weapons.attack[$weapon_i].range}
                      {VARIABLE_OP price_$weapon_j multiply $$weapons.attack[$weapon_i].type}
                      {VARIABLE specials_price_$weapon_j 0}
                    [/else]
                  [/if]
                  [if]
                    [variable]
                      name=weapons.attack[$weapon_i].specials.length
                      greater_than=0
                    [/variable]
                    [then]
                      {SURVIVALX_WEAPON_SPECIALS weapon_specials weapons.attack[$weapon_i].specials $weapon_j}
                      {VARIABLE_OP price_$weapon_j add $specials_price_$weapon_j}
                    [/then]
                  [/if]
                  {VARIABLE weapon_$weapon_j "$weapons.attack[$weapon_i].description: $weapons.attack[$weapon_i].range|-$weapons.attack[$weapon_i].type| $weapons.attack[$weapon_i].damage|-$weapons.attack[$weapon_i].number| $weapon_specials_list_$weapon_j"}
                  {VARIABLE_OP weapon_j add 1}
                [/then]
              [/if]
              {VARIABLE_OP weapon_i add 1}
            [/do]
          [/while]
          [message]
            speaker=narrator
            message= _ "~**<64,192,32>Weapons
You can buy only basic weapons here. Specials can be bought separately
in Specials shop menu. You can have maximum of 7 weapons at a time.
You can also sell any weapon you have.
<225,225,25>Gold: $gold|
Now you have $weapon_j| weapons
"
            [option]
              message= _ "Done"
              [command]
                {VARIABLE finished_sub yes}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy blessed sword: melee arcane 7-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_blessed_sword_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range melee}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type arcane}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "blessed sword")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/sword-holy.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation ARCANE_SWORD}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 7}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy iron sword: melee blade 11-5"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_iron_sword_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range melee}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type blade}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "iron sword")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/sword-human.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation IRON_SWORD}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 11}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 5}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy cold steel: melee cold 11-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_cold_sword_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range melee}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type cold}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "cold steel")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/astral-blade.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation COLD_SWORD}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 11}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy flaming sword: melee fire 9-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_flaming_sword_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range melee}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type fire}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "flaming sword")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/sword-flaming.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation FLAMING_SWORD}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 9}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy mace: melee impact 17-3"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_iron_mace_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range melee}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type impact}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "mace")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/mace.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation IRON_MACE}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 17}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 3}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy spear: melee pierce 13-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_spear_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range melee}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type pierce}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "spear")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/spear.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation SPEAR}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 13}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy light beam: ranged arcane 9-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_light_beam_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range ranged}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type arcane}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "lightbeam")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/lightbeam.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation LIGHT_BEAM}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 9}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy chakram: ranged blade 14-5"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_chakram_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range ranged}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type blade}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "chakram")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/chakram.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation CHAKRAM}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 14}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 5}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy ice wave: ranged cold 14-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_ice_wave_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range ranged}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type cold}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "ice wave")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/dark-missile.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation ICE_WAVE}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 14}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy fireball: ranged fire 11-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_fireball_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range ranged}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type fire}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "fireball")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/fireball.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation FIREBAL}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 11}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy sling: ranged impact 16-4"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_sling_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range ranged}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type impact}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "sling")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/sling.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation SLING}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 16}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 4}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  less_than=7
                [/variable]
              [/show_if]
              message= _ "40 gold: buy crossbow: ranged pierce 13-5"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=40
                  [/variable]
                  [then]
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].name "sxc_crossbow_$weapons_bought_count_$side_number"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].range ranged}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].type pierce}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].description ( _ "crossbow")}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].icon "attacks/crossbow.png"}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].animation CROSSBOW}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].damage 13}
                    {VARIABLE weapon_bought_$side_number|[$weapons_bought_count_$side_number].number 5}
                    {SURVIVALX_PLAYER_ADD_WEAPON weapons.attack $weapons_bought_count_$side_number}
                    {VARIABLE bought_$weapon_count new}
                    {VARIABLE_OP weapons_bought_count_$side_number add 1}
                    [gold]
                      side=$side_number
                      amount=-40
                    [/gold]
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=0
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_0].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_0| gold: sell $weapon_0"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_0}
                {VARIABLE weapons.attack[$weapon_number_0].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_0
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=1
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_1].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_1| gold: sell $weapon_1"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_1}
                {VARIABLE weapons.attack[$weapon_number_1].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_1
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=2
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_2].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_2| gold: sell $weapon_2"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_2}
                {VARIABLE weapons.attack[$weapon_number_2].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_2
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=3
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_3].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_3| gold: sell $weapon_3"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_3}
                {VARIABLE weapons.attack[$weapon_number_3].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_3
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=4
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_4].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_4| gold: sell $weapon_4"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_4}
                {VARIABLE weapons.attack[$weapon_number_4].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_4
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=5
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_5].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_5| gold: sell $weapon_5"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_5}
                {VARIABLE weapons.attack[$weapon_number_5].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_5
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=6
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_6].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_6| gold: sell $weapon_6"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_6}
                {VARIABLE weapons.attack[$weapon_number_6].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_6
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=7
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_7].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_7| gold: sell $weapon_7"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_7}
                {VARIABLE weapons.attack[$weapon_number_7].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_7
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=8
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_8].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_8| gold: sell $weapon_8"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_8}
                {VARIABLE weapons.attack[$weapon_number_8].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_8
                [/gold]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=weapon_j
                  greater_than=9
                [/variable]
                [and]
                  [variable]
                    name=maximum_level_reached_$side_number
                    equals=yes
                  [/variable]
                  [or]
                    [variable]
                      name=weapons.attack[$weapon_number_9].name
                      contains="sxc_"
                    [/variable]
                  [/or]
                [/and]
              [/show_if]
              message= _ "+$price_9| gold: sell $weapon_9"
              [command]
                {VARIABLE weapon_sold_$sidenumber[$weapons_sold_count_$side_number].name $weapon_name_9}
                {VARIABLE weapons.attack[$weapon_number_9].name removed}
                {VARIABLE_OP weapons_sold_count_$side_number add 1}
                [gold]
                  side=$side_number
                  amount=$price_9
                [/gold]
              [/command]
            [/option]
          [/message]
          [unstore_unit]
            variable=weapons
            find_vacant=no
          [/unstore_unit]
          {CLEAR_VARIABLE weapons}
          {VARIABLE weapon_j 0}
          [while]
            [variable]
              name=weapon_j
              less_than=weapon_i
            [/variable]
            [do]
              {CLEAR_VARIABLE price_$weapon_j}
              {CLEAR_VARIABLE weapon_$weapon_j}
              {CLEAR_VARIABLE weapon_name_$weapon_j}
              {CLEAR_VARIABLE weapon_number_$weapon_j}
              {CLEAR_VARIABLE weapon_specials_$weapon_j}
              {CLEAR_VARIABLE weapon_specials_list_$weapon_j}
            [/do]
          [/while]
          {CLEAR_VARIABLE weapon_i}
          {CLEAR_VARIABLE weapon_j}
          [redraw]
          [/redraw]
        [/do]
      [/while]
    [/command]
  [/option]
#enddef

#define SURVIVALX_SHOP_ARMORY
  [option]
    message= _ "Armory"
    [command]
      {VARIABLE finished_sub no}
      [if]
        [variable]
          name=maximum_level_reached_$side_number
          equals="yes"
        [/variable]
        [then]
          {VARIABLE armory_warning "The EXTRA armor upgrades shown are all you can get,
choose carefully, which resistances you need!"}
        [/then]
        [else]
          {VARIABLE armory_warning "EXTRA upgrades shown are maximum for your level.
This will increase for most units at higher level."}
        [/else]
      [/if]
      [while]
        [variable]
          name=finished_sub
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          [store_unit]
            [filter]
              side=$side_number
              x,y=$x1,$y1
              canrecruit=yes
            [/filter]
            variable=armory
          [/store_unit]
          {VARIABLE current_arcane 100}
          {VARIABLE current_blade 100}
          {VARIABLE current_cold 100}
          {VARIABLE current_fire 100}
          {VARIABLE current_impact 100}
          {VARIABLE current_pierce 100}
          {VARIABLE_OP current_arcane add (-$armory.resistance.arcane)}
          {VARIABLE_OP current_blade add (-$armory.resistance.blade)}
          {VARIABLE_OP current_cold add (-$armory.resistance.cold)}
          {VARIABLE_OP current_fire add (-$armory.resistance.fire)}
          {VARIABLE_OP current_impact add (-$armory.resistance.impact)}
          {VARIABLE_OP current_pierce add (-$armory.resistance.pierce)}
          {VARIABLE_OP left format $armor_total_$side_number}
          {VARIABLE_OP left add (-$extra_armor_bought_$side_number)}
          {VARIABLE_OP extra format $extra_armor_bought_$side_number}
          [message]
            speaker=narrator
            message= _ "~**<64,192,32>Armory
<225,225,25>Gold: $gold|
$armory_warning|
Extra resistances for your level are all resistances
over $armor_limit_$side_number|%, that you will buy.

@EXTRA upgrades left: $left|%
~<20,200,250>Current resistances:
<20,200,250>Blade: $current_blade|%
<20,200,250>Pierce: $current_pierce|%
<20,200,250>Impact: $current_impact|%
<20,200,250>Fire: $current_fire|%
<20,200,250>Cold: $current_cold|%
<20,200,250>Arcane: $current_arcane|%
"
            [option]
              message= _ "Done"
              [command]
                {VARIABLE finished_sub yes}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  greater_than=$current_blade
                [/variable]
              [/show_if]
              message= _ "8 gold: buy +5% blade resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=8
                  [/variable]
                  [then]
                    [gold]
                      amount=-8
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP blade_session add 5}
                    {VARIABLE_OP armory.resistance.blade add -5}
                    {VARIABLE_OP resistance_upgrade_blade_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  less_than_equal_to=$current_blade
                [/variable]
                [variable]
                  name=current_blade
                  less_than_equal_to=95
                [/variable]
                [variable]
                  name=armor_total_$side_number
                  greater_than=$extra
                [/variable]
              [/show_if]
              message= _ "15 gold: buy +5% EXTRA blade resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=15
                  [/variable]
                  [then]
                    [gold]
                      amount=-15
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP blade_session add 5}
                    {VARIABLE_OP blade_extra add 5}
                    {VARIABLE_OP extra_armor_bought_$side_number add 5}
                    {VARIABLE_OP armory.resistance.blade add -5}
                    {VARIABLE_OP resistance_upgrade_blade_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=blade_session
                  greater_than=0
                [/variable]
                [variable]
                  name=blade_extra
                  numerical_equals=0
                [/variable]
              [/show_if]
              message= _ "+8 gold: sell 5% of blade resistance"
              [command]
                [gold]
                  amount=8
                  side=$side_number
                [/gold]
                {VARIABLE_OP blade_session add -5}
                {VARIABLE_OP armory.resistance.blade add 5}
                {VARIABLE_OP resistance_upgrade_blade_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=blade_extra
                  greater_than=0
                [/variable]
                [or]
                  [variable]
                    name=current_blade
                    greater_than_equal_to=100
                  [/variable]
                [/or]
              [/show_if]
              message= _ "+15 gold: sell 5% of EXTRA blade resistance"
              [command]
                [gold]
                  amount=15
                  side=$side_number
                [/gold]
                {VARIABLE_OP blade_session add -5}
                {VARIABLE_OP blade_extra add -5}
                {VARIABLE_OP extra_armor_bought_$side_number add -5}
                {VARIABLE_OP armory.resistance.blade add 5}
                {VARIABLE_OP resistance_upgrade_blade_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  greater_than=$current_pierce
                [/variable]
              [/show_if]
              message= _ "8 gold: buy +5% pierce resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=8
                  [/variable]
                  [then]
                    [gold]
                      amount=-8
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP pierce_session add 5}
                    {VARIABLE_OP armory.resistance.pierce add -5}
                    {VARIABLE_OP resistance_upgrade_pierce_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  less_than_equal_to=$current_pierce
                [/variable]
                [variable]
                  name=current_pierce
                  less_than_equal_to=95
                [/variable]
                [variable]
                  name=armor_total_$side_number
                  greater_than=$extra
                [/variable]
              [/show_if]
              message= _ "15 gold: buy +5% EXTRA pierce resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=15
                  [/variable]
                  [then]
                    [gold]
                      amount=-15
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP pierce_session add 5}
                    {VARIABLE_OP pierce_extra add 5}
                    {VARIABLE_OP extra_armor_bought_$side_number add 5}
                    {VARIABLE_OP armory.resistance.pierce add -5}
                    {VARIABLE_OP resistance_upgrade_pierce_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=pierce_session
                  greater_than=0
                [/variable]
                [variable]
                  name=pierce_extra
                  numerical_equals=0
                [/variable]
              [/show_if]
              message= _ "+8 gold: sell 5% of pierce resistance"
              [command]
                [gold]
                  amount=8
                  side=$side_number
                [/gold]
                {VARIABLE_OP pierce_session add -5}
                {VARIABLE_OP armory.resistance.pierce add 5}
                {VARIABLE_OP resistance_upgrade_pierce_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=pierce_extra
                  greater_than=0
                [/variable]
                [or]
                  [variable]
                    name=current_pierce
                    greater_than=100
                  [/variable]
                [/or]
              [/show_if]
              message= _ "+15 gold: sell 5% of EXTRA pierce resistance"
              [command]
                [gold]
                  amount=15
                  side=$side_number
                [/gold]
                {VARIABLE_OP pierce_session add -5}
                {VARIABLE_OP pierce_extra add -5}
                {VARIABLE_OP extra_armor_bought_$side_number add -5}
                {VARIABLE_OP armory.resistance.pierce add 5}
                {VARIABLE_OP resistance_upgrade_pierce_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  greater_than=$current_impact
                [/variable]
              [/show_if]
              message= _ "8 gold: buy +5% impact resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=8
                  [/variable]
                  [then]
                    [gold]
                      amount=-8
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP impact_session add 5}
                    {VARIABLE_OP armory.resistance.impact add -5}
                    {VARIABLE_OP resistance_upgrade_impact_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  less_than_equal_to=$current_impact
                [/variable]
                [variable]
                  name=current_impact
                  less_than_equal_to=95
                [/variable]
                [variable]
                  name=armor_total_$side_number
                  greater_than=$extra
                [/variable]
              [/show_if]
              message= _ "15 gold: buy +5% EXTRA impact resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=15
                  [/variable]
                  [then]
                    [gold]
                      amount=-15
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP impact_session add 5}
                    {VARIABLE_OP impact_extra add 5}
                    {VARIABLE_OP extra_armor_bought_$side_number add 5}
                    {VARIABLE_OP armory.resistance.impact add -5}
                    {VARIABLE_OP resistance_upgrade_impact_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=impact_session
                  greater_than=0
                [/variable]
                [variable]
                  name=impact_extra
                  numerical_equals=0
                [/variable]
              [/show_if]
              message= _ "+8 gold: sell 5% of impact resistance"
              [command]
                [gold]
                  amount=8
                  side=$side_number
                [/gold]
                {VARIABLE_OP impact_session add -5}
                {VARIABLE_OP armory.resistance.impact add 5}
                {VARIABLE_OP resistance_upgrade_impact_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=impact_extra
                  greater_than=0
                [/variable]
                [or]
                  [variable]
                    name=current_impact
                    greater_than_equal_to=100
                  [/variable]
                [/or]
              [/show_if]
              message= _ "+15 gold: sell 5% of EXTRA impact resistance"
              [command]
                [gold]
                  amount=15
                  side=$side_number
                [/gold]
                {VARIABLE_OP impact_session add -5}
                {VARIABLE_OP impact_extra add -5}
                {VARIABLE_OP extra_armor_bought_$side_number add -5}
                {VARIABLE_OP armory.resistance.impact add 5}
                {VARIABLE_OP resistance_upgrade_impact_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  greater_than=$current_fire
                [/variable]
              [/show_if]
              message= _ "8 gold: buy +5% fire resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=8
                  [/variable]
                  [then]
                    [gold]
                      amount=-8
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP fire_session add 5}
                    {VARIABLE_OP armory.resistance.fire add -5}
                    {VARIABLE_OP resistance_upgrade_fire_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  less_than_equal_to=$current_fire
                [/variable]
                [variable]
                  name=current_fire
                  less_than_equal_to=95
                [/variable]
                [variable]
                  name=armor_total_$side_number
                  greater_than=$extra
                [/variable]
              [/show_if]
              message= _ "15 gold: buy +5% EXTRA fire resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=15
                  [/variable]
                  [then]
                    [gold]
                      amount=-15
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP fire_session add 5}
                    {VARIABLE_OP fire_extra add 5}
                    {VARIABLE_OP extra_armor_bought_$side_number add 5}
                    {VARIABLE_OP armory.resistance.fire add -5}
                    {VARIABLE_OP resistance_upgrade_fire_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=fire_session
                  greater_than=0
                [/variable]
                [variable]
                  name=fire_extra
                  numerical_equals=0
                [/variable]
              [/show_if]
              message= _ "+8 gold: sell 5% of fire resistance"
              [command]
                [gold]
                  amount=8
                  side=$side_number
                [/gold]
                {VARIABLE_OP fire_session add -5}
                {VARIABLE_OP armory.resistance.fire add 5}
                {VARIABLE_OP resistance_upgrade_fire_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=fire_extra
                  greater_than=0
                [/variable]
                [or]
                  [variable]
                    name=current_fire
                    greater_than_equal_to=100
                  [/variable]
                [/or]
              [/show_if]
              message= _ "+15 gold: sell 5% of EXTRA fire resistance"
              [command]
                [gold]
                  amount=15
                  side=$side_number
                [/gold]
                {VARIABLE_OP fire_session add -5}
                {VARIABLE_OP fire_extra add -5}
                {VARIABLE_OP extra_armor_bought_$side_number add -5}
                {VARIABLE_OP armory.resistance.fire add 5}
                {VARIABLE_OP resistance_upgrade_fire_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  greater_than=$current_cold
                [/variable]
              [/show_if]
              message= _ "8 gold: buy +5% cold resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=8
                  [/variable]
                  [then]
                    [gold]
                      amount=-8
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP cold_session add 5}
                    {VARIABLE_OP armory.resistance.cold add -5}
                    {VARIABLE_OP resistance_upgrade_cold_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  less_than_equal_to=$current_cold
                [/variable]
                [variable]
                  name=current_cold
                  less_than_equal_to=95
                [/variable]
                [variable]
                  name=armor_total_$side_number
                  greater_than=$extra
                [/variable]
              [/show_if]
              message= _ "15 gold: buy +5% EXTRA cold resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=15
                  [/variable]
                  [then]
                    [gold]
                      amount=-15
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP cold_session add 5}
                    {VARIABLE_OP cold_extra add 5}
                    {VARIABLE_OP extra_armor_bought_$side_number add 5}
                    {VARIABLE_OP armory.resistance.cold add -5}
                    {VARIABLE_OP resistance_upgrade_cold_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=cold_session
                  greater_than=0
                [/variable]
                [variable]
                  name=cold_extra
                  numerical_equals=0
                [/variable]
              [/show_if]
              message= _ "+8 gold: sell 5% of cold resistance"
              [command]
                [gold]
                  amount=8
                  side=$side_number
                [/gold]
                {VARIABLE_OP cold_session add -5}
                {VARIABLE_OP armory.resistance.cold add 5}
                {VARIABLE_OP resistance_upgrade_cold_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=cold_extra
                  greater_than=0
                [/variable]
                [or]
                  [variable]
                    name=current_cold
                    greater_than_equal_to=100
                  [/variable]
                [/or]
              [/show_if]
              message= _ "+15 gold: sell 5% of EXTRA cold resistance"
              [command]
                [gold]
                  amount=15
                  side=$side_number
                [/gold]
                {VARIABLE_OP cold_session add -5}
                {VARIABLE_OP cold_extra add -5}
                {VARIABLE_OP extra_armor_bought_$side_number add -5}
                {VARIABLE_OP armory.resistance.cold add 5}
                {VARIABLE_OP resistance_upgrade_cold_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  greater_than=$current_arcane
                [/variable]
              [/show_if]
              message= _ "8 gold: buy +5% arcane resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=8
                  [/variable]
                  [then]
                    [gold]
                      amount=-8
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP arcane_session add 5}
                    {VARIABLE_OP armory.resistance.arcane add -5}
                    {VARIABLE_OP resistance_upgrade_arcane_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=armor_limit_$side_number
                  less_than_equal_to=$current_arcane
                [/variable]
                [variable]
                  name=current_arcane
                  less_than_equal_to=95
                [/variable]
                [variable]
                  name=armor_total_$side_number
                  greater_than=$extra
                [/variable]
              [/show_if]
              message= _ "15 gold: buy +5% EXTRA arcane resistance"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=15
                  [/variable]
                  [then]
                    [gold]
                      amount=-15
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP arcane_session add 5}
                    {VARIABLE_OP arcane_extra add 5}
                    {VARIABLE_OP extra_armor_bought_$side_number add 5}
                    {VARIABLE_OP armory.resistance.arcane add -5}
                    {VARIABLE_OP resistance_upgrade_arcane_$side_number add -5}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=arcane_session
                  greater_than=0
                [/variable]
                [variable]
                  name=arcane_extra
                  numerical_equals=0
                [/variable]
              [/show_if]
              message= _ "+8 gold: sell 5% of arcane resistance"
              [command]
                [gold]
                  amount=8
                  side=$side_number
                [/gold]
                {VARIABLE_OP arcane_session add -5}
                {VARIABLE_OP armory.resistance.arcane add 5}
                {VARIABLE_OP resistance_upgrade_arcane_$side_number add 5}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=arcane_extra
                  greater_than=0
                [/variable]
                [or]
                  [variable]
                    name=current_arcane
                    greater_than_equal_to=100
                  [/variable]
                [/or]
              [/show_if]
              message= _ "+15 gold: sell 5% of EXTRA arcane resistance"
              [command]
                [gold]
                  amount=15
                  side=$side_number
                [/gold]
                {VARIABLE_OP arcane_session add -5}
                {VARIABLE_OP arcane_extra add -5}
                {VARIABLE_OP extra_armor_bought_$side_number add -5}
                {VARIABLE_OP armory.resistance.arcane add 5}
                {VARIABLE_OP resistance_upgrade_arcane_$side_number add 5}
              [/command]
            [/option]
          [/message]
          [unstore_unit]
            variable=armory
          [/unstore_unit]
          {CLEAR_VARIABLE current_arcane}
          {CLEAR_VARIABLE current_blade}
          {CLEAR_VARIABLE current_cold}
          {CLEAR_VARIABLE current_fire}
          {CLEAR_VARIABLE current_impact}
          {CLEAR_VARIABLE current_pierce}
          {CLEAR_VARIABLE left}
          {CLEAR_VARIABLE extra}
          {CLEAR_VARIABLE armory}
          [redraw]
          [/redraw]
        [/do]
        {CLEAR_VARIABLE armory_warning}
      [/while]
    [/command]
  [/option]
#enddef

#define SURVIVALX_SHOP_MOVEMENTS
  [option]
    message= _ "Terrain Training"
    [command]
      {VARIABLE finished_sub no}
      [while]
        [variable]
          name=finished_sub
          equals=no
        [/variable]
        [do]
          [store_unit]
            [filter]
              side=$side_number
              x,y=$x1,$y1
              canrecruit=yes
            [/filter]
            variable=movements
          [/store_unit]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          {VARIABLE_OP lefty format $terrains_lefty_$side_number}
          {TRAINING_CHECK mc_canyon}
          {TRAINING_CHECK mc_castle}
          {TRAINING_CHECK mc_cave}
          {TRAINING_CHECK mc_deep_water}
          {TRAINING_CHECK mc_forest}
          {TRAINING_CHECK mc_fungus}
          {TRAINING_CHECK mc_grassland}
          {TRAINING_CHECK mc_hills}
          {TRAINING_CHECK mc_mountains}
          {TRAINING_CHECK mc_sand}
          {TRAINING_CHECK mc_shallow_water}
          {TRAINING_CHECK mc_swamp_water}
          {TRAINING_CHECK mc_tundra}
          {TRAINING_CHECK mc_village}
          [message]
            speaker=narrator
            message= _ "~**<64,192,32>Terrain training
<225,225,25>Gold: $gold|
@Training left: $lefty|
~<250,0,0>Current movement costs:
<20,200,250>Canyon (gash): $movements.movement_costs.canyon| $mc_canyon|     Castle: $movements.movement_costs.castle| $mc_castle|
<20,200,250>Cave: $movements.movement_costs.cave| $mc_cave|                     Deep_water: $movements.movement_costs.deep_water| $mc_deep_water|
<20,200,250>Forest: $movements.movement_costs.forest| $mc_forest|                   Fungus (mushroom grove): $movements.movement_costs.fungus| $mc_fungus|
<20,200,250>Grassland: $movements.movement_costs.grassland| $mc_grassland|              Hills: $movements.movement_costs.hills| $mc_hills|
<20,200,250>Mountains: $movements.movement_costs.mountains| $mc_mountains|             Sand: $movements.movement_costs.sand| $mc_sand|
<20,200,250>Shallow_water: $movements.movement_costs.shallow_water| $mc_shallow_water|       Swamp_water: $movements.movement_costs.swamp_water| $mc_swamp_water|
<20,200,250>Tundra (snow): $movements.movement_costs.tundra| $mc_tundra|       Village: $movements.movement_costs.village| $mc_village|
<20,200,250>Cave_wall: $movements.movement_costs.cavewall| can't be trained
"
            [option]
              message= _ "Done"
              [command]
                {VARIABLE finished_sub yes}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
                [variable]
                  name=movements.flying
                  equals=yes
                [/variable]
                [variable]
                  name=movements.movement_costs.canyon
                  greater_than=1
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for canyon (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_canyon_$side_number "trained"}
                    {VARIABLE mc_canyon_session $movements.movement_costs.canyon}
                    {VARIABLE movements.movement_costs.canyon 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.canyon
                  greater_than=3
                [/variable]
                [variable]
                  name=movements.flying
                  equals=no
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for canyon (to 3MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_canyon_$side_number "trained"}
                    {VARIABLE mc_canyon_session $movements.movement_costs.canyon}
                    {VARIABLE movements.movement_costs.canyon 3}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_canyon_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for canyon"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_canyon_$side_number}
                {VARIABLE movements.movement_costs.canyon $mc_canyon_session}
                {CLEAR_VARIABLE mc_canyon_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.castle
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for castle (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_castle_$side_number "trained"}
                    {VARIABLE mc_castle_session $movements.movement_costs.castle}
                    {VARIABLE movements.movement_costs.castle 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_castle_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for castle"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_castle_$side_number}
                {VARIABLE movements.movement_costs.castle $mc_castle_session}
                {CLEAR_VARIABLE mc_castle_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.cave
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for cave (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_cave_$side_number "trained"}
                    {VARIABLE mc_cave_session $movements.movement_costs.cave}
                    {VARIABLE movements.movement_costs.cave 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_cave_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for cave"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_cave_$side_number}
                {VARIABLE movements.movement_costs.cave $mc_cave_session}
                {CLEAR_VARIABLE mc_cave_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
                [variable]
                  name=movements.flying
                  equals=yes
                [/variable]
                [variable]
                  name=movements.movement_costs.deep_water
                  greater_than=1
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for deep water (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_deep_water_$side_number "trained"}
                    {VARIABLE mc_deep_water_session $movements.movement_costs.deep_water}
                    {VARIABLE movements.movement_costs.deep_water 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.deep_water
                  greater_than=3
                [/variable]
                [variable]
                  name=movements.flying
                  equals=no
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for deep_water (to 3MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_deep_water_$side_number "trained"}
                    {VARIABLE mc_deep_water_session $movements.movement_costs.deep_water}
                    {VARIABLE movements.movement_costs.deep_water 3}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_deep_water_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for deep water"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_deep_water_$side_number}
                {VARIABLE movements.movement_costs.deep_water $mc_deep_water_session}
                {CLEAR_VARIABLE mc_deep_water_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.forest
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for forest (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_forest_$side_number "trained"}
                    {VARIABLE mc_forest_session $movements.movement_costs.forest}
                    {VARIABLE movements.movement_costs.forest 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_forest_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for forest"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_forest_$side_number}
                {VARIABLE movements.movement_costs.forest $mc_forest_session}
                {CLEAR_VARIABLE mc_forest_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.fungus
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for fungus (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_fungus_$side_number "trained"}
                    {VARIABLE mc_fungus_session $movements.movement_costs.fungus}
                    {VARIABLE movements.movement_costs.fungus 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_fungus_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for fungus"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_fungus_$side_number}
                {VARIABLE movements.movement_costs.fungus $mc_fungus_session}
                {CLEAR_VARIABLE mc_fungus_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.grassland
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for grassland (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_grassland_$side_number "trained"}
                    {VARIABLE mc_grassland_session $movements.movement_costs.grassland}
                    {VARIABLE movements.movement_costs.grassland 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_grassland_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for grassland"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_grassland_$side_number}
                {VARIABLE movements.movement_costs.grassland $mc_grassland_session}
                {CLEAR_VARIABLE mc_grassland_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.hills
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for hills (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_hills_$side_number "trained"}
                    {VARIABLE mc_hills_session $movements.movement_costs.hills}
                    {VARIABLE movements.movement_costs.hills 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_hills_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for hills"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_hills_$side_number}
                {VARIABLE movements.movement_costs.hills $mc_hills_session}
                {CLEAR_VARIABLE mc_hills_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.mountains
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for mountains (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_mountains_$side_number "trained"}
                    {VARIABLE mc_mountains_session $movements.movement_costs.mountains}
                    {VARIABLE movements.movement_costs.mountains 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_mountains_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for mountains"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_mountains_$side_number}
                {VARIABLE movements.movement_costs.mountains $mc_mountains_session}
                {CLEAR_VARIABLE mc_mountains_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.sand
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for sand (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_sand_$side_number "trained"}
                    {VARIABLE mc_sand_session $movements.movement_costs.sand}
                    {VARIABLE movements.movement_costs.sand 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_sand_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for sand"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_sand_$side_number}
                {VARIABLE movements.movement_costs.sand $mc_sand_session}
                {CLEAR_VARIABLE mc_sand_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.shallow_water
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for shallow water (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_shallow_water_$side_number "trained"}
                    {VARIABLE mc_shallow_water_session $movements.movement_costs.shallow_water}
                    {VARIABLE movements.movement_costs.shallow_water 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_shallow_water_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for shallow water"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_shallow_water_$side_number}
                {VARIABLE movements.movement_costs.shallow_water $mc_shallow_water_session}
                {CLEAR_VARIABLE mc_shallow_water_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.swamp_water
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for swamp water (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_swamp_water_$side_number "trained"}
                    {VARIABLE mc_swamp_water_session $movements.movement_costs.swamp_water}
                    {VARIABLE movements.movement_costs.swamp_water 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_swamp_water_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for swamp_water"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_swamp_water_$side_number}
                {VARIABLE movements.movement_costs.swamp_water $mc_swamp_water_session}
                {CLEAR_VARIABLE mc_swamp_water_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.tundra
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for tundra (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_tundra_$side_number "trained"}
                    {VARIABLE mc_tundra_session $movements.movement_costs.tundra}
                    {VARIABLE movements.movement_costs.tundra 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_tundra_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for tundra"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_tundra_$side_number}
                {VARIABLE movements.movement_costs.tundra $mc_tundra_session}
                {CLEAR_VARIABLE mc_tundra_session}
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=movements.movement_costs.village
                  greater_than=1
                [/variable]
                [variable]
                  name=lefty
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "30 gold: Buy training for village (to 1MP cost)"
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=30
                  [/variable]
                  [then]
                    [gold]
                      amount=-30
                      side=$side_number
                    [/gold]
                    {VARIABLE_OP terrains_lefty_$side_number add -1}
                    {VARIABLE mc_village_$side_number "trained"}
                    {VARIABLE mc_village_session $movements.movement_costs.village}
                    {VARIABLE movements.movement_costs.village 1}
                  [/then]
                [/if]
              [/command]
            [/option]
            [option]
              [show_if]
                [variable]
                  name=mc_village_session
                  greater_than=0
                [/variable]
              [/show_if]
              message= _ "+30 gold: Cancel training for village"
              [command]
                [gold]
                  amount=30
                  side=$side_number
                [/gold]
                {VARIABLE_OP terrains_lefty_$side_number add 1}
                {CLEAR_VARIABLE mc_village_$side_number}
                {VARIABLE movements.movement_costs.village $mc_village_session}
                {CLEAR_VARIABLE mc_village_session}
              [/command]
            [/option]
          [/message]
          [unstore_unit]
            variable=movements
          [/unstore_unit]
          [redraw]
          [/redraw]
        [/do]
      [/while]
    [/command]
  [/option]
#enddef

#define SURVIVALX_SHOP_SPECIALS_SET INDEX
  [option]
    [show_if]
      [variable]
        name=weapon_j
        greater_than={INDEX}
      [/variable]
      [and]
        [variable]
          name=maximum_level_reached_$side_number
          equals=yes
        [/variable]
        [or]
          [variable]
            name=weapons.attack[$weapon_number_{INDEX}].name
            contains="sxc_"
          [/variable]
        [/or]
      [/and]
    [/show_if]
    message= _ "$weapon_{INDEX}"
    [command]
      [if]
        [variable]
          name=weapon_specials_{INDEX}|.length
          numerical_equals=0
        [/variable]
        [then]
          {VARIABLE price_aim 28}
          {VARIABLE price_attack_only 28}
          {VARIABLE price_berserk 210}
          {VARIABLE price_charge 35}
          {VARIABLE price_drains 280}
          {VARIABLE price_focus 105}
          {VARIABLE price_magical 70}
          {VARIABLE price_marksman 49}
          {VARIABLE price_rage 105}
          {VARIABLE price_slow 35}
        [/then]
        [else]
          {VARIABLE price_aim 40}
          {VARIABLE price_attack_only 40}
          {VARIABLE price_berserk 300}
          {VARIABLE price_charge 50}
          {VARIABLE price_drains 400}
          {VARIABLE price_focus 150}
          {VARIABLE price_magical 100}
          {VARIABLE price_marksman 70}
          {VARIABLE price_rage 150}
          {VARIABLE price_slow 50}
        [/else]
      [/if]
      [message]
        speaker=narrator
        message= _ "~**<64,192,32>Weapon Specials Shop
<225,225,25>Gold: $gold|
$weapon_{INDEX}|
Select special you want add/remove:
"
        [option]
          message= _ "Done"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
            [variable]
              name=weapon_specials_{INDEX}[0].value
              not_equals=aim
            [/variable]
            [variable]
              name=weapon_specials_{INDEX}[0].value
              not_equals=focus
            [/variable]
            [variable]
              name=weapon_specials_{INDEX}[0].value
              not_equals=magical
            [/variable]
            [variable]
              name=weapon_specials_{INDEX}[0].value
              not_equals=marksman
            [/variable]
          [/show_if]
          message= _ "$price_aim| gold: buy aim"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_attack_only| gold: buy attack only"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_berserk| gold: buy berserk"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_charge| gold: buy charge"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_drains| gold: buy drain"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_focus| gold: buy focus"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_magical| gold: buy magical"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_marksman| gold: buy marksman"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_rage| gold: buy rage"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              less_than=2
            [/variable]
          [/show_if]
          message= _ "$price_slow| gold: buy slow"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              greater_than=0
            [/variable]
          [/show_if]
          message= _ "Remove $weapon_specials_{INDEX}[0]"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              greater_than=1
            [/variable]
          [/show_if]
          message= _ "Remove $weapon_specials_{INDEX}[1]"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              greater_than=2
            [/variable]
          [/show_if]
          message= _ "Remove $weapon_specials_{INDEX}[2]"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              greater_than=3
            [/variable]
          [/show_if]
          message= _ "Remove $weapon_specials_{INDEX}[3]"
          [command]
          [/command]
        [/option]
        [option]
          [show_if]
            [variable]
              name=weapon_specials_{INDEX}.length
              greater_than=4
            [/variable]
          [/show_if]
          message= _ "Remove $weapon_specials_{INDEX}[4]"
          [command]
          [/command]
        [/option]
      [/message]
      [redraw]
      [/redraw]
    [/command]
  [/option]
#enddef

#define SURVIVALX_SHOP_SPECIALS
  [option]
    message= _ "Weapon Specials Shop"
    [command]
      {VARIABLE finished_sub no}
      [while]
        [variable]
          name=finished_sub
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          [store_unit]
            [filter]
              side=$side_number
              x,y=$x1,$y1
              canrecruit=yes
            [/filter]
            variable=weapons
          [/store_unit]
          {VARIABLE weapon_count $weapons.attack.length}
          {VARIABLE weapon_i 0}
          {VARIABLE weapon_j 0}
          [while]
            [variable]
              name=weapon_i
              less_than=$weapon_count
            [/variable]
            [do]
              [if]
                [variable]
                  name=weapons.attack[$weapon_i].name
                  not_equals=removed
                [/variable]
                [then]
                  {VARIABLE weapon_number_$weapon_j $weapon_i}
                  {VARIABLE weapon_name_$weapon_j $weapons.attack[$weapon_i].name}
                  [if]
                    [variable]
                      name=weapons.attack[$weapon_i].specials.length
                      greater_than=0
                    [/variable]
                    [then]
                      {SURVIVALX_WEAPON_SPECIALS weapon_specials weapons.attack[$weapon_i].specials $weapon_j}
                    [/then]
                  [/if]
                  {VARIABLE weapon_$weapon_j "$weapons.attack[$weapon_i].description: $weapons.attack[$weapon_i].range|-$weapons.attack[$weapon_i].type| $weapons.attack[$weapon_i].damage|-$weapons.attack[$weapon_i].number| $weapon_specials_list_$weapon_j"}
                  {VARIABLE_OP weapon_j add 1}
                [/then]
              [/if]
              {VARIABLE_OP weapon_i add 1}
            [/do]
          [/while]
          [message]
            speaker=narrator
            message= _ "~**<64,192,32>Weapon Specials
<225,225,25>Gold: $gold|
Select weapon you want to add/remove it's special:
"
            [option]
              message= _ "Done"
              [command]
                {VARIABLE finished_sub yes}
              [/command]
            [/option]
            [option]
              message= _ "More about weapon specials"
              [command]
                [message]
                  speaker=narrator
                  message= _ "Weapons can have up to 2 specials associated with help
of mighty magical spells. These spells always consume
some amount of gold, that is additional and needed price
for adding special to selected weapon. Because all specials
are magical spells, that work only while associated with
weapon, these have not any value while removed, so
removing these will give you back no money, except if you
cancel associating spell with your weapon before leaving
Weapon Specials shop or if you sell your weapon with all
associated specials.
Some specias can't be associated together with some
other types (such as berserk with magical), some can
work with all (such as attack_only). Also, second special
needs additional spell to protect first associated special,
so it needs additional amount of gold.
Spell cost for associating spell is 40% of special's value
for both first and second specials (separately for each)
and protection spell costs 60% of the second special's
value. Removing special costs nothing, but if you want it
back later, you must buy new special, as it is removed
immediately while leaving Weapon Specials shop.
All prices shown to players already contain all additional
costs for associating selected specials.
Your natural weapons can't be changed before you will reach
your highest level.
"
                  [option]
                    message= _ "Ok"
                  [/option]
                [/message]
                [redraw]
                [/redraw]
              [/command]
            [/option]
            {SURVIVALX_SHOP_SPECIALS_SET 0}
            {SURVIVALX_SHOP_SPECIALS_SET 1}
            {SURVIVALX_SHOP_SPECIALS_SET 2}
            {SURVIVALX_SHOP_SPECIALS_SET 3}
            {SURVIVALX_SHOP_SPECIALS_SET 4}
            {SURVIVALX_SHOP_SPECIALS_SET 5}
            {SURVIVALX_SHOP_SPECIALS_SET 6}
            {SURVIVALX_SHOP_SPECIALS_SET 7}
            {SURVIVALX_SHOP_SPECIALS_SET 8}
            {SURVIVALX_SHOP_SPECIALS_SET 9}
          [/message]
          [unstore_unit]
            variable=weapons
            find_vacant=no
          [/unstore_unit]
          {CLEAR_VARIABLE weapons}
          {VARIABLE weapon_j 0}
          [while]
            [variable]
              name=weapon_j
              less_than=weapon_i
            [/variable]
            [do]
              {CLEAR_VARIABLE price_$weapon_j}
              {CLEAR_VARIABLE weapon_$weapon_j}
              {CLEAR_VARIABLE weapon_name_$weapon_j}
              {CLEAR_VARIABLE weapon_number_$weapon_j}
              {CLEAR_VARIABLE weapon_specials_$weapon_j}
              {CLEAR_VARIABLE weapon_specials_list_$weapon_j}
            [/do]
          [/while]
          {CLEAR_VARIABLE weapon_i}
          {CLEAR_VARIABLE weapon_j}
          [redraw]
          [/redraw]

#             [option]
#              message= _ "20: Melee Blade weapons receive Firststrike"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=20
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-20
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_FIRSTSTRIKE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "125: Melee Blade weapons receive Charge"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=125
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-125
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_CHARGE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "210: Melee Blade weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=210
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-210
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Melee Blade weapons receive Rage"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=blade
#                   [set_specials]
# 				[berserk]
# 			        id=berserk
# 			        name= _ "rage"
# 			        description= _ "Rage:
# Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
# 			        value=3
# 			    [/berserk]
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "275: Melee Blade weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=275
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-275
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "425: Melee Blade weapons receive Berserk"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=425
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-425
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_BERSERK}
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "20: Melee Pierce weapons receive Firststrike"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=20
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-20
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_FIRSTSTRIKE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "125: Melee Pierce weapons receive Charge"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=125
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-125
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_CHARGE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "210: Melee Pierce weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=210
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-210
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Melee Pierce weapons receive Rage"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=pierce
#                   [set_specials]
# 				[berserk]
# 			        id=berserk
# 			        name= _ "rage"
# 			        description= _ "Rage:
# Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
# 			        value=3
# 			    [/berserk]
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "275: Melee Pierce weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=275
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-275
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "425: Melee Pierce weapons receive Berserk"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=425
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-425
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_BERSERK}
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "20: Melee Impact weapons receive Firststrike"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=20
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-20
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_FIRSTSTRIKE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "125: Melee Impact weapons receive Charge"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=125
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-125
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_CHARGE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "210: Melee Impact weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=210
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-210
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Melee Impact weapons receive Rage"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=impact
#                   [set_specials]
# 				[berserk]
# 			        id=berserk
# 			        name= _ "rage"
# 			        description= _ "Rage:
# Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
# 			        value=3
# 			    [/berserk]
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "275: Melee Impact weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=275
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-275
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "425: Melee Impact weapons receive Berserk"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=425
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-425
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_BERSERK}
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "20: Melee Fire weapons receive Firststrike"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=20
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-20
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_FIRSTSTRIKE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "125: Melee Fire weapons receive Charge"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=125
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-125
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_CHARGE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "210: Melee Fire weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=210
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-210
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Melee Fire weapons receive Rage"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=fire
#                   [set_specials]
# 				[berserk]
# 			        id=berserk
# 			        name= _ "rage"
# 			        description= _ "Rage:
# Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
# 			        value=3
# 			    [/berserk]
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "275: Melee Fire weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=275
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-275
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "425: Melee Fire weapons receive Berserk"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=425
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-425
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_BERSERK}
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "20: Melee Cold weapons receive Firststrike"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=20
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-20
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_FIRSTSTRIKE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "125: Melee Cold weapons receive Charge"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=125
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-125
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_CHARGE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "210: Melee Cold weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=210
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-210
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Melee Cold weapons receive Rage"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=cold
#                   [set_specials]
# 				[berserk]
# 			        id=berserk
# 			        name= _ "rage"
# 			        description= _ "Rage:
# Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
# 			        value=3
# 			    [/berserk]
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "275: Melee Cold weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=275
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-275
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "425: Melee Cold weapons receive Berserk"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=425
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-425
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_BERSERK}
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "20: Melee Arcane weapons receive Firststrike"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=20
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-20
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_FIRSTSTRIKE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "125: Melee Arcane weapons receive Charge"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=125
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-125
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_CHARGE}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "210: Melee Arcane weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=210
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-210
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Melee Arcane weapons receive Rage"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=arcane
#                   [set_specials]
# 				[berserk]
# 			        id=berserk
# 			        name= _ "rage"
# 			        description= _ "Rage:
# Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 3 rounds of attacks have occurred."
# 			        value=3
# 			    [/berserk]
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "275: Melee Arcane weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=275
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-275
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "425: Melee Arcane weapons receive Berserk"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=425
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-425
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=melee
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_BERSERK}
#                   [/set_specials]
# 			defense_weight=0
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "225: Ranged Blade weapons receive Marksman"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=225
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-225
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_MARKSMAN}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Blade weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Blade weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=blade
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "330: Ranged Blade weapons receive Focus"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=330
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-330
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=blade
#                   [set_specials]
# 		[damage]
# 			id=focus
# 			name= _ "focus"
# 			description= _ "Focus:
# When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
# 			multiply=1.5
# 			apply_to=both
# 			active_on=offense
# 		[/damage]
# 		[chance_to_hit]
# 			id=focus
# 			value=70
# 			cumulative=no
# 			active_on=offense
# 		[/chance_to_hit]
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "225: Ranged Pierce weapons receive Marksman"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=225
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-225
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_MARKSMAN}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Pierce weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Pierce weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=pierce
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "330: Ranged Pierce weapons receive Focus"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=330
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-330
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=pierce
#                   [set_specials]
# 		[damage]
# 			id=focus
# 			name= _ "focus"
# 			description= _ "Focus:
# When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
# 			multiply=1.5
# 			apply_to=both
# 			active_on=offense
# 		[/damage]
# 		[chance_to_hit]
# 			id=focus
# 			value=70
# 			cumulative=no
# 			active_on=offense
# 		[/chance_to_hit]
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "225: Ranged Impact weapons receive Marksman"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=225
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-225
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_MARKSMAN}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Impact weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Impact weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=impact
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "330: Ranged Impact weapons receive Focus"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=330
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-330
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=impact
#                   [set_specials]
# 		[damage]
# 			id=focus
# 			name= _ "focus"
# 			description= _ "Focus:
# When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
# 			multiply=1.5
# 			apply_to=both
# 			active_on=offense
# 		[/damage]
# 		[chance_to_hit]
# 			id=focus
# 			value=70
# 			cumulative=no
# 			active_on=offense
# 		[/chance_to_hit]
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "225: Ranged Fire weapons receive Marksman"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=225
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-225
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_MARKSMAN}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Fire weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Fire weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=fire
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "330: Ranged Fire weapons receive Focus"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=330
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-330
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=fire
#                   [set_specials]
# 		[damage]
# 			id=focus
# 			name= _ "focus"
# 			description= _ "Focus:
# When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
# 			multiply=1.5
# 			apply_to=both
# 			active_on=offense
# 		[/damage]
# 		[chance_to_hit]
# 			id=focus
# 			value=70
# 			cumulative=no
# 			active_on=offense
# 		[/chance_to_hit]
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "225: Ranged Cold weapons receive Marksman"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=225
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-225
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_MARKSMAN}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Cold weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Cold weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=cold
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "330: Ranged Cold weapons receive Focus"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=330
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-330
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=cold
#                   [set_specials]
# 		[damage]
# 			id=focus
# 			name= _ "focus"
# 			description= _ "Focus:
# When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
# 			multiply=1.5
# 			apply_to=both
# 			active_on=offense
# 		[/damage]
# 		[chance_to_hit]
# 			id=focus
# 			value=70
# 			cumulative=no
# 			active_on=offense
# 		[/chance_to_hit]
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "225: Ranged Arcane weapons receive Marksman"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=225
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-225
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_MARKSMAN}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Arcane weapons receive Magical"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_MAGICAL}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "250: Ranged Arcane weapons receive Slow"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=250
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-250
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=arcane
#                   [set_specials]
#                   {WEAPON_SPECIAL_SLOW}
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]
#
#             [option]
#              message= _ "330: Ranged Arcane weapons receive Focus"
#              [command]
#               [if]
#                [variable]
#                 name=gold
#                 greater_than_equal_to=330
#                [/variable]
#                [then]
#                 [gold]
#                  amount=-330
#                  side=$side_number
#                 [/gold]
#                 [object]
#                  silent=yes
#                  [effect]
#                   apply_to=attack
#                   range=ranged
#                   type=arcane
#                   [set_specials]
# 		[damage]
# 			id=focus
# 			name= _ "focus"
# 			description= _ "Focus:
# When used offensively, this attack always has a 70% chance to hit and causes both the attacker and the defender to do 50% more damage than usual. This weapon special isn't activiated on defense."
# 			multiply=1.5
# 			apply_to=both
# 			active_on=offense
# 		[/damage]
# 		[chance_to_hit]
# 			id=focus
# 			value=70
# 			cumulative=no
# 			active_on=offense
# 		[/chance_to_hit]
#                   [/set_specials]
#                  [/effect]
#                 [/object]
#                [/then]
#               [/if]
#              [/command]
#             [/option]

          [/do]
         [/while]
        [/command]
       [/option]
#enddef

#define SURVIVALX_SHOP_EVENT
  [event]
    name=moveto
    first_time_only=no
    [filter]
      side=1,2,3,4,5
      x=$shopxs
      y=$shopys
      canrecruit=yes
    [/filter]
    [store_gold]
      side=$side_number
      variable=gold
    [/store_gold]
    [if]
      [variable]
        name=shopped_$side_number
        numerical_not_equals=1
      [/variable]
      [then]
        [message]
          speaker=narrator
          message= _ "~*<255,0,0>This is new conception of shops in SurvivalXtreme!
You can enter shop everytime you stand on it. To use shop, right click
on your unit standing at Shop sign and select 'Enter shop' in menu."
          [option]
            message= _ "I wish to see this message again next time I'll step on shop"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Ok. I don't wan't to see this message again"
            [command]
              {VARIABLE shopped_$side_number 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
    [if]
      [variable]
        name=gold
        greater_than_equal_to=500
      [/variable]
      [then]
        {VARIABLE warning "
Shopping can take some time..."}
      [/then]
      [else]
        {VARIABLE warning ""}
      [/else]
    [/if]
    [print]
      text= _ "Player $side_number stands at shop with $gold gold.$warning"
      size=18
      duration=500
      red,green,blue=255,176,0
    [/print]
    {CLEAR_VARIABLE warning}
    {CLEAR_VARIABLE gold}
    [redraw]
    [/redraw]
  [/event]

  {SURVIVALX_SHOP_MENU}
  {SURVIVALX_ANCIENT_SHOP_MENU}
  {SX_DRINK_BLUE_POTION}
  {SX_DRINK_RED_POTION}
  {SX_DRINK_YELLOW_POTION}
#enddef

#define SURVIVALX_SHOP_MENU
  [set_menu_item]
    id=SXC_Shop
    description="Enter Shop"
    image=icons/signpost_icon.png
    [show_if]
      [have_unit]
        side=$side_number
        x,y=$shopxs,$shopys
        canrecruit=yes
      [/have_unit]
      [have_unit]
        side=$side_number
        x,y=$x1,$y1
        canrecruit=yes
      [/have_unit]
    [/show_if]
    [command]
      [sound]
        name=shop_door_bell.ogg
      [/sound]
      {VARIABLE finished no}
      {VARIABLE healed no}
      {VARIABLE blue_potion_session 0}
      {VARIABLE red_potion_session 0}
      {VARIABLE yellow_potion_session 0}
      {VARIABLE ancient_shop_session 0}
      {VARIABLE arcane_session 0}
      {VARIABLE blade_session 0}
      {VARIABLE cold_session 0}
      {VARIABLE fire_session 0}
      {VARIABLE impact_session 0}
      {VARIABLE pierce_session 0}
      {VARIABLE arcane_extra 0}
      {VARIABLE blade_extra 0}
      {VARIABLE cold_extra 0}
      {VARIABLE fire_extra 0}
      {VARIABLE impact_extra 0}
      {VARIABLE pierce_extra 0}
      [while]
        [variable]
          name=finished
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          [message]
            speaker=narrator
            message= _ "<225,225,25>Gold: $gold|"
            [option]
              message= _ "Done"
              [command]
                {VARIABLE finished yes}
              [/command]
            [/option]
            [option]
              message= _ "20 gold: Restore full HP"
              [show_if]
                [variable]
                  name=healed
                  equals=no
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=20
                  [/variable]
                  [then]
                    [gold]
                      amount=-20
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=hitpoints
                        increase_total=0
                        heal_full=yes
                      [/effect]
                      [effect]
                        apply_to=status
                        remove=poisoned
                      [/effect]
                      [effect]
                        apply_to=status
                        remove=slowed
                      [/effect]
                    [/object]
                  [/then]
                [/if]
                {CLEAR_VARIABLE healed}
              [/command]
            [/option]
            {SURVIVALX_SHOP_ITEMS}
            {SURVIVALX_SHOP_ENHANCEMENTS_OLD}
            {SURVIVALX_SHOP_WEAPONS}
            {SURVIVALX_SHOP_ARMORY}
            {SURVIVALX_SHOP_MOVEMENTS}
            {SURVIVALX_SHOP_SPECIALS}
            {SURVIVALX_SHOP_ABILITIES_OLD}
          [/message]
          [redraw]
          [/redraw]
        [/do]
      [/while]
      {VARIABLE_OP weapon_count add -1}
      [while]
        [variable]
          name=bought_$weapon_count
          equals=new
        [/variable]
        [do]
          {CLEAR_VARIABLE bought_$weapon_count}
          {VARIABLE_OP weapon_count add -1}
        [/do]
      [/while]
      {CLEAR_VARIABLE weapon_count}
      {CLEAR_VARIABLE healed}
      {CLEAR_VARIABLE blue_potion_session}
      {CLEAR_VARIABLE red_potion_session}
      {CLEAR_VARIABLE yellow_potion_session}
      {CLEAR_VARIABLE ancient_shop_session}
      {CLEAR_VARIABLE arcane_session}
      {CLEAR_VARIABLE blade_session}
      {CLEAR_VARIABLE cold_session}
      {CLEAR_VARIABLE fire_session}
      {CLEAR_VARIABLE impact_session}
      {CLEAR_VARIABLE pierce_session}
      {CLEAR_VARIABLE arcane_extra}
      {CLEAR_VARIABLE blade_extra}
      {CLEAR_VARIABLE cold_extra}
      {CLEAR_VARIABLE fire_extra}
      {CLEAR_VARIABLE impact_extra}
      {CLEAR_VARIABLE pierce_extra}
      {CLEAR_VARIABLE lefty}
      {CLEAR_VARIABLE mc_canyon_session}
      {CLEAR_VARIABLE mc_castle_session}
      {CLEAR_VARIABLE mc_cave_session}
      {CLEAR_VARIABLE mc_cavewall_session}
      {CLEAR_VARIABLE mc_deep_water_session}
      {CLEAR_VARIABLE mc_forest_session}
      {CLEAR_VARIABLE mc_fungus_session}
      {CLEAR_VARIABLE mc_grassland_session}
      {CLEAR_VARIABLE mc_hills_session}
      {CLEAR_VARIABLE mc_mountains_session}
      {CLEAR_VARIABLE mc_sand_session}
      {CLEAR_VARIABLE mc_shallow_water_session}
      {CLEAR_VARIABLE mc_swamp_water_session}
      {CLEAR_VARIABLE mc_tundra_session}
      {CLEAR_VARIABLE mc_village_session}
      {CLEAR_VARIABLE mc_canyon}
      {CLEAR_VARIABLE mc_castle}
      {CLEAR_VARIABLE mc_cave}
      {CLEAR_VARIABLE mc_cavewall}
      {CLEAR_VARIABLE mc_deep_water}
      {CLEAR_VARIABLE mc_forest}
      {CLEAR_VARIABLE mc_fungus}
      {CLEAR_VARIABLE mc_grassland}
      {CLEAR_VARIABLE mc_hills}
      {CLEAR_VARIABLE mc_mountains}
      {CLEAR_VARIABLE mc_sand}
      {CLEAR_VARIABLE mc_shallow_water}
      {CLEAR_VARIABLE mc_swamp_water}
      {CLEAR_VARIABLE mc_tundra}
      {CLEAR_VARIABLE mc_village}
      {CLEAR_VARIABLE moveleft}
      {CLEAR_VARIABLE finished}
      {CLEAR_VARIABLE TempGoldStore1}
      {CLEAR_VARIABLE TempGoldStore2}
      {CLEAR_VARIABLE TempGoldStore3}
      {CLEAR_VARIABLE TempGoldStore4}
      {CLEAR_VARIABLE TempGoldStore5}
      {CLEAR_VARIABLE playername1}
      {CLEAR_VARIABLE playername2}
      {CLEAR_VARIABLE playername3}
      {CLEAR_VARIABLE playername4}
      {CLEAR_VARIABLE playername5}
    [/command]
  [/set_menu_item]
#enddef

#define SURVIVALX_ANCIENT_SHOP_MENU
  [set_menu_item]
    id=SXC_Ancient_Shop
    description="Read ancient magic shop scroll (uses left: $ancient_shop_uses_$side_number)"
    image=icons/tent-shop-weapons_icon.png
    [show_if]
      [variable]
        name=ancient_shop_uses_$side_number
        greater_than_equal_to=1
      [/variable]
      [have_unit]
        side=$side_number
        x,y=$x1,$y1
        canrecruit=yes
        [not]
          x,y=$shopxs,$shopys
        [/not]
      [/have_unit]
    [/show_if]
    [command]
      {VARIABLE_OP ancient_shop_uses_$side_number add -1}
      [sound]
        name=lightning.ogg
      [/sound]
      [print]
        text= _ "Player $side_number used ancient magic shop scroll."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      {VARIABLE finished no}
      {VARIABLE healed no}
      {VARIABLE blue_potion_session 0}
      {VARIABLE red_potion_session 0}
      {VARIABLE yellow_potion_session 0}
      {VARIABLE ancient_shop_session 0}
      {VARIABLE arcane_session 0}
      {VARIABLE blade_session 0}
      {VARIABLE cold_session 0}
      {VARIABLE fire_session 0}
      {VARIABLE impact_session 0}
      {VARIABLE pierce_session 0}
      {VARIABLE arcane_extra 0}
      {VARIABLE blade_extra 0}
      {VARIABLE cold_extra 0}
      {VARIABLE fire_extra 0}
      {VARIABLE impact_extra 0}
      {VARIABLE pierce_extra 0}
      [while]
        [variable]
          name=finished
          equals=no
        [/variable]
        [do]
          [store_gold]
            side=$side_number
            variable=gold
          [/store_gold]
          [message]
            speaker=narrator
            message= _ "<225,225,25>Gold: $gold|"
            [option]
              message= _ "Done"
              [command]
                {VARIABLE finished yes}
              [/command]
            [/option]
            [option]
              message= _ "20 gold: Restore full HP"
              [show_if]
                [variable]
                  name=healed
                  equals=no
                [/variable]
              [/show_if]
              [command]
                [if]
                  [variable]
                    name=gold
                    greater_than_equal_to=20
                  [/variable]
                  [then]
                    [gold]
                      amount=-20
                      side=$side_number
                    [/gold]
                    [object]
                      silent=yes
                      [effect]
                        apply_to=hitpoints
                        increase_total=0
                        heal_full=yes
                      [/effect]
                      [effect]
                        apply_to=status
                        remove=poisoned
                      [/effect]
                      [effect]
                        apply_to=status
                        remove=slowed
                      [/effect]
                    [/object]
                  [/then]
                [/if]
                {CLEAR_VARIABLE healed}
              [/command]
            [/option]
            {SURVIVALX_SHOP_ITEMS}
            {SURVIVALX_SHOP_ENHANCEMENTS_OLD}
            {SURVIVALX_SHOP_WEAPONS}
            {SURVIVALX_SHOP_ARMORY}
            {SURVIVALX_SHOP_MOVEMENTS}
            {SURVIVALX_SHOP_SPECIALS}
            {SURVIVALX_SHOP_ABILITIES_OLD}
          [/message]
          [redraw]
          [/redraw]
        [/do]
      [/while]
      {VARIABLE_OP weapon_count add -1}
      [while]
        [variable]
          name=bought_$weapon_count
          equals=new
        [/variable]
        [do]
          {CLEAR_VARIABLE bought_$weapon_count}
          {VARIABLE_OP weapon_count add -1}
        [/do]
      [/while]
      {CLEAR_VARIABLE weapon_count}
      {CLEAR_VARIABLE healed}
      {CLEAR_VARIABLE blue_potion_session}
      {CLEAR_VARIABLE red_potion_session}
      {CLEAR_VARIABLE yellow_potion_session}
      {CLEAR_VARIABLE ancient_shop_session}
      {CLEAR_VARIABLE arcane_session}
      {CLEAR_VARIABLE blade_session}
      {CLEAR_VARIABLE cold_session}
      {CLEAR_VARIABLE fire_session}
      {CLEAR_VARIABLE impact_session}
      {CLEAR_VARIABLE pierce_session}
      {CLEAR_VARIABLE lefty}
      {CLEAR_VARIABLE mc_canyon_session}
      {CLEAR_VARIABLE mc_castle_session}
      {CLEAR_VARIABLE mc_cave_session}
      {CLEAR_VARIABLE mc_cavewall_session}
      {CLEAR_VARIABLE mc_deep_water_session}
      {CLEAR_VARIABLE mc_forest_session}
      {CLEAR_VARIABLE mc_fungus_session}
      {CLEAR_VARIABLE mc_grassland_session}
      {CLEAR_VARIABLE mc_hills_session}
      {CLEAR_VARIABLE mc_mountains_session}
      {CLEAR_VARIABLE mc_sand_session}
      {CLEAR_VARIABLE mc_shallow_water_session}
      {CLEAR_VARIABLE mc_swamp_water_session}
      {CLEAR_VARIABLE mc_tundra_session}
      {CLEAR_VARIABLE mc_village_session}
      {CLEAR_VARIABLE mc_canyon}
      {CLEAR_VARIABLE mc_castle}
      {CLEAR_VARIABLE mc_cave}
      {CLEAR_VARIABLE mc_cavewall}
      {CLEAR_VARIABLE mc_deep_water}
      {CLEAR_VARIABLE mc_forest}
      {CLEAR_VARIABLE mc_fungus}
      {CLEAR_VARIABLE mc_grassland}
      {CLEAR_VARIABLE mc_hills}
      {CLEAR_VARIABLE mc_mountains}
      {CLEAR_VARIABLE mc_sand}
      {CLEAR_VARIABLE mc_shallow_water}
      {CLEAR_VARIABLE mc_swamp_water}
      {CLEAR_VARIABLE mc_tundra}
      {CLEAR_VARIABLE mc_village}
      {CLEAR_VARIABLE moveleft}
      {CLEAR_VARIABLE finished}
      {CLEAR_VARIABLE TempGoldStore1}
      {CLEAR_VARIABLE TempGoldStore2}
      {CLEAR_VARIABLE TempGoldStore3}
      {CLEAR_VARIABLE TempGoldStore4}
      {CLEAR_VARIABLE TempGoldStore5}
      {CLEAR_VARIABLE playername1}
      {CLEAR_VARIABLE playername2}
      {CLEAR_VARIABLE playername3}
      {CLEAR_VARIABLE playername4}
      {CLEAR_VARIABLE playername5}
    [/command]
  [/set_menu_item]
#enddef

#-------------------------------------------------------------
# This pops up an option window after the first player's move,
# giving him the possiblity to choose his prefered difficulty
# grade.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#-------------------------------------------------------------
#define SURVIVALX_CHOOSE_DIFFICULTY
  [event]
    name=moveto
    first_time_only=yes
    [filter]
      side=1,2,3,4,5
    [/filter]
    [message]
      speaker=narrator
      message= _ "Choose the difficulty. Your setting will affect the amount of gold you will gain by killing enemies, as well as their toughness and strength. However, choose your difficulty carefully as you can't change it anymore later."
      [option]
        message= _ "*~<0,128,255>Simple"
        [command]
          {VARIABLE killbonus_0_0 7}
          {VARIABLE killbonus_0_1 14}
          {VARIABLE killbonus_0_2 16}
          {VARIABLE killbonus_0_3 18}
          {VARIABLE killbonus_0_4 21}
          {VARIABLE killbonus_0_5 23}
          {VARIABLE killbonus_1_0 15}
          {VARIABLE killbonus_1_1 20}
          {VARIABLE killbonus_1_2 24}
          {VARIABLE killbonus_1_3 29}
          {VARIABLE killbonus_1_4 34}
          {VARIABLE killbonus_1_5 39}
          {VARIABLE killbonus_2_0 18}
          {VARIABLE killbonus_2_1 23}
          {VARIABLE killbonus_2_2 33}
          {VARIABLE killbonus_2_3 40}
          {VARIABLE killbonus_2_4 48}
          {VARIABLE killbonus_2_5 55}
          {VARIABLE_OP brutal add -5}
          [sound]
            name=dragonstick.ogg
          [/sound]
          [print]
            text=Difficulty: SIMPLE
            size=24
            duration=500
            red,green,blue=0,128,255
          [/print]
          {VARIABLE difficulty 50}
          {VARIABLE text "***~<0,128,255>Difficulty: SIMPLE"}
        [/command]
      [/option]
      [option]
        message= _ "*~<0,200,0>Easy"
        [command]
          {VARIABLE killbonus_0_0 6}
          {VARIABLE killbonus_0_1 12}
          {VARIABLE killbonus_0_2 14}
          {VARIABLE killbonus_0_3 16}
          {VARIABLE killbonus_0_4 19}
          {VARIABLE killbonus_0_5 21}
          {VARIABLE killbonus_1_0 13}
          {VARIABLE killbonus_1_1 18}
          {VARIABLE killbonus_1_2 22}
          {VARIABLE killbonus_1_3 27}
          {VARIABLE killbonus_1_4 32}
          {VARIABLE killbonus_1_5 37}
          {VARIABLE killbonus_2_0 16}
          {VARIABLE killbonus_2_1 21}
          {VARIABLE killbonus_2_2 31}
          {VARIABLE killbonus_2_3 38}
          {VARIABLE killbonus_2_4 45}
          {VARIABLE killbonus_2_5 52}
          {VARIABLE_OP brutal add 0}
          [sound]
            name=dragonstick.ogg
          [/sound]
          [print]
            text=Difficulty: EASY
            size=24
            duration=500
            red,green,blue=0,200,0
          [/print]
          {VARIABLE difficulty 75}
          {VARIABLE text "***~<0,200,0>Difficulty: EASY"}
        [/command]
      [/option]
      [option]
        message= _ "*~<255,255,0>Normal"
        [command]
          {VARIABLE killbonus_0_0 5}
          {VARIABLE killbonus_0_1 10}
          {VARIABLE killbonus_0_2 12}
          {VARIABLE killbonus_0_3 14}
          {VARIABLE killbonus_0_4 17}
          {VARIABLE killbonus_0_5 19}
          {VARIABLE killbonus_1_0 11}
          {VARIABLE killbonus_1_1 16}
          {VARIABLE killbonus_1_2 20}
          {VARIABLE killbonus_1_3 25}
          {VARIABLE killbonus_1_4 30}
          {VARIABLE killbonus_1_5 35}
          {VARIABLE killbonus_2_0 14}
          {VARIABLE killbonus_2_1 19}
          {VARIABLE killbonus_2_2 29}
          {VARIABLE killbonus_2_3 36}
          {VARIABLE killbonus_2_4 43}
          {VARIABLE killbonus_2_5 50}
          {VARIABLE_OP brutal add 5}
          [sound]
            name=dragonstick.ogg
          [/sound]
          [print]
            text=Difficulty: NORMAL
            size=24
            duration=500
            red,green,blue=255,255,0
          [/print]
          {VARIABLE difficulty 100}
          {VARIABLE text "***~<255,255,0>Difficulty: NORMAL"}
        [/command]
      [/option]
      [option]
        message= _ "*~<255,128,0>Hard"
        [command]
          {VARIABLE killbonus_0_0 4}
          {VARIABLE killbonus_0_1 8}
          {VARIABLE killbonus_0_2 10}
          {VARIABLE killbonus_0_3 12}
          {VARIABLE killbonus_0_4 15}
          {VARIABLE killbonus_0_5 17}
          {VARIABLE killbonus_1_0 9}
          {VARIABLE killbonus_1_1 14}
          {VARIABLE killbonus_1_2 18}
          {VARIABLE killbonus_1_3 23}
          {VARIABLE killbonus_1_4 28}
          {VARIABLE killbonus_1_5 33}
          {VARIABLE killbonus_2_0 12}
          {VARIABLE killbonus_2_1 17}
          {VARIABLE killbonus_2_2 27}
          {VARIABLE killbonus_2_3 34}
          {VARIABLE killbonus_2_4 41}
          {VARIABLE killbonus_2_5 48}
          {VARIABLE_OP brutal add 10}
          [sound]
            name=dragonstick.ogg
          [/sound]
          [print]
            text=Difficulty: HARD
            size=24
            duration=500
            red,green,blue=255,128,0
          [/print]
          {VARIABLE difficulty 125}
          {VARIABLE text "***~<255,128,0>Difficulty: HARD"}
        [/command]
      [/option]
      [option]
        message= _ "*~<255,0,0>Xtreme"
        [command]
          {VARIABLE killbonus_0_0 3}
          {VARIABLE killbonus_0_1 6}
          {VARIABLE killbonus_0_2 8}
          {VARIABLE killbonus_0_3 10}
          {VARIABLE killbonus_0_4 13}
          {VARIABLE killbonus_0_5 15}
          {VARIABLE killbonus_1_0 7}
          {VARIABLE killbonus_1_1 12}
          {VARIABLE killbonus_1_2 16}
          {VARIABLE killbonus_1_3 21}
          {VARIABLE killbonus_1_4 26}
          {VARIABLE killbonus_1_5 31}
          {VARIABLE killbonus_2_0 10}
          {VARIABLE killbonus_2_1 18}
          {VARIABLE killbonus_2_2 25}
          {VARIABLE killbonus_2_3 32}
          {VARIABLE killbonus_2_4 39}
          {VARIABLE killbonus_2_5 46}
          {VARIABLE_OP brutal add 15}
          [sound]
            name=dragonstick.ogg
          [/sound]
          [print]
            text=Difficulty: XTREME
            size=32
            duration=750
            red,green,blue=255,0,0
          [/print]
          {VARIABLE difficulty 150}
          {VARIABLE text "***~<255,0,0>Difficulty: XTREME"}
          [music]
            name=frantic.ogg
            play_once=yes
            immediate=yes
          [/music]
        [/command]
      [/option]
      [option]
        message= _ "*~<128,0,128>Mad Mode"
        [command]
          {VARIABLE killbonus_0_0 3}
          {VARIABLE killbonus_0_1 5}
          {VARIABLE killbonus_0_2 7}
          {VARIABLE killbonus_0_3 9}
          {VARIABLE killbonus_0_4 11}
          {VARIABLE killbonus_0_5 13}
          {VARIABLE killbonus_1_0 6}
          {VARIABLE killbonus_1_1 10}
          {VARIABLE killbonus_1_2 14}
          {VARIABLE killbonus_1_3 18}
          {VARIABLE killbonus_1_4 22}
          {VARIABLE killbonus_1_5 26}
          {VARIABLE killbonus_2_0 9}
          {VARIABLE killbonus_2_1 15}
          {VARIABLE killbonus_2_2 21}
          {VARIABLE killbonus_2_3 27}
          {VARIABLE killbonus_2_4 33}
          {VARIABLE killbonus_2_5 39}
          {VARIABLE_OP brutal add 20}
          [sound]
            name=dragonstick.ogg
          [/sound]
          [print]
            text=Difficulty: MAD MODE
            size=40
            duration=1000
            red,green,blue=128,0,128
          [/print]
          {VARIABLE difficulty 200}
          {VARIABLE text "***~<128,0,128>Difficulty: MAD MODE"}
          [music]
            name=frantic.ogg
            play_once=yes
            immediate=yes
          [/music]
        [/command]
      [/option]
    [/message]
    [redraw]
    [/redraw]
    [delay]
      time=1000
    [/delay]
    [message]
      speaker=narrator
      message= _ "$text|"
    [/message]
    {CLEAR_VARIABLE text}
  [/event]
#enddef

# [message]
#   speaker=unit
#   message= _ "I have lived a good life. Death no longer scares me, we choose MAD MODE!"
# [/message]


#--------------------------------------------------------------
# This places a chest that contains a fixed amount of gold.
# Usage: X Y are the coordinates where the chest should appear.
#        AMOUNT is the amount of gold stored in the chest.
# Changes by -stf-: Logically - if chest contains gold, that is
#        divided between players, it should be really divided,
#        so 5 players get 1/5 each, 4 players 1/4 each and so
#        on until 1 player gets full amount of gold from chest.
#        I changed this so it's first multiplied by 5 and then
#        divided between all players that are still alive.
#        Remainder after dividing full amount of gold will get
#        player, who found the chest. This should help players
#        to continue and possibly win scenario if some players
#        died on their mission.
#--------------------------------------------------------------
#define SURVIVALX_CHEST_GOLD X Y AMOUNT
  [item]
    x,y={X},{Y}
    image=items/chest-plain-closed.png
  [/item]

  [event]
    name=moveto
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
    [/filter]
    [store_unit]
      variable=chests
      [filter]
        x,y={X},{Y}
      [/filter]
    [/store_unit]
    [removeitem]
    [/removeitem]
    {VARIABLE chest_gold {AMOUNT}}
    {VARIABLE_OP chest_gold multiply 5}
    {VARIABLE divider 0}
    [if]
      [have_unit]
        side=1
        canrecruit=1
      [/have_unit]
      [then]
        {VARIABLE_OP divider add 1}
      [/then]
    [/if]
    [if]
      [have_unit]
        side=2
        canrecruit=1
      [/have_unit]
      [then]
        {VARIABLE_OP divider add 1}
      [/then]
    [/if]
    [if]
      [have_unit]
        side=3
        canrecruit=1
      [/have_unit]
      [then]
        {VARIABLE_OP divider add 1}
      [/then]
    [/if]
    [if]
      [have_unit]
        side=4
        canrecruit=1
      [/have_unit]
      [then]
        {VARIABLE_OP divider add 1}
      [/then]
    [/if]
    [if]
      [have_unit]
        side=5
        canrecruit=1
      [/have_unit]
      [then]
        {VARIABLE_OP divider add 1}
      [/then]
    [/if]
    {VARIABLE remainder $chest_gold}
    {VARIABLE share_gold $chest_gold}
    {VARIABLE_OP remainder modulo $divider}
    {VARIABLE_OP share_gold divide $divider}
    [if]
      [variable]
        name=remainder
        numerical_not_equals=0
      [/variable]
      [then]
        {VARIABLE remainder_text "
Remaining $remainder gold gained player $side_number"}
      [/then]
    [/if]
    [if]
      [variable]
        name=divider
        numerical_equals=1
      [/variable]
      [then]
        [print]
          text= _ "This chest contains $chest_gold gold!
   Player $side_number gained $share_gold gold."
          size=18
          duration=500
          red,green,blue=255,255,0
        [/print]
      [/then]
      [else]
        [print]
          text= _ "   This chest contains $chest_gold gold!
   Every player gained $share_gold gold.$remainder_text"
          size=18
          duration=500
          red,green,blue=255,255,0
        [/print]
      [/else]
    [/if]
    [if]
      [have_unit]
        side=1
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=1
          amount=$share_gold
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=2
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=2
          amount=$share_gold
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=3
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=3
          amount=$share_gold
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=4
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=4
          amount=$share_gold
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=5
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=5
          amount=$share_gold
        [/gold]
      [/then]
    [/if]
    [gold]
      side=$chests.side
      amount=$remainder
    [/gold]
    [unstore_unit]
      variable=chests
      text=$remainder
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=1
        canrecruit=1
      [/filter]
      variable=chest_leader_1
    [/store_unit]
    [unstore_unit]
      variable=chest_leader_1
      text=$share_gold
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=2
        canrecruit=1
      [/filter]
      variable=chest_leader_2
    [/store_unit]
    [unstore_unit]
      variable=chest_leader_2
      text=$share_gold
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=3
        canrecruit=1
      [/filter]
      variable=chest_leader_3
    [/store_unit]
    [unstore_unit]
      variable=chest_leader_3
      text=$share_gold
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=4
        canrecruit=1
      [/filter]
      variable=chest_leader_4
    [/store_unit]
    [unstore_unit]
      variable=chest_leader_4
      text=$share_gold
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=5
        canrecruit=1
      [/filter]
      variable=chest_leader_5
    [/store_unit]
    [unstore_unit]
      variable=chest_leader_5
      text=$share_gold
      red,green,blue=255,255,0
    [/unstore_unit]
    [sound]
      name=gold.ogg
    [/sound]
    {CLEAR_VARIABLE chest_gold}
    {CLEAR_VARIABLE share_gold}
    {CLEAR_VARIABLE remainder}
    {CLEAR_VARIABLE remainder_text}
    {CLEAR_VARIABLE divider}
  [/event]
#enddef

#-------------------------------------------------------------
# This places a chest with a fixed amount of gold.
# It only appears when a player dies, however, and should not
# be used regularly. The death event of a player handles this.
#-------------------------------------------------------------
#define SURVIVALX_CHEST_DEATH_GOLD X Y AMOUNT ID
  [item]
    x,y={X},{Y}
    image=items/chest-plain-closed.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=dead_gold_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/chest-plain-closed.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
    [/filter]
    [if]
      [variable]
        name=dead_gold_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [store_unit]
          variable=chests
          [filter]
            x,y={X},{Y}
          [/filter]
        [/store_unit]
        [sound]
          name=open-chest.wav
        [/sound]
        [message]
          speaker=narrator
          image=items/gold-coins-small.png.png
          message= _ "You found chest containing {AMOUNT} gold.
    What you want to do with it?"
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "I'll share with party"
            [command]
              [removeitem]
              [/removeitem]
              {VARIABLE chest_gold {AMOUNT}}
              {VARIABLE divider 0}
              [if]
                [have_unit]
                  side=1
                  canrecruit=1
                [/have_unit]
                [then]
                  {VARIABLE_OP divider add 1}
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=2
                  canrecruit=1
                [/have_unit]
                [then]
                  {VARIABLE_OP divider add 1}
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=3
                  canrecruit=1
                [/have_unit]
                [then]
                  {VARIABLE_OP divider add 1}
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=4
                  canrecruit=1
                [/have_unit]
                [then]
                  {VARIABLE_OP divider add 1}
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=5
                  canrecruit=1
                [/have_unit]
                [then]
                  {VARIABLE_OP divider add 1}
                [/then]
              [/if]
              {VARIABLE remainder $chest_gold}
              {VARIABLE share_gold $chest_gold}
              {VARIABLE_OP remainder modulo $divider}
              {VARIABLE_OP share_gold divide $divider}
              [if]
                [variable]
                  name=remainder
                  numerical_not_equals=0
                [/variable]
                [then]
                  {VARIABLE remainder_text "
Remaining $remainder gold gained player $side_number"}
                [/then]
              [/if]
              [if]
                [variable]
                  name=divider
                  numerical_equals=1
                [/variable]
                [then]
                  [print]
                    text= _ "Player $side_number gained $share_gold gold."
                    size=18
                    duration=500
                    red,green,blue=255,255,0
                  [/print]
                [/then]
                [else]
                  [print]
                    text= _ "   Every player gained $share_gold gold.$remainder_text"
                    size=18
                    duration=500
                    red,green,blue=255,255,0
                  [/print]
                [/else]
              [/if]
              [if]
                [have_unit]
                  side=1
                  canrecruit=1
                [/have_unit]
                [then]
                  [gold]
                    side=1
                    amount=$share_gold
                  [/gold]
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=2
                  canrecruit=1
                [/have_unit]
                [then]
                  [gold]
                    side=2
                    amount=$share_gold
                  [/gold]
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=3
                  canrecruit=1
                [/have_unit]
                [then]
                  [gold]
                    side=3
                    amount=$share_gold
                  [/gold]
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=4
                  canrecruit=1
                [/have_unit]
                [then]
                  [gold]
                    side=4
                    amount=$share_gold
                  [/gold]
                [/then]
              [/if]
              [if]
                [have_unit]
                  side=5
                  canrecruit=1
                [/have_unit]
                [then]
                  [gold]
                    side=5
                    amount=$share_gold
                  [/gold]
                [/then]
              [/if]
              [gold]
                side=$chests.side
                amount=$remainder
              [/gold]
              [unstore_unit]
                variable=chests
                text=$remainder
                red,green,blue=255,255,0
              [/unstore_unit]
              [store_unit]
                [filter]
                  side=1
                  canrecruit=1
                [/filter]
                variable=chest_leader_1
              [/store_unit]
              [unstore_unit]
                variable=chest_leader_1
                text=$share_gold
                red,green,blue=255,255,0
              [/unstore_unit]
              [store_unit]
                [filter]
                  side=2
                  canrecruit=1
                [/filter]
                variable=chest_leader_2
              [/store_unit]
              [unstore_unit]
                variable=chest_leader_2
                text=$share_gold
                red,green,blue=255,255,0
              [/unstore_unit]
              [store_unit]
                [filter]
                  side=3
                  canrecruit=1
                [/filter]
                variable=chest_leader_3
              [/store_unit]
              [unstore_unit]
                variable=chest_leader_3
                text=$share_gold
                red,green,blue=255,255,0
              [/unstore_unit]
              [store_unit]
                [filter]
                  side=4
                  canrecruit=1
                [/filter]
                variable=chest_leader_4
              [/store_unit]
              [unstore_unit]
                variable=chest_leader_4
                text=$share_gold
                red,green,blue=255,255,0
              [/unstore_unit]
              [store_unit]
                [filter]
                  side=5
                  canrecruit=1
                [/filter]
                variable=chest_leader_5
              [/store_unit]
              [unstore_unit]
                variable=chest_leader_5
                text=$share_gold
                red,green,blue=255,255,0
              [/unstore_unit]
              [sound]
                name=gold.ogg
              [/sound]
              {CLEAR_VARIABLE chest_gold}
              {CLEAR_VARIABLE share_gold}
              {CLEAR_VARIABLE remainder}
              {CLEAR_VARIABLE remainder_text}
              {CLEAR_VARIABLE divider}
              {VARIABLE dead_gold_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
          [option]
            message= _ "I'll take it for myself"
            [command]
              [removeitem]
              [/removeitem]
              [gold]
                side=$chests.side
                amount={AMOUNT}
              [/gold]
              [unstore_unit]
                variable=chests
                text={AMOUNT}
                red,green,blue=255,255,0
              [/unstore_unit]
              [print]
                text= _ "Player $side_number gained $share_gold gold."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [sound]
                name=gold.ogg
              [/sound]
              {VARIABLE dead_gold_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#--------------------------------------------------------------
# This places a chest with a magical ring. This ring raises
# it's owner's defense in every terrain by 10%, and is very
# valueful. There should not be more than 2 rings available
# for normal units in each map, or else there is the danger
# of the player becoming unhitable.
# Usage: X Y are the coordinates where the chest should appear.
#--------------------------------------------------------------
#define SURVIVALX_CHEST_DEFRING X Y
  [item]
    x,y={X},{Y}
    image=items/ring-gold.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=defense_ring_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ring-gold.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=defense_ring_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ring-gold.png
          speaker=narrator
          message= _ "You found a glowing little ring...
This magical ring can help you to avoid your enemies' attacks.
It increases owner's defenses for all terrains by 10%"
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use gold ring of defense"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found gold ring of defense."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {SURVIVALX_UNIT_DEFENSE $side_number -10}
              {VARIABLE_OP "unit_defense_$side_number" add -10}
              {VARIABLE defense_ring_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_DEFRING_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/ring-gold.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=defense_ring_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ring-gold.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=defense_ring_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ring-gold.png
          speaker=narrator
          message= _ "You found a glowing little ring...
This magical ring can help you to avoid your enemies' attacks.
It increases owner's defenses for all terrains by 10%"
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use gold ring of defense"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found gold ring of defense."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {SURVIVALX_UNIT_DEFENSE $side_number -10}
              {VARIABLE_OP "unit_defense_$side_number" add -10}
              {VARIABLE defense_ring_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#--------------------------------------------------------------
# This places a chest with a magical ring. This ring raises
# it's owner's resistance in every category by 10%, and is very
# valueful.
# Usage: X Y are the coordinates where the chest should appear.
#--------------------------------------------------------------

#define SURVIVALX_CHEST_RESRING X Y
  [item]
    x,y={X},{Y}
    image=items/ring-white.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=resistance_ring_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ring-white.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=resistance_ring_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ring-white.png
          speaker=narrator
          message= _ "You found a glowing little ring...
This magical ring can increase your resistances by 10%"
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use white ring of resistance"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found white ring of resistance."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.arcane add -10}
              {VARIABLE_OP resistance_upgrade_arcane_$side_number add -10}
              {VARIABLE_OP resist.resistance.blade add -10}
              {VARIABLE_OP resistance_upgrade_blade_$side_number add -10}
              {VARIABLE_OP resist.resistance.cold add -10}
              {VARIABLE_OP resistance_upgrade_cold_$side_number add -10}
              {VARIABLE_OP resist.resistance.fire add -10}
              {VARIABLE_OP resistance_upgrade_fire_$side_number add -10}
              {VARIABLE_OP resist.resistance.impact add -10}
              {VARIABLE_OP resistance_upgrade_impact_$side_number add -10}
              {VARIABLE_OP resist.resistance.pierce add -10}
              {VARIABLE_OP resistance_upgrade_pierce_$side_number add -10}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE resistance_ring_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_RESRING_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/ring-white.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=resistance_ring_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ring-white.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=resistance_ring_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ring-white.png
          speaker=narrator
          message= _ "You found a glowing little ring...
This magical ring can increase your resistances by 10%"
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use white ring of resistance"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found white ring of resistance."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.arcane add -10}
              {VARIABLE_OP resistance_upgrade_arcane_$side_number add -10}
              {VARIABLE_OP resist.resistance.blade add -10}
              {VARIABLE_OP resistance_upgrade_blade_$side_number add -10}
              {VARIABLE_OP resist.resistance.cold add -10}
              {VARIABLE_OP resistance_upgrade_cold_$side_number add -10}
              {VARIABLE_OP resist.resistance.fire add -10}
              {VARIABLE_OP resistance_upgrade_fire_$side_number add -10}
              {VARIABLE_OP resist.resistance.impact add -10}
              {VARIABLE_OP resistance_upgrade_impact_$side_number add -10}
              {VARIABLE_OP resist.resistance.pierce add -10}
              {VARIABLE_OP resistance_upgrade_pierce_$side_number add -10}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE resistance_ring_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#--------------------------------------------------------------
# This places a green cloak. This cloak reduce
# it's owner's movement costs in every category to 1, and is very
# valueful.
# Usage: X Y are the coordinates where the chest should appear.
#--------------------------------------------------------------

#define SURVIVALX_CHEST_CLOAK X Y
  [item]
    x,y={X},{Y}
    image=items/cloak-green.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=cloak_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/cloak-green.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=cloak_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/cloak-green.png
          speaker=narrator
          message= _ "You found a Green Cloak...
This magical Cloak can reduce your Movement Costs in every
Category to 1. You feel as if you were flying."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Green Cloak"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Green Cloak."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                silent=yes
                [effect]
                  apply_to=movement_costs
                  replace=yes
                  [movement_costs]
                    deep_water=1
                    shallow_water=1
                    swamp_water=1
                    grassland=1
                    sand=1
                    forest=1
                    hills=1
                    mountains=1
                    village=1
                    castle=1
                    cave=1
                    tundra=1
                    canyon=1
                    cavewall=100
                    fungus=1
                  [/movement_costs]
                [/effect]
              [/object]
              {VARIABLE cloak_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_CLOAK_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/cloak-green.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=cloak_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/cloak-green.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=cloak_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/cloak-green.png
          speaker=narrator
          message= _ "You found a Green Cloak...
This magical Cloak can reduce your Movement Costs in every
Category to 1. You feel as if you were flying."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Green Cloak"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Green Cloak."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                silent=yes
                [effect]
                  apply_to=movement_costs
                  replace=yes
                  [movement_costs]
                    deep_water=1
                    shallow_water=1
                    swamp_water=1
                    grassland=1
                    sand=1
                    forest=1
                    hills=1
                    mountains=1
                    village=1
                    castle=1
                    cave=1
                    tundra=1
                    canyon=1
                    cavewall=100
                    fungus=1
                  [/movement_costs]
                [/effect]
              [/object]
              {VARIABLE cloak_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#--------------------------------------------------------------
# This places the Cornucopia of Fortune. This Item increases
# the income from kills by 20% and is very
# valueful.
# Usage: X Y are the coordinates where the chest should appear.
#--------------------------------------------------------------

#define SURVIVALX_CHEST_CORNUCOPIA X Y
  [item]
    x,y={X},{Y}
    image=items/ornate2.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=cornucopia_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ornate2.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=cornucopia_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ornate2.png
          speaker=narrator
          message= _ "You found the legendary Cornucopia of Fortune.
It can increase income from kills by 20 Percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Cornucopia of Fortune"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Cornucopia of Fortune.
Income from kills is raised by 20 Percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE cornucopia_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_CORNUCOPIA_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/ornate2.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=cornucopia_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ornate2.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=cornucopia_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ornate2.png
          speaker=narrator
          message= _ "You found the legendary Cornucopia of Fortune.
It can increase income from kills by 20 Percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Cornucopia of Fortune"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Cornucopia of Fortune.
Income from kills is raised by 20 Percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE cornucopia_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#--------------------------------------------------------------
# This places the Ancient Sceptre of Cantar. This Item increases
# the damage of adjacent own and allied units by 50% and is very
# valueful.
# Usage: X Y are the coordinates where the chest should appear.
#--------------------------------------------------------------

#define SURVIVALX_CHEST_SCEPTRE X Y
  [item]
    x,y={X},{Y}
    image=items/sceptre-of-fire.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=sceptre_of_cantar_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/sceptre-of-fire.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=sceptre_of_cantar_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/sceptre-of-fire.png
          speaker=narrator
          message= _ "You found the Ancient Sceptre of Cantar. Damage of it's owner
     and adjacent allied units is increased by 25 Percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Sceptre of Cantar"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ " Player $side_number found Sceptre of Cantar.
His damage and damage of adjacent allied units
         is increased by 25 percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=sceptre_cantar
                      value=25
                      cumulative=no
                      name= _ "sceptre of cantar"
                      description= _ "The Ancient Sceptre of Cantar:
increases damage of self, adjacent own and allied units by 25 Percent. It is a non-cumulative leadership ability."
                      affect_self=yes
                      affect_allies=yes
                      affect_enemies=no
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
                silent=yes
              [/object]
              {VARIABLE sceptre_of_cantar_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_SCEPTRE_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/sceptre-of-fire.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=sceptre_of_cantar_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/sceptre-of-fire.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=sceptre_of_cantar_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/sceptre-of-fire.png
          speaker=narrator
          message= _ "You found the Ancient Sceptre of Cantar. Damage of it's owner
     and adjacent allied units is increased by 25 Percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Sceptre of Cantar"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ " Player $side_number found Sceptre of Cantar.
His damage and damage of adjacent allied units
         is increased by 25 percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=sceptre_cantar
                      value=25
                      cumulative=no
                      name= _ "sceptre of cantar"
                      description= _ "The Ancient Sceptre of Cantar:
increases damage of self, adjacent own and allied units by 25 Percent. It is a non-cumulative leadership ability."
                      affect_self=yes
                      affect_allies=yes
                      affect_enemies=no
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
                silent=yes
              [/object]
              {VARIABLE sceptre_of_cantar_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_SWORD X Y
  [item]
    x,y={X},{Y}
    image=items/flame-sword.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=sword_of_crusader_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/flame-sword.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=sword_of_crusader_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/flame-sword.png
          speaker=narrator
          message= _ " You found the Holy Sword of the Crusader. Damage of it's
owner and adjacend allied units is increased by 25 percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Sceptre of Cantar"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Sword of the Crusader.
 His damage and damage of adjacent allied units
          is increased by 25 percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=sword_crusader
                      value=25
                      cumulative=no
                      name= _ "sword of the crusader"
                      description= _ "The Holy Sword of the Crusader:
increases damage of self, adjacent own and allied units by 25 Percent. It is a non-cumulative leadership ability."
                      affect_self=yes
                      affect_allies=yes
                      affect_enemies=no
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
                silent=yes
              [/object]
              {VARIABLE sword_of_crusader_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_SWORD_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/flame-sword.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=sword_of_crusader_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/flame-sword.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=sword_of_crusader_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/flame-sword.png
          speaker=narrator
          message= _ " You found the Holy Sword of the Crusader. Damage of it's
owner and adjacend allied units is increased by 25 percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Sceptre of Cantar"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Sword of the Crusader.
 His damage and damage of adjacent allied units
          is increased by 25 percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=sword_crusader
                      value=25
                      cumulative=no
                      name= _ "sword of the crusader"
                      description= _ "The Holy Sword of the Crusader:
increases damage of self, adjacent own and allied units by 25 Percent. It is a non-cumulative leadership ability."
                      affect_self=yes
                      affect_allies=yes
                      affect_enemies=no
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
                silent=yes
              [/object]
              {VARIABLE sword_of_crusader_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_BOW X Y
  [item]
    x,y={X},{Y}
    image=items/bow-crystal.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=bow_of_hunter_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/bow-crystal.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=bow_of_hunter_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/bow-crystal.png
          speaker=narrator
          message= _ " You found the Crystal Bow of the Hunter. Damage of it's
owner and adjacend allied units is increased by 25 percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Sceptre of Cantar"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Bow of the Hunter.
 His damage and damage of adjacent allied units
          is increased by 25 percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=crystal_bow
                      value=25
                      cumulative=no
                      name= _ "bow of the hunter"
                      description= _ "Crystal Bow of the Hunter:
increases damage of self, adjacent own and allied units by 25 Percent. It is a non-cumulative leadership ability."
                      affect_self=yes
                      affect_allies=yes
                      affect_enemies=no
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
                silent=yes
              [/object]
              {VARIABLE bow_of_hunter_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_BOW_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/bow-crystal.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=bow_of_hunter_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/bow-crystal.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=bow_of_hunter_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/bow-crystal.png
          speaker=narrator
          message= _ " You found the Crystal Bow of the Hunter. Damage of it's
owner and adjacend allied units is increased by 25 percent."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Sceptre of Cantar"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Bow of the Hunter.
 His damage and damage of adjacent allied units
          is increased by 25 percent."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [object]
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=crystal_bow
                      value=25
                      cumulative=no
                      name= _ "bow of the hunter"
                      description= _ "Crystal Bow of the Hunter:
increases damage of self, adjacent own and allied units by 25 Percent. It is a non-cumulative leadership ability."
                      affect_self=yes
                      affect_allies=yes
                      affect_enemies=no
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
                silent=yes
              [/object]
              {VARIABLE bow_of_hunter_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_NECKLACE X Y
  [item]
    x,y={X},{Y}
    image=items/ankh-necklace.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=necklace_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ankh-necklace.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=necklace_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ankh-necklace.png
          speaker=narrator
          message= _ "You found the Silver Necklace of Protection.
It's bearer receives a Circle of Protection,
which grants a bonus of 20 percent to fire,
        cold and arcane resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Necklace of Protection"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Necklace of Protection."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.arcane add -20}
              {VARIABLE_OP resistance_upgrade_arcane_$side_number add -20}
              {VARIABLE_OP resist.resistance.cold add -20}
              {VARIABLE_OP resistance_upgrade_cold_$side_number add -20}
              {VARIABLE_OP resist.resistance.fire add -20}
              {VARIABLE_OP resistance_upgrade_fire_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE necklace_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_NECKLACE_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/ankh-necklace.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=necklace_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ankh-necklace.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=necklace_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ankh-necklace.png
          speaker=narrator
          message= _ "You found the Silver Necklace of Protection.
It's bearer receives a Circle of Protection,
which grants a bonus of 20 percent to fire,
        cold and arcane resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Necklace of Protection"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Necklace of Protection."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.arcane add -20}
              {VARIABLE_OP resistance_upgrade_arcane_$side_number add -20}
              {VARIABLE_OP resist.resistance.cold add -20}
              {VARIABLE_OP resistance_upgrade_cold_$side_number add -20}
              {VARIABLE_OP resist.resistance.fire add -20}
              {VARIABLE_OP resistance_upgrade_fire_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE necklace_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_ICEARMOR X Y
  [item]
    x,y={X},{Y}
    image=items/armor.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=icearmor_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/armor.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=icearmor_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/armor.png
          speaker=narrator
          message= _ "   You found the legendary IceArmor. Its bearer
receives a bonus of 20 percent to cold resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use IceArmor"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found IceArmor."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.cold add -20}
              {VARIABLE_OP resistance_upgrade_cold_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE icearmor_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_ICEARMOR_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/armor.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=icearmor_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/armor.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=icearmor_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/armor.png
          speaker=narrator
          message= _ "   You found the legendary IceArmor. Its bearer
receives a bonus of 20 percent to cold resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use IceArmor"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found IceArmor."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.cold add -20}
              {VARIABLE_OP resistance_upgrade_cold_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE icearmor_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_FIREARMOR X Y
  [item]
    x,y={X},{Y}
    image=items/armor-golden.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=firearmor_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/armor-golden.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=firearmor_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/armor-golden.png
          speaker=narrator
          message= _ "  You found the legendary FireArmor. Its bearer
recieves a bonus of 20 percent to fire resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use FireArmor"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found FireArmor."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.fire add -20}
              {VARIABLE_OP resistance_upgrade_fire_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE firearmor_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_FIREARMOR_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/armor-golden.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=firearmor_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/armor-golden.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=firearmor_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/armor-golden.png
          speaker=narrator
          message= _ "  You found the legendary FireArmor. Its bearer
recieves a bonus of 20 percent to fire resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use FireArmor"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found FireArmor."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.fire add -20}
              {VARIABLE_OP resistance_upgrade_fire_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE firearmor_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_SPIRITSTAFF X Y
  [item]
    x,y={X},{Y}
    image=items/staff-magic.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=spiritstaff_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/staff-magic.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=spiritstaff_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/staff-magic.png
          speaker=narrator
          message= _ "  You found the legendary SpiritStaff. Its bearer
receives a bonus of 20 percent to arcane resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use SpiritStaff"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found SpiritStaff."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.arcane add -20}
              {VARIABLE_OP resistance_upgrade_arcane_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE spiritstaff_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_SPIRITSTAFF_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/staff-magic.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=spiritstaff_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/staff-magic.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=spiritstaff_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/staff-magic.png
          speaker=narrator
          message= _ "  You found the legendary SpiritStaff. Its bearer
receives a bonus of 20 percent to arcane resistance."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use SpiritStaff"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found SpiritStaff."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  x,y=$x1,$y1
                  side=$side_number
                  canrecruit=yes
                [/filter]
                variable=resist
              [/store_unit]
              {VARIABLE_OP resist.resistance.arcane add -20}
              {VARIABLE_OP resistance_upgrade_arcane_$side_number add -20}
              [unstore_unit]
                variable=resist
              [/unstore_unit]
              {VARIABLE spiritstaff_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_RINGDARKNESS X Y
  [item]
    x,y={X},{Y}
    image=items/ring-red.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=ring_of_darkness_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ring-red.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=ring_of_darkness_{X}_{Y}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ring-red.png
          speaker=narrator
          message= _ "You found the Ring of Darkness. Every enemy unit
within the dark aura that sourrounds its bearer
   will suffer -25 percent on their attacks."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Ring of Darkness"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Ring of Darkness."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  side=1,2,3,4,5
                  x={X}
                  y={Y}
                [/filter]
                variable=bearer
              [/store_unit]
              [set_variable]
                name=bearer.halo
                value="dark-cleric-auras.png"
              [/set_variable]
              [unstore_unit]
                variable=bearer
              [/unstore_unit]
              [object]
                silent=yes
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=ringdarkness
                      value=-25
                      cumulative=no
                      name= _ "ring of darkness"
                      description= _ "Ring of Darkness makes all adjacent enemy units fight worse (-25% for attack)."
                      affect_self=no
                      affect_allies=no
                      affect_enemies=yes
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
              [/object]
              {VARIABLE ring_of_darkness_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_RINGDARKNESS_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/ring-red.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=ring_of_darkness_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/ring-red.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [not]
        [variable]
          name=ring_of_darkness_{X}|_{Y}|_{ID}
          numerical_equals=1
        [/variable]
      [/not]
      [then]
        [message]
          image=items/ring-red.png
          speaker=narrator
          message= _ "You found the Ring of Darkness. Every enemy unit
within the dark aura that sourrounds its bearer
   will suffer -25 percent on their attacks."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use Ring of Darkness"
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=magic-holy-1.ogg
              [/sound]
              [print]
                text= _ "Player $side_number found Ring of Darkness."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [store_unit]
                [filter]
                  side=1,2,3,4,5
                  x={X}
                  y={Y}
                [/filter]
                variable=bearer
              [/store_unit]
              [set_variable]
                name=bearer.halo
                value="dark-cleric-auras.png"
              [/set_variable]
              [unstore_unit]
                variable=bearer
              [/unstore_unit]
              [object]
                silent=yes
                [effect]
                  apply_to=new_ability
                  [abilities]
                    [leadership]
                      id=ringdarkness
                      value=-25
                      cumulative=no
                      name= _ "ring of darkness"
                      description= _ "Ring of Darkness makes all adjacent enemy units fight worse (-25% for attack)."
                      affect_self=no
                      affect_allies=no
                      affect_enemies=yes
                      [affect_adjacent]
                        adjacent=n,ne,se,s,sw,nw
                      [/affect_adjacent]
                    [/leadership]
                  [/abilities]
                [/effect]
              [/object]
              {VARIABLE ring_of_darkness_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#--------------------------------------------------------------
# This places a chest that contains a yellow potion.
# This potion increases it's finder's max HP a little and
# doubles the finder's remaining HP. Note that this also
# increases them above the max! Placing a lot of them in
# a short distance to each other thus is no good idea.
# Any kind of healing will slowly drive them back to the normal
# max., any kind of AMLA or advancing will completely take away
# this bonus.
# Usage: X Y are the coordinates where the chest should appear.
#--------------------------------------------------------------
#define SURVIVALX_CHEST_SUPER_HEALTH_POTION X Y
  [item]
    x,y={X},{Y}
    image=items/potion-yellow.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=yellow_potion_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/potion-yellow.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [variable]
        name=yellow_potion_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [message]
          image=items/potion-yellow.png
          speaker=narrator
          message= _ "You found a strange yellow potion. Drinking it will make you feel more healthy.
Your max. HP will be increased by 20 and your current HP will be doubled!
You can carry maximum of 3 potions of different types and 2 potions of same
type at a time. Currently you are carrying:
~<0,0,255>Blue potions: $blue_potion_store_$side_number
~<255,0,0>Red potions: $red_potion_store_$side_number
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number
Total number: $potions_total_store_$side_number

For using one of yellow potions, that you are carrying, right-click on your
hero and then select 'Drink Yellow Potion'."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use yellow potion"
            [command]
              [removeitem]
              [/removeitem]
              [print]
                text= _ "Player $side_number found and used yellow potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [sound]
                name=heal.wav
              [/sound]
              [object]
                [effect]
                  apply_to=status
                  remove=poisoned
                [/effect]
                [effect]
                  apply_to=status
                  remove=slowed
                [/effect]
                [effect]
                  apply_to=hitpoints
                  increase_total=20
                  violate_maximum=yes
                [/effect]
                [effect]
                  apply_to=hitpoints
                  heal_full=yes
                  violate_maximum=yes
                [/effect]
                [effect]
                  apply_to=hitpoints
                  increase=100%
                  violate_maximum=yes
                [/effect]
                silent=yes
              [/object]
              {VARIABLE yellow_potion_{X}_{Y} 1}
            [/command]
          [/option]
          [option]
            message= _ "Take yelow potion for later use"
            [show_if]
              [not]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_equals=3
                [/variable]
              [/not]
              [not]
                [variable]
                  name=yellow_potion_store_$side_number
                  numerical_equals=2
                [/variable]
              [/not]
            [/show_if]
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=fanfare-short.wav
              [/sound]
              [print]
                text= _ "Player $side_number found yellow potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE_OP yellow_potion_store_$side_number add 1}
              {VARIABLE_OP potions_total_store_$side_number add 1}
              {VARIABLE yellow_potion_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_SUPER_HEALTH_POTION_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/potion-yellow.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=yellow_potion_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/potion-yellow.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [variable]
        name=yellow_potion_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [message]
          image=items/potion-yellow.png
          speaker=narrator
          message= _ "You found a strange yellow potion. Drinking it will make you feel more healthy.
Your max. HP will be increased by 20 and your current HP will be doubled!
You can carry maximum of 3 potions of different types and 2 potions of same
type at a time. Currently you are carrying:
~<0,0,255>Blue potions: $blue_potion_store_$side_number
~<255,0,0>Red potions: $red_potion_store_$side_number
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number
Total number: $potions_total_store_$side_number

For using one of yellow potions, that you are carrying, right-click on your
hero and then select 'Drink Yellow Potion'."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use yellow potion"
            [command]
              [removeitem]
              [/removeitem]
              [print]
                text= _ "Player $side_number found and used yellow potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [sound]
                name=heal.wav
              [/sound]
              [object]
                [effect]
                  apply_to=status
                  remove=poisoned
                [/effect]
                [effect]
                  apply_to=status
                  remove=slowed
                [/effect]
                [effect]
                  apply_to=hitpoints
                  increase_total=20
                  violate_maximum=yes
                [/effect]
                [effect]
                  apply_to=hitpoints
                  heal_full=yes
                  violate_maximum=yes
                [/effect]
                [effect]
                  apply_to=hitpoints
                  increase=100%
                  violate_maximum=yes
                [/effect]
                silent=yes
              [/object]
              {VARIABLE yellow_potion_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
          [option]
            message= _ "Take yelow potion for later use"
            [show_if]
              [not]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_equals=3
                [/variable]
              [/not]
              [not]
                [variable]
                  name=yellow_potion_store_$side_number
                  numerical_equals=2
                [/variable]
              [/not]
            [/show_if]
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=fanfare-short.wav
              [/sound]
              [print]
                text= _ "Player $side_number found yellow potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE_OP yellow_potion_store_$side_number add 1}
              {VARIABLE_OP potions_total_store_$side_number add 1}
              {VARIABLE yellow_potion_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SX_DRINK_YELLOW_POTION
  [set_menu_item]
    id=SXC_Yellow_Potion
    description="Drink Yellow Potion (+20HP max., full heal, 2xHP)"
    image=icons/potion-yellow_icon.png
    [show_if]
      [variable]
        name=yellow_potion_store_$side_number
        greater_than_equal_to=1
      [/variable]
      [have_unit]
        side=$side_number
        x,y=$x1,$y1
        canrecruit=yes
      [/have_unit]
    [/show_if]
    [command]
      [store_unit]
        [filter]
          x,y=$x1,$y1
          side=$side_number
        [/filter]
        variable=drinker
      [/store_unit]
      [if]
        [variable]
          name=drinker.attacks_left
          greater_than_equal_to=1
        [/variable]
        [then]
          {VARIABLE_OP yellow_potion_store_$side_number add -1}
          {VARIABLE_OP potions_total_store_$side_number add -1}
          [sound]
            name=heal.wav
          [/sound]
          [print]
            text= _ "Player $side_number used yellow potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            [effect]
              apply_to=status
              remove=poisoned
            [/effect]
            [effect]
              apply_to=status
              remove=slowed
            [/effect]
            [effect]
              apply_to=hitpoints
              increase_total=20
              violate_maximum=yes
            [/effect]
            [effect]
              apply_to=hitpoints
              heal_full=yes
              violate_maximum=yes
            [/effect]
            [effect]
              apply_to=hitpoints
              increase=100%
              violate_maximum=yes
            [/effect]
            silent=yes
          [/object]
        [/then]
      [/if]
    [/command]
  [/set_menu_item]
#enddef

#--------------------------------------------------------------
# This places a red potion.
# This potion just heals the finder to full health, and
# disappears after its use.
# Usage: X Y are the coordinates where the potion should appear.
#--------------------------------------------------------------
#define SURVIVALX_CHEST_RED_HEALTH_POTION X Y
  [item]
    x,y={X},{Y}
    image=items/potion-red.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=red_potion_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/potion-red.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [variable]
        name=red_potion_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [message]
          image=items/potion-red.png
          speaker=narrator
          message= _ "You found a strange red potion. Drinking it will heal all your wounds. Use it
wisely. You can carry maximum of 3 potions of different types and 2 potions
of same type at a time. Currently you are carrying:

~<0,0,255>Blue potions: $blue_potion_store_$side_number
~<255,0,0>Red potions: $red_potion_store_$side_number
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number
Total number: $potions_total_store_$side_number

For using one of red potions, that you are carrying, right-click on your
hero and then select 'Drink Red Potion'."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use red potion"
            [command]
              [removeitem]
              [/removeitem]
              [print]
                text= _ "Player $side_number found and used red potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [sound]
                name=heal.wav
              [/sound]
              [object]
                [effect]
                  apply_to=status
                  remove=poisoned
                [/effect]
                [effect]
                  apply_to=status
                  remove=slowed
                [/effect]
                [effect]
                  apply_to=hitpoints
                  heal_full=yes
                  violate_maximum=yes
                [/effect]
                silent=yes
              [/object]
              {VARIABLE red_potion_{X}_{Y} 1}
            [/command]
          [/option]
          [option]
            message= _ "Take red potion for later use"
            [show_if]
              [not]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_equals=3
                [/variable]
              [/not]
              [not]
                [variable]
                  name=red_potion_store_$side_number
                  numerical_equals=2
                [/variable]
              [/not]
            [/show_if]
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=fanfare-short.wav
              [/sound]
              [print]
                text= _ "Player $side_number found red potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE_OP red_potion_store_$side_number add 1}
              {VARIABLE_OP potions_total_store_$side_number add 1}
              {VARIABLE red_potion_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_RED_HEALTH_POTION_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/potion-red.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=red_potion_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/potion-red.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [variable]
        name=red_potion_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [message]
          image=items/potion-red.png
          speaker=narrator
          message= _ "You found a strange red potion. Drinking it will heal all your wounds. Use it
wisely. You can carry maximum of 3 potions of different types and 2 potions
of same type at a time. Currently you are carrying:

~<0,0,255>Blue potions: $blue_potion_store_$side_number
~<255,0,0>Red potions: $red_potion_store_$side_number
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number
Total number: $potions_total_store_$side_number

For using one of red potions, that you are carrying, right-click on your
hero and then select 'Drink Red Potion'."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use red potion"
            [command]
              [removeitem]
              [/removeitem]
              [print]
                text= _ "Player $side_number found and used red potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [sound]
                name=heal.wav
              [/sound]
              [object]
                [effect]
                  apply_to=status
                  remove=poisoned
                [/effect]
                [effect]
                  apply_to=status
                  remove=slowed
                [/effect]
                [effect]
                  apply_to=hitpoints
                  heal_full=yes
                  violate_maximum=yes
                [/effect]
                silent=yes
              [/object]
              {VARIABLE red_potion_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
          [option]
            message= _ "Take red potion for later use"
            [show_if]
              [not]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_equals=3
                [/variable]
              [/not]
              [not]
                [variable]
                  name=red_potion_store_$side_number
                  numerical_equals=2
                [/variable]
              [/not]
            [/show_if]
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=fanfare-short.wav
              [/sound]
              [print]
                text= _ "Player $side_number found red potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE_OP red_potion_store_$side_number add 1}
              {VARIABLE_OP potions_total_store_$side_number add 1}
              {VARIABLE red_potion_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SX_DRINK_RED_POTION
  [set_menu_item]
    id=SXC_Red_Potion
    description="Drink Red Potion (Full Heal)"
    image=icons/potion-red_icon.png
    [show_if]
      [variable]
        name=red_potion_store_$side_number
        greater_than_equal_to=1
      [/variable]
      [have_unit]
        side=$side_number
        x,y=$x1,$y1
        canrecruit=yes
      [/have_unit]
    [/show_if]
    [command]
      [store_unit]
        [filter]
          x,y=$x1,$y1
          side=$side_number
        [/filter]
        variable=drinker
      [/store_unit]
      [if]
        [variable]
          name=drinker.attacks_left
          greater_than_equal_to=1
        [/variable]
        [then]
          {VARIABLE_OP red_potion_store_$side_number add -1}
          {VARIABLE_OP potions_total_store_$side_number add -1}
          [sound]
            name=heal.wav
          [/sound]
          [print]
            text= _ "Player $side_number used red potion."
            size=18
            duration=500
            red,green,blue=255,255,0
          [/print]
          [object]
            [effect]
              apply_to=status
              remove=poisoned
            [/effect]
            [effect]
              apply_to=status
              remove=slowed
            [/effect]
            [effect]
              apply_to=hitpoints
              heal_full=yes
              violate_maximum=yes
            [/effect]
            silent=yes
          [/object]
        [/then]
      [/if]
    [/command]
  [/set_menu_item]
#enddef

#--------------------------------------------------------------
# This places a blue potion.
# This potion heals the finder by 150HP and,enables further
# further move and adds 5 MP just after drinking it.
# Usage: X Y are the coordinates where the potion should appear.
#--------------------------------------------------------------
#define SURVIVALX_CHEST_BLUE_MOVE_POTION X Y
  [item]
    x,y={X},{Y}
    image=items/potion-blue.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=blue_potion_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/potion-blue.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [variable]
        name=blue_potion_{X}_{Y}
        numerical_not_equals=1
      [/variable]
      [then]
        [message]
          image=items/potion-blue.png
          speaker=narrator
          message= _ "You found a strange blue potion. Drinking it will give you 5 additional
movement points resets attack status so you can attack again and will grant
you as well 150 Hitpoints, even beyond maximum. Best use it while you have
low HP left and after you attacked first else the extra attack will be wasted.
You can carry maximum of 3 potions of different types and 2 potions of same
type at a time. Currently you are carrying:
~<0,0,255>Blue potions: $blue_potion_store_$side_number
~<255,0,0>Red potions: $red_potion_store_$side_number
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number
Total number: $potions_total_store_$side_number

For using one of blue potions, that you are carrying, right-click on your
hero and then select 'Drink Blue Potion'."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use blue potion"
            [command]
              [removeitem]
              [/removeitem]
              [print]
                text= _ "Player $side_number found and used blue potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [sound]
                name=heal.wav
              [/sound]
              [object]
                [effect]
                  apply_to=hitpoints
                  increase=150
                  violate_maximum=yes
                [/effect]
                silent=yes
              [/object]
              [store_unit]
                [filter]
                  x=$x1
                  y=$y1
                [/filter]
                variable=drinker
              [/store_unit]
              {VARIABLE drinker_movement_side $drinker.side}
              {VARIABLE_OP drinker.moves add 5}
              {VARIABLE drinker.attacks_left 1}
              [unstore_unit]
                variable=drinker
              [/unstore_unit]
              {CLEAR_VARIABLE drinker}
              {VARIABLE blue_potion_{X}_{Y} 1}
            [/command]
          [/option]
          [option]
            message= _ "Take blue potion for later use"
            [show_if]
              [not]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_equals=3
                [/variable]
              [/not]
              [not]
                [variable]
                  name=blue_potion_store_$side_number
                  numerical_equals=2
                [/variable]
              [/not]
            [/show_if]
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=fanfare-short.wav
              [/sound]
              [print]
                text= _ "Player $side_number found blue potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE_OP blue_potion_store_$side_number add 1}
              {VARIABLE_OP potions_total_store_$side_number add 1}
              {VARIABLE blue_potion_{X}_{Y} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SURVIVALX_CHEST_BLUE_MOVE_POTION_DROP X Y ID
  [item]
    x,y={X},{Y}
    image=items/potion-blue.png
  [/item]

  [event]
    name=side turn
    first_time_only=no
    [if]
      [variable]
        name=blue_potion_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [item]
          x,y={X},{Y}
          image=items/potion-blue.png
        [/item]
      [/then]
    [/if]
  [/event]

  [event]
    name=moveto
    first_time_only=no
    [filter]
      x,y={X},{Y}
      side=1,2,3,4,5
      canrecruit=yes
    [/filter]
    [if]
      [variable]
        name=blue_potion_{X}|_{Y}|_{ID}
        numerical_not_equals=1
      [/variable]
      [then]
        [message]
          image=items/potion-blue.png
          speaker=narrator
          message= _ "You found a strange blue potion. Drinking it will give you 5 additional
movement points resets attack status so you can attack again and will grant
you as well 150 Hitpoints, even beyond maximum. Best use it while you have
low HP left and after you attacked first else the extra attack will be wasted.
You can carry maximum of 3 potions of different types and 2 potions of same
type at a time. Currently you are carrying:
~<0,0,255>Blue potions: $blue_potion_store_$side_number
~<255,0,0>Red potions: $red_potion_store_$side_number
~<255,255,0>Yellow potions: $yellow_potion_store_$side_number
Total number: $potions_total_store_$side_number

For using one of blue potions, that you are carrying, right-click on your
hero and then select 'Drink Blue Potion'."
          [option]
            message= _ "I'll leave it for another player"
            [command]
            [/command]
          [/option]
          [option]
            message= _ "Take and use blue potion"
            [command]
              [removeitem]
              [/removeitem]
              [print]
                text= _ "Player $side_number found and used blue potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              [sound]
                name=heal.wav
              [/sound]
              [object]
                [effect]
                  apply_to=hitpoints
                  increase=150
                  violate_maximum=yes
                [/effect]
                silent=yes
              [/object]
              [store_unit]
                [filter]
                  x=$x1
                  y=$y1
                [/filter]
                variable=drinker
              [/store_unit]
              {VARIABLE drinker_movement_side $drinker.side}
              {VARIABLE_OP drinker.moves add 5}
              {VARIABLE drinker.attacks_left 1}
              [unstore_unit]
                variable=drinker
              [/unstore_unit]
              {CLEAR_VARIABLE drinker}
              {VARIABLE blue_potion_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
          [option]
            message= _ "Take blue potion for later use"
            [show_if]
              [not]
                [variable]
                  name=potions_total_store_$side_number
                  numerical_equals=3
                [/variable]
              [/not]
              [not]
                [variable]
                  name=blue_potion_store_$side_number
                  numerical_equals=2
                [/variable]
              [/not]
            [/show_if]
            [command]
              [removeitem]
              [/removeitem]
              [sound]
                name=fanfare-short.wav
              [/sound]
              [print]
                text= _ "Player $side_number found blue potion."
                size=18
                duration=500
                red,green,blue=255,255,0
              [/print]
              {VARIABLE_OP blue_potion_store_$side_number add 1}
              {VARIABLE_OP potions_total_store_$side_number add 1}
              {VARIABLE blue_potion_{X}|_{Y}|_{ID} 1}
            [/command]
          [/option]
        [/message]
      [/then]
    [/if]
  [/event]
#enddef

#define SX_DRINK_BLUE_POTION
  [set_menu_item]
    id=SXC_Blue_Potion
    description="Drink Blue Potion (+5MP/enable attack, +150HP)"
    image=icons/potion-blue_icon.png
    [show_if]
      [variable]
        name=blue_potion_store_$side_number
        greater_than_equal_to=1
      [/variable]
      [have_unit]
        side=$side_number
        x,y=$x1,$y1
        canrecruit=yes
      [/have_unit]
    [/show_if]
    [command]
      {VARIABLE_OP blue_potion_store_$side_number add -1}
      {VARIABLE_OP potions_total_store_$side_number add -1}
      [sound]
        name=heal.wav
      [/sound]
      [print]
        text= _ "Player $side_number used blue potion."
        size=18
        duration=500
        red,green,blue=255,255,0
      [/print]
      [object]
        [effect]
          apply_to=hitpoints
          increase=150
          violate_maximum=yes
        [/effect]
        silent=yes
      [/object]
      [store_unit]
        [filter]
          x=$x1
          y=$y1
        [/filter]
        variable=drinker
      [/store_unit]
      {VARIABLE drinker_movement_side $drinker.side}
      {VARIABLE_OP drinker.moves add 5}
      {VARIABLE drinker.attacks_left 1}
      [unstore_unit]
        variable=drinker
      [/unstore_unit]
      {CLEAR_VARIABLE drinker}
    [/command]
  [/set_menu_item]
#enddef

#--------------------------------------------------------------
# This macro places an enemy unit called 'Boss' and allows you
# to alter it's stats. It moves around as usual.
# Must be used inside an event-tag.
# Usage: X Y are the coordinates where the guard should appear.
#        TYPE is the type of unit you want the enemy to be.
#        SIDE is the side the unit should belong to.
#        MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
# #define SURVIVALX_ENEMY_ITEM X Y TYPE ITEM SIDE MP HP MA MD RA RD RES
#   {VARIABLE_OP event_index add 1}
#   {VARIABLE item_id $event_index}
#   [message]
#     speaker=narrator
#     message="item_id = $item_id"
#   [/message]
#   {SURVIVALX_ENEMY_ITEM_ID {X} {Y} {TYPE} $item_id {ITEM} {SIDE} {MP} {HP} {MA} {MD} {RA} {RD} {RES}}
# #enddef
#define SURVIVALX_ENEMY_ITEM X Y TYPE ID ITEM SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    description=Boss_{ID}
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]

  [event]
    name=die
    [filter]
      description=Boss_{ID}
    [/filter]
    {VARIABLE itemx_Boss_{ID} $x1}
    {VARIABLE itemy_Boss_{ID} $y1}
    {{ITEM}_DROP $itemx_Boss_{ID} $itemy_Boss_{ID} {ID}}
  [/event]
#enddef

#define SURVIVALX_ENEMY_GOLD X Y TYPE ID AMOUNT SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    description=Boss_{ID}
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]

  [event]
    name=die
    [filter]
      description=Boss_{ID}
    [/filter]
    {VARIABLE itemx_Boss_{ID} $x1}
    {VARIABLE itemy_Boss_{ID} $y1}
    {SURVIVALX_CHEST_DEATH_GOLD $itemx_Boss_{ID} $itemy_Boss_{ID} {AMOUNT} "B{ID}"}
  [/event]
#enddef

#--------------------------------------------------------------
# This macro places an enemy unit called 'Boss' and allows you
# to alter it's stats. It moves around as usual and is undead.
# Must be used inside an (event)-tag.
# Usage: X Y are the coordinates where the guard should appear.
#        TYPE is the type of unit you want the enemy to be.
#        SIDE is the side the unit should belong to.
#        MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_UNDEAD_ITEM X Y TYPE ID ITEM SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    description=Boss_{ID}
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]

  [event]
    name=die
    [filter]
      description=Boss_{ID}
    [/filter]
    {VARIABLE itemx_Boss_{ID} $x1}
    {VARIABLE itemy_Boss_{ID} $y1}
    {{ITEM}_DROP $itemx_Boss_{ID} $itemy_Boss_{ID} {ID}}
  [/event]
#enddef

#define SURVIVALX_ENEMY_UNDEAD_GOLD X Y TYPE ID AMOUNT SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    description=Boss_{ID}
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]

  [event]
    name=die
    [filter]
      description=Boss_{ID}
    [/filter]
    {VARIABLE itemx_Boss_{ID} $x1}
    {VARIABLE itemy_Boss_{ID} $y1}
    {SURVIVALX_CHEST_DEATH_GOLD $itemx_Boss_{ID} $itemy_Boss_{ID} {AMOUNT} "B{ID}"}
  [/event]
#enddef

# --------------------------------------------------------------
# These two macro define extra weapons only used for the creep
# macro below. They should not be used regularly.
# --------------------------------------------------------------
#define SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER DAM SRK
  [effect]
    apply_to=new_attack
    name= _ "Enchanted Dagger"
    icon=attacks/dagger-human.png
    type=arcane
    range=melee
    damage={DAM}
    number={SRK}
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Enchanted Dagger"
      [/attack_filter]
      hits=no
      [frame]
        begin=-150
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=100
        sound={SOUND_LIST:MISS},{SOUND_LIST:HOLY_MISS}
      [/frame]
      [frame]
        begin=100
        end=150
      [/frame]
    [/attack_anim]
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Enchanted Dagger"
      [/attack_filter]
      hits=yes
      [frame]
        begin=-150
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=100
        sound=dagger-swish.wav,{SOUND_LIST:HOLY}
      [/frame]
      [frame]
        begin=100
        end=150
      [/frame]
    [/attack_anim]
  [/effect]
#enddef

#define SURVIVALX_ENEMY_WEAPON_FLAMING_DART DAM SRK
  [effect]
    apply_to=new_attack
    name= _ "Flaming Dart"
    icon=attacks/torch.png
    type=fire
    range=ranged
    damage={DAM}
    number={SRK}
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Flaming Dart"
      [/attack_filter]
      hits=no
      [missile_frame]
        begin=-150
        end=0
        image="projectiles/missile-fire-n.png"
        image_diagonal="projectiles/missile-fire-ne.png"
      [/missile_frame]
      [frame]
        begin=-400
        end=-350
        sound={SOUND_LIST:MISS}
      [/frame]
      [frame]
        begin=-350
        end=-300
      [/frame]
      [frame]
        begin=-300
        end=-250
      [/frame]
      [frame]
        begin=-250
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=-50
      [/frame]
      [frame]
        begin=-50
        end=100
      [/frame]
    [/attack_anim]
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Flaming Dart"
      [/attack_filter]
      hits=yes
      [missile_frame]
        begin=-150
        end=0
        image="projectiles/missile-fire-n.png"
        image_diagonal="projectiles/missile-fire-ne.png"
      [/missile_frame]
      [frame]
        begin=-400
        end=-350
        sound=dart.ogg
      [/frame]
      [frame]
        begin=-350
        end=-300
      [/frame]
      [frame]
        begin=-300
        end=-250
      [/frame]
      [frame]
        begin=-250
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=-50
      [/frame]
      [frame]
        begin=-50
        end=100
      [/frame]
    [/attack_anim]
  [/effect]
#enddef

#--------------------------------------------------------------
# This event makes the enemy recruits progressively becoming
# tougher. This is a major element of SurvivalXtreme, and
# should be present at each of it's maps.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_UPGRADE
  [event]
    name=recruit
    first_time_only=no
    [store_unit]
      [filter]
        x=$x1
        y=$y1
      [/filter]
      variable=creep
    [/store_unit]
    {VARIABLE new_trait_i $creep.modifications.trait.length}
    {VARIABLE_OP new_trait format "creep.modifications.trait[$new_trait_i].id"}
    {VARIABLE $new_trait loyal}
    {VARIABLE_OP new_trait format "creep.modifications.trait[$new_trait_i].name"}
    {VARIABLE_OP $new_trait format ( _ "loyal")}
    {VARIABLE_OP new_trait format "creep.modifications.trait[$new_trait_i].female_name"}
    {VARIABLE_OP $new_trait format ( _ "female^loyal")}
    {VARIABLE_OP new_trait format "creep.modifications.trait[$new_trait_i].description"}
    {VARIABLE_OP $new_trait format ( _ "Zero upkeep")}
    {VARIABLE_OP new_trait format "creep.modifications.trait[$new_trait_i].effect[0].apply_to"}
    {VARIABLE $new_trait loyal}
    [unstore_unit]
      variable=creep
    [/unstore_unit]
    {CLEAR_VARIABLE new_trait_i}
    {CLEAR_VARIABLE new_trait}
    {CLEAR_VARIABLE creep}
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=160
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ARCANE 15 3}
          {SURVIVALX_ENEMY_WEAPON_FIRE 15 3}
          [effect]
            apply_to=movement
            increase=50%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=3000%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=950%
            increase_attacks=150%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=950%
            increase_attacks=150%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-40
              pierce=-40
              impact=-40
              fire=-40
              cold=-40
              arcane=-40
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=140
      [/variable]
      [variable]
        name=brutal
        less_than=160
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 12 3}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 12 3}
          [effect]
            apply_to=movement
            increase=50%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=2500%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=750%
            increase_attacks=150%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=750%
            increase_attacks=150%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-40
              pierce=-40
              impact=-40
              fire=-40
              cold=-40
              arcane=-40
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=120
      [/variable]
      [variable]
        name=brutal
        less_than=140
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 10 3}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 10 3}
          [effect]
            apply_to=movement
            increase=45%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=2000%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=550%
            increase_attacks=150%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=550%
            increase_attacks=150%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-40
              pierce=-40
              impact=-40
              fire=-40
              cold=-40
              arcane=-40
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=100
      [/variable]
      [variable]
        name=brutal
        less_than=120
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 15 2}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 15 2}
          [effect]
            apply_to=movement
            increase=40%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=1750%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=450%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=450%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-30
              pierce=-30
              impact=-30
              fire=-30
              cold=-30
              arcane=-30
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=90
      [/variable]
      [variable]
        name=brutal
        less_than=100
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 12 2}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 12 2}
          [effect]
            apply_to=movement
            increase=35%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=1300%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=300%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=300%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-30
              pierce=-30
              impact=-30
              fire=-30
              cold=-30
              arcane=-30
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=80
      [/variable]
      [variable]
        name=brutal
        less_than=90
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 10 2}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 10 2}
          [effect]
            apply_to=movement
            increase=30%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=1000%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=200%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=200%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-30
              pierce=-30
              impact=-30
              fire=-30
              cold=-30
              arcane=-30
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=70
      [/variable]
      [variable]
        name=brutal
        less_than=80
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 8 2}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 8 2}
          [effect]
            apply_to=movement
            increase=25%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=720%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=150%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=150%
            increase_attacks=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-20
              pierce=-20
              impact=-20
              fire=-20
              cold=-20
              arcane=-20
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=60
      [/variable]
      [variable]
        name=brutal
        less_than=70
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 6 2}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 6 2}
          [effect]
            apply_to=movement
            increase=20%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=530%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=150%
            increase_attacks=50%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=150%
            increase_attacks=50%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-20
              pierce=-20
              impact=-20
              fire=-20
              cold=-20
              arcane=-20
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=50
      [/variable]
      [variable]
        name=brutal
        less_than=60
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 10 1}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 10 1}
          [effect]
            apply_to=movement
            increase=15%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=350%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=75%
            increase_attacks=50%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=75%
            increase_attacks=50%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-20
              pierce=-20
              impact=-20
              fire=-20
              cold=-20
              arcane=-20
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=40
      [/variable]
      [variable]
        name=brutal
        less_than=50
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 8 1}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 8 1}
          [effect]
            apply_to=movement
            increase=10%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=240%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=100%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-10
              pierce=-10
              impact=-10
              fire=-10
              cold=-10
              arcane=-10
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=30
      [/variable]
      [variable]
        name=brutal
        less_than=40
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 6 1}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 6 1}
          [effect]
            apply_to=movement
            increase=5%
          [/effect]
          [effect]
            apply_to=hitpoints
            increase_total=130%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=70%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=70%
            duration=forever
          [/effect]
          [effect]
            apply_to=resistance
            replace=no
            [resistance]
              blade=-10
              pierce=-10
              impact=-10
              fire=-10
              cold=-10
              arcane=-10
            [/resistance]
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=20
      [/variable]
      [variable]
        name=brutal
        less_than=30
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 4 1}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 4 1}
          [effect]
            apply_to=hitpoints
            increase_total=60%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=35%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=35%
            duration=forever
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=10
      [/variable]
      [variable]
        name=brutal
        less_than=20
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
          {SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER 2 1}
          {SURVIVALX_ENEMY_WEAPON_FLAMING_DART 2 1}
          [effect]
            apply_to=hitpoints
            increase_total=30%
            heal_full=yes
          [/effect]
          [effect]
            apply_to=attack
            range=melee
            increase_damage=20%
            duration=forever
          [/effect]
          [effect]
            apply_to=attack
            range=ranged
            increase_damage=20%
            duration=forever
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=brutal
        greater_than_equal_to=0
      [/variable]
      [variable]
        name=brutal
        less_than=10
      [/variable]
      [then]
        [filter]
          x,y=$x1,$y1
          side=6,7,8,9
        [/filter]
        [object]
          silent=yes
        [/object]
      [/then]
    [/if]
  [/event]
#enddef

#--------------------------------------------------------------
# This macro places an enemy unit called 'Boss' and allows you
# to alter it's stats. It can't move.
# Must be used inside an event-tag.
# Usage: X Y are the coordinates where the guard should appear.
#        TYPE is the type of unit you want the enemy to be.
#        SIDE is the side the unit should belong to.
#        MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_GUARD X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    generate_description=yes
    ai_special=guardian
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#--------------------------------------------------------------
# This macro places an enemy unit called 'Boss' and allows you
# to alter it's stats. It moves around as usual.
# Must be used inside an event-tag.
# Usage: X Y are the coordinates where the guard should appear.
#        TYPE is the type of unit you want the enemy to be.
#        SIDE is the side the unit should belong to.
#        MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#--------------------------------------------------------------
# This macro places an enemy unit called 'Boss' and allows you
# to alter it's stats. It can't move and is undead. Must be
# used inside an (event)-tag.
# Usage: X Y are the coordinates where the guard should appear.
#        TYPE is the type of unit you want the enemy to be.
#        SIDE is the side the unit should belong to.
#        MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_UNDEAD_GUARD X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    generate_description=yes
    ai_special=guardian
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
        [effect]
          apply_to=movement_costs
          replace=yes
          [movement_costs]
            deep_water=100
            shallow_water=100
            swamp_water=100
            grassland=100
            sand=100
            forest=100
            hills=100
            mountains=100
            village=100
            castle=100
            cave=100
            tundra=100
            canyon=100
            cavewall=100
            fungus=100
          [/movement_costs]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#--------------------------------------------------------------
# This macro places an enemy unit called 'Boss' and allows you
# to alter it's stats. It moves around as usual and is undead.
# Must be used inside an (event)-tag.
# Usage: X Y are the coordinates where the guard should appear.
#        TYPE is the type of unit you want the enemy to be.
#        SIDE is the side the unit should belong to.
#        MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_UNDEAD X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    side={SIDE}
    role=boss
    {IS_HERO}
    description=Boss
    user_description=~Boss
    unrenamable=yes
    [modifications]
      {TRAIT_UNDEAD}
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#--------------------------------------------------------------
# This macro places an enemy leader and allows you to alter
# it's stats. There is no variant for undead ones, though.
# Must be used inside an event-tag.
# Usage: X Y are the coordinates where the guard should appear.
#        TYPE is the type of unit you want the enemy to be.
#        SIDE is the side the unit should belong to.
#        MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_LEADER X Y TYPE SIDE MP HP MA MD RA RD RES
  [unit]
    x={X}
    y={Y}
    type={TYPE}
    canrecruit=1
    side={SIDE}
    role=boss
    generate_description=yes
    unrenamable=yes
    [modifications]
      {TRAIT_FEARLESS}
      {TRAIT_LOYAL}
      [object]
        silent=yes
        [effect]
          apply_to=movement
          increase={MP}
        [/effect]
        [effect]
          apply_to=hitpoints
          increase={HP}
          increase_total={HP}
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_attacks={MA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage={MD}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_attacks={RA}
          duration=forever
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage={RD}
          duration=forever
        [/effect]
        [effect]
          apply_to=resistance
          replace=no
          [resistance]
            blade=-{RES}
            pierce=-{RES}
            impact=-{RES}
            fire=-{RES}
            cold=-{RES}
            arcane=-{RES}
          [/resistance]
        [/effect]
      [/object]
    [/modifications]
  [/unit]
#enddef

#--------------------------------------------------------------
# This macro modifies a starting leader's stats. To use it,
# just put it into the side tag of the side to modify.
# Usage: MP is the extra amount of MP for this unit.
#        HP is the extra amount of HP for this unit.
#        MA is the extra amount of melee strikes for this unit.
#        MD is the extra amount of melee damage for this unit.
#        RA is the extra amount of ranged strikes for this unit.
#        RD is the extra amount of ranged damage for this unit.
#        RES is the extra amount of resistance to all damage
#        types for this unit in percent.
#--------------------------------------------------------------
#define SURVIVALX_ENEMY_MODIFICATION MP HP MA MD RA RD RES
  role=boss
  [modifications]
    {TRAIT_FEARLESS}
    {TRAIT_LOYAL}
    [object]
      silent=yes
      [effect]
        apply_to=movement
        increase={MP}
      [/effect]
      [effect]
        apply_to=hitpoints
        increase={HP}
        increase_total={HP}
      [/effect]
      [effect]
        apply_to=attack
        range=melee
        increase_attacks={MA}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=melee
        increase_damage={MD}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=ranged
        increase_attacks={RA}
        duration=forever
      [/effect]
      [effect]
        apply_to=attack
        range=ranged
        increase_damage={RD}
        duration=forever
      [/effect]
      [effect]
        apply_to=resistance
        replace=no
        [resistance]
          blade=-{RES}
          pierce=-{RES}
          impact=-{RES}
          fire=-{RES}
          cold=-{RES}
          arcane=-{RES}
        [/resistance]
      [/effect]
      [effect]
        apply_to=movement_costs
        replace=yes
        [movement_costs]
          deep_water=100
          shallow_water=100
          swamp_water=100
          grassland=100
          sand=100
          forest=100
          hills=100
          mountains=100
          village=100
          castle=100
          cave=100
          tundra=100
          canyon=100
          cavewall=100
          fungus=100
        [/movement_costs]
      [/effect]
    [/object]
  [/modifications]
#enddef

#--------------------------------------------------------------
# This macro handles a player's death. It displays a death
# message and makes that player drop all of his money in form
# of a chest. It also gives all creep leaders a gold and
# strength bonus. That means, if 5 players play and 4 players
# die, the remaining player would have to fight creeps that
# have a strength like the game already took 16 turns longer.
# That means, ouch.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_DEATH_MESSAGES
  [event]
    name=die
    [filter]
      side=1
      canrecruit=1
    [/filter]
    [message]
      speaker=unit
      message= _ "Argh... I guess that was my last adventure..."
    [/message]
    [store_gold]
      side=1
      variable=gold_die_1
    [/store_gold]
    [if]
      [variable]
        name=gold_die_1
        greater_than_equal_to=1
      [/variable]
      [then]
        {VARIABLE gold_die_chest_1 $gold_die_1}
        {VARIABLE chest1_x $x1}
        {VARIABLE chest1_y $y1}
        {SURVIVALX_CHEST_DEATH_GOLD $chest1_x $chest1_y $gold_die_chest_1 1}
      [/then]
    [/if]
    [gold]
      amount=-$gold_die_1
      side=1
    [/gold]
    [gold]
      side=6
      amount=125
    [/gold]
    [gold]
      side=7
      amount=125
    [/gold]
    [gold]
      side=8
      amount=125
    [/gold]
    [gold]
      side=9
      amount=125
    [/gold]
    {VARIABLE_OP brutal add 4}
    {SURVIVALX_MODIFY_INCOME 1 -2}
  [/event]

  [event]
    name=die
    [filter]
      side=2
      canrecruit=1
    [/filter]
    [message]
      speaker=unit
      message= _ "This cannot be..."
    [/message]
    [store_gold]
      side=2
      variable=gold_die_2
    [/store_gold]
    [if]
      [variable]
        name=gold_die_2
        greater_than_equal_to=1
      [/variable]
      [then]
        {VARIABLE gold_die_chest_2 $gold_die_2}
        {VARIABLE chest2_x $x1}
        {VARIABLE chest2_y $y1}
        {SURVIVALX_CHEST_DEATH_GOLD $chest2_x $chest2_y $gold_die_chest_2 2}
      [/then]
    [/if]
    [gold]
      amount=-$gold_die_2
      side=2
    [/gold]
    [gold]
      side=6
      amount=125
    [/gold]
    [gold]
      side=7
      amount=125
    [/gold]
    [gold]
      side=8
      amount=125
    [/gold]
    [gold]
      side=9
      amount=125
    [/gold]
    {VARIABLE_OP brutal add 4}
    {SURVIVALX_MODIFY_INCOME 2 -2}
  [/event]

  [event]
    name=die
    [filter]
      side=3
      canrecruit=1
    [/filter]
    [message]
      speaker=unit
      message= _ "I'm... dying..."
    [/message]
    [store_gold]
      side=3
      variable=gold_die_3
    [/store_gold]
    [if]
      [variable]
        name=gold_die_3
        greater_than_equal_to=1
      [/variable]
      [then]
        {VARIABLE gold_die_chest_3 $gold_die_3}
        {VARIABLE chest3_x $x1}
        {VARIABLE chest3_y $y1}
        {SURVIVALX_CHEST_DEATH_GOLD $chest3_x $chest3_y $gold_die_chest_3 3}
      [/then]
    [/if]
    [gold]
      amount=-$gold_die_3
      side=3
    [/gold]
    [gold]
      side=6
      amount=125
    [/gold]
    [gold]
      side=7
      amount=125
    [/gold]
    [gold]
      side=8
      amount=125
    [/gold]
    [gold]
      side=9
      amount=125
    [/gold]
    {VARIABLE_OP brutal add 4}
    {SURVIVALX_MODIFY_INCOME 3 -2}
  [/event]

  [event]
    name=die
    [filter]
      side=4
      canrecruit=1
    [/filter]
    [message]
      speaker=unit
      message= _ "Urgh. I should never have come here..."
    [/message]
    [store_gold]
      side=4
      variable=gold_die_4
    [/store_gold]
    [if]
      [variable]
        name=gold_die_4
        greater_than_equal_to=1
      [/variable]
      [then]
        {VARIABLE gold_die_chest_4 $gold_die_4}
        {VARIABLE chest4_x $x1}
        {VARIABLE chest4_y $y1}
        {SURVIVALX_CHEST_DEATH_GOLD $chest4_x $chest4_y $gold_die_chest_4 4}
      [/then]
    [/if]
    [gold]
      amount=-$gold_die_4
      side=4
    [/gold]
    [gold]
      side=6
      amount=125
    [/gold]
    [gold]
      side=7
      amount=125
    [/gold]
    [gold]
      side=8
      amount=125
    [/gold]
    [gold]
      side=9
      amount=125
    [/gold]
    {VARIABLE_OP brutal add 4}
    {SURVIVALX_MODIFY_INCOME 4 -2}
  [/event]

  [event]
    name=die
    [filter]
      side=5
      canrecruit=1
    [/filter]
    [message]
      speaker=unit
      message= _ "Argh. I'm done for."
    [/message]
    [store_gold]
      side=5
      variable=gold_die_5
    [/store_gold]
    [if]
      [variable]
        name=gold_die_5
        greater_than_equal_to=1
      [/variable]
      [then]
        {VARIABLE gold_die_chest_5 $gold_die_5}
        {VARIABLE chest5_x $x1}
        {VARIABLE chest5_y $y1}
        {SURVIVALX_CHEST_DEATH_GOLD $chest5_x $chest5_y $gold_die_chest_5 5}
      [/then]
    [/if]
    [gold]
      amount=-$gold_die_5
      side=5
    [/gold]
    [gold]
      side=6
      amount=125
    [/gold]
    [gold]
      side=7
      amount=125
    [/gold]
    [gold]
      side=8
      amount=125
    [/gold]
    [gold]
      side=9
      amount=125
    [/gold]
    {VARIABLE_OP brutal add 4}
    {SURVIVALX_MODIFY_INCOME 5 -2}
  [/event]

  [event]
    name=side turn
    {VARIABLE current_side $side_number}
  [/event]
#enddef

#--------------------------------------------------------------
# This macro is used for the macro below only, and reduces the
# the amount of lines needed to define it.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_MUSIC FILE
  [music]
    name={FILE}
    ms_before=12000
    append=yes
  [/music]
#enddef

#--------------------------------------------------------------
# This macro defines which music is played while playing the
# scenario. It isn't really necessary for SurvivalXtreme, but
# adds a nice flare. You can merely leave this macro out if you
# want and use the default playlist instead.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_MUSIC_PLAYLIST
  {SURVIVALX_MUSIC underground.ogg}
  {SURVIVALX_MUSIC knolls.ogg}
  {SURVIVALX_MUSIC northerners.ogg}
  {SURVIVALX_MUSIC elf-land.ogg}
  {SURVIVALX_MUSIC legends_of_the_north.ogg}
  {SURVIVALX_MUSIC wanderer.ogg}
  {SURVIVALX_MUSIC loyalists.ogg}
  {SURVIVALX_MUSIC revelation.ogg}

  [event]
    name=prestart
    {SURVIVALX_MUSIC underground.ogg}
    {SURVIVALX_MUSIC northerners.ogg}
    {SURVIVALX_MUSIC knolls.ogg}
    {SURVIVALX_MUSIC elf-land.ogg}
    {SURVIVALX_MUSIC legends_of_the_north.ogg}
    {SURVIVALX_MUSIC wanderer.ogg}
    {SURVIVALX_MUSIC loyalists.ogg}
    {SURVIVALX_MUSIC revelation.ogg}
  [/event]
#enddef

#--------------------------------------------------------------
# This macro handles an enemy's death. It gives gold to all
# players depending on the dead unit's level and status and
# allows the killer to move and attack again.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_KILL
  [event]
    name=prestart
    {VARIABLE event_index 0}
    {VARIABLE luck 0}
    {VARIABLE specialevent 0}
    {VARIABLE specialtask 0}
    {VARIABLE specialtrap 0}
    {VARIABLE leader6 1}
    {VARIABLE leader7 1}
    {VARIABLE leader8 1}
    {VARIABLE leader9 1}
    {VARIABLE cornucopia 0}
    {VARIABLE killbonus_0_0 5}
    {VARIABLE killbonus_0_1 10}
    {VARIABLE killbonus_0_2 15}
    {VARIABLE killbonus_0_3 20}
    {VARIABLE killbonus_0_4 25}
    {VARIABLE killbonus_0_5 30}
    {VARIABLE killbonus_1_0 10}
    {VARIABLE killbonus_1_1 20}
    {VARIABLE killbonus_1_2 30}
    {VARIABLE killbonus_1_3 40}
    {VARIABLE killbonus_1_4 50}
    {VARIABLE killbonus_1_5 60}
    {VARIABLE killbonus_2_0 15}
    {VARIABLE killbonus_2_1 30}
    {VARIABLE killbonus_2_2 45}
    {VARIABLE killbonus_2_3 60}
    {VARIABLE killbonus_2_4 75}
    {VARIABLE killbonus_2_5 90}
  [/event]

  [event]
    name=die
    first_time_only=no
    [filter_second]
      side=1,2,3,4,5
    [/filter_second]
    [store_unit]
      variable=victim
      [filter]
        x,y=$x1,$y1
      [/filter]
    [/store_unit]
    [if]
      [variable]
        name=victim.canrecruit
        equals=1
      [/variable]
      [then]
        {VARIABLE isHero 2}
      [/then]
      [else]
        [if]
          [variable]
            name=victim.role
            equals=boss
          [/variable]
          [then]
            {VARIABLE isHero 1}
          [/then]
          [else]
            {VARIABLE isHero 0}
          [/else]
        [/if]
      [/else]
    [/if]
    [set_variable]
      name=bonus
      format=$killbonus_$isHero|_$victim.level
    [/set_variable]
    [if]
      [variable]
        name=cornucopia
        equals=1
      [/variable]
      [then]
        {VARIABLE_OP bonus multiply 1.2}
      [/then]
    [/if]
    {CLEAR_VARIABLE victim}
    [store_unit]
      [filter]
        x=$x2
        y=$y2
      [/filter]
      variable=killer
    [/store_unit]
    {VARIABLE killer_movement_side $killer.side}
    [if]
      [have_unit]
        side=1
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=1
          amount=$bonus
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=2
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=2
          amount=$bonus
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=3
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=3
          amount=$bonus
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=4
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=4
          amount=$bonus
        [/gold]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=5
        canrecruit=1
      [/have_unit]
      [then]
        [gold]
          side=5
          amount=$bonus
        [/gold]
      [/then]
    [/if]
    {VARIABLE killer.moves 4}
    {VARIABLE killer.attacks_left 1}
    [unstore_unit]
      variable=killer
      text=$bonus
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=1
        canrecruit=1
      [/filter]
      variable=killer_leader_1
    [/store_unit]
    [unstore_unit]
      variable=killer_leader_1
      text=$bonus
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=2
        canrecruit=1
      [/filter]
      variable=killer_leader_2
    [/store_unit]
    [unstore_unit]
      variable=killer_leader_2
      text=$bonus
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=3
        canrecruit=1
      [/filter]
      variable=killer_leader_3
    [/store_unit]
    [unstore_unit]
      variable=killer_leader_3
      text=$bonus
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=4
        canrecruit=1
      [/filter]
      variable=killer_leader_4
    [/store_unit]
    [unstore_unit]
      variable=killer_leader_4
      text=$bonus
      red,green,blue=255,255,0
    [/unstore_unit]
    [store_unit]
      [filter]
        side=5
        canrecruit=1
      [/filter]
      variable=killer_leader_5
    [/store_unit]
    [unstore_unit]
      variable=killer_leader_5
      text=$bonus
      red,green,blue=255,255,0
    [/unstore_unit]
    [sound]
      name=gold.ogg
    [/sound]
    {CLEAR_VARIABLE killer}
    {CLEAR_VARIABLE killer_leader_1}
    {CLEAR_VARIABLE killer_leader_2}
    {CLEAR_VARIABLE killer_leader_3}
    {CLEAR_VARIABLE killer_leader_4}
    {CLEAR_VARIABLE killer_leader_5}
  [/event]
#enddef

#--------------------------------------------------------------
# This macro allows you to introduce the players' sides. It
# doesn't have any special function, it just saves time.
# Usage: SIDE is the side you want to introduce.
#        GOLD is the basic amount of gold the side starts with.
# Note: Don't use this macro if you want the players to be able
#       to fight each other.
#--------------------------------------------------------------
#define SURVIVALX_PLAYER_SIDE SIDE GOLD
  [side]
    side={SIDE}
    team_name=1
    canrecruit=1
    controller=human
    income=-2
    village_gold=0
    fog=yes
    shroud=yes
    gold={GOLD}
    income_lock=true
    team_lock=true
    [ai]
      passive_leader=no
      ai_algorithm=default
      village_value=-34.8
      aggression=1.0
      caution=0.0
    [/ai]
    [modifications]
      [trait]
        id=upgrades
        name="upgrades"
        female_name="upgrades"
        description= _ "Upgrades"
        [effect]
          apply_to=hitpoints
          increase_total=0
        [/effect]
        [effect]
          apply_to=attack
          range=melee
          increase_damage=0
          increase_attacks=0
        [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage=0
          increase_attacks=0
        [/effect]
        [effect]
          apply_to=remove_attacks
          name=removed
        [/effect]
        [effect]
          apply_to=attack
          remove_specials=stones,plague,plague(EOM_Bloodborn),plague(bliinfec),plague(bliseed),plague(blipara),plague(ifimp),plague(hivgnat),plague(Slavsav),plague(Slave),swarm,suicide,spores,latch,curse,removed
        [/effect]
      [/trait]
    [/modifications]
  [/side]
#enddef

#--------------------------------------------------------------
# This macro changes a given terrain at any time. Must be used
# inside an event-tag.
# Usage: X Y are the location of the terrain to change.
#        LETTER is the letter of the terrain you want to use.
#--------------------------------------------------------------
#define SURVIVALX_SET_TERRAIN X Y LETTER
  [terrain]
    x="{X}"
    y="{Y}"
    letter={LETTER}
  [/terrain]
#enddef

#--------------------------------------------------------------
# This macro modifies a side's income. Should be used for
# enemy sides only. Must be used inside an event-tag.
# Usage: SIDE is the side you want to modify.
#        INCOME is the amount of income you want the side to
#        have. Note that the game adds 2 to this value.
#--------------------------------------------------------------
#define SURVIVALX_MODIFY_INCOME SIDE INCOME
  [modify_side]
    side={SIDE}
    income={INCOME}
  [/modify_side]
#enddef

#--------------------------------------------------------------
# The following macros allow the enemy leaders to recruit more
# powerful creeps. Must be used inside an event-tag.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------

#--------------------------------------------------------------
# This macro sets a given side's remaining armor upgrades to 10.
# Must be used inside an event-tag.
# Usage: SIDE is the side you want to set the upgrades of.
#--------------------------------------------------------------
#define SURVIVALX_CHECK_ARMOR_TOTAL SIDE
  [store_unit]
    [filter]
      side={SIDE}
      canrecruit=yes
      x,y=$x1,$y1
    [/filter]
    variable=leader_armor
  [/store_unit]
  [if]
    [variable]
      name=maximum_level_reached_{SIDE}
      not_equals="yes"
    [/variable]
    [then]
      {VARIABLE best_armor 70}
      {VARIABLE second_best_armor 70}
      [if]
        [variable]
          name=best_armor
          greater_than=$leader_armor.resistance.arcane
        [/variable]
        [then]
          {VARIABLE second_best_armor $best_armor}
          {VARIABLE best_armor $leader_armor.resistance.arcane}
        [/then]
      [/if]
      [if]
        [variable]
          name=best_armor
          greater_than=$leader_armor.resistance.blade
        [/variable]
        [then]
          {VARIABLE second_best_armor $best_armor}
          {VARIABLE best_armor $leader_armor.resistance.blade}
        [/then]
      [/if]
      [if]
        [variable]
          name=best_armor
          greater_than=$leader_armor.resistance.cold
        [/variable]
        [then]
          {VARIABLE second_best_armor $best_armor}
          {VARIABLE best_armor $leader_armor.resistance.cold}
        [/then]
      [/if]
      [if]
        [variable]
          name=best_armor
          greater_than=$leader_armor.resistance.fire
        [/variable]
        [then]
          {VARIABLE second_best_armor $best_armor}
          {VARIABLE best_armor $leader_armor.resistance.fire}
        [/then]
      [/if]
      [if]
        [variable]
          name=best_armor
          greater_than=$leader_armor.resistance.impact
        [/variable]
        [then]
          {VARIABLE second_best_armor $best_armor}
          {VARIABLE best_armor $leader_armor.resistance.impact}
        [/then]
      [/if]
      [if]
        [variable]
          name=best_armor
          greater_than=$leader_armor.resistance.pierce
        [/variable]
        [then]
          {VARIABLE second_best_armor $best_armor}
          {VARIABLE best_armor $leader_armor.resistance.pierce}
        [/then]
      [/if]
      {VARIABLE armor_index -10}
      {VARIABLE_OP armor_index add $best_armor}
      {VARIABLE_OP armor_index add $second_best_armor}
      [if]
        [variable]
          name=leader_armor.level
          less_than_equal_to=1
        [/variable]
        [then]
          {VARIABLE armor_limit_{SIDE} -30}
          [if]
            [variable]
              name=armor_index
              less_than=0
            [/variable]
            [then]
              {VARIABLE armor_total_{SIDE} 0}
            [/then]
            [else]
              {VARIABLE armor_total_{SIDE} $armor_index}
            [/else]
          [/if]
          [if]
            [variable]
              name=armor_index
              greater_than=20
            [/variable]
            [then]
              {VARIABLE armor_total_{SIDE} 20}
            [/then]
          [/if]
        [/then]
      [/if]
      [if]
        [variable]
          name=leader_armor.level
          numerical_equals=2
        [/variable]
        [then]
          {VARIABLE armor_limit_{SIDE} 0}
          [if]
            [variable]
              name=armor_index
              greater_than=$armor_total_{SIDE}
            [/variable]
            [then]
              {VARIABLE armor_total_{SIDE} $armor_index}
            [/then]
          [/if]
          [if]
            [variable]
              name=armor_index
              greater_than=20
            [/variable]
            [then]
              {VARIABLE armor_total_{SIDE} 40}
            [/then]
          [/if]
        [/then]
      [/if]
      [if]
        [variable]
          name=leader_armor.level
          greater_than_equal_to=3
        [/variable]
        [then]
          {VARIABLE armor_limit_{SIDE} 30}
          [if]
            [variable]
              name=armor_index
              greater_than=$armor_total_{SIDE}
            [/variable]
            [then]
              {VARIABLE armor_total_{SIDE} $armor_index}
            [/then]
          [/if]
          [if]
            [variable]
              name=armor_index
              greater_than=60
            [/variable]
            [then]
              {VARIABLE armor_total_{SIDE} 60}
            [/then]
          [/if]
        [/then]
      [/if]
      [if]
        [variable]
          name=leader_armor.advanceto
          equals=null
        [/variable]
        [or]
          [variable]
            name=leader_armor.advanceto
            contains=$leader_armor.id
          [/variable]
        [/or]
        [then]
          {VARIABLE armor_limit_{SIDE} 30}
          [if]
            [variable]
              name=armor_index
              greater_than=$armor_total_{SIDE}
            [/variable]
            [then]
              {VARIABLE armor_total_{SIDE} $armor_index}
            [/then]
          [/if]
          {VARIABLE maximum_level_reached_{SIDE} "yes"}
        [/then]
        [else]
          {VARIABLE maximum_level_reached_{SIDE} "no"}
        [/else]
      [/if]
    [/then]
  [/if]
  {CLEAR_VARIABLE best_armor}
  {CLEAR_VARIABLE second_best_armor}
  {CLEAR_VARIABLE armor_index}
  {CLEAR_VARIABLE leader_armor}
#enddef

#define SURVIVALX_UNIT_RESISTANCE_RESTORE SIDE
  [store_unit]
    [filter]
      side={SIDE}
      canrecruit=yes
    [/filter]
    variable=leader_armor
  [/store_unit]
  {VARIABLE_OP leader_armor.resistance.blade add $resistance_upgrade_blade_{SIDE}}
  {VARIABLE_OP leader_armor.resistance.pierce add $resistance_upgrade_pierce_{SIDE}}
  {VARIABLE_OP leader_armor.resistance.impact add $resistance_upgrade_impact_{SIDE}}
  {VARIABLE_OP leader_armor.resistance.fire add $resistance_upgrade_fire_{SIDE}}
  {VARIABLE_OP leader_armor.resistance.cold add $resistance_upgrade_cold_{SIDE}}
  {VARIABLE_OP leader_armor.resistance.arcane add $resistance_upgrade_arcane_{SIDE}}
  [unstore_unit]
    variable=leader_armor
  [/unstore_unit]
  {CLEAR_VARIABLE leader_armor}
#enddef

#define SURVIVALX_TERRAIN_CHECK_MOVEMENT MCVAR COST SIDE
  [if]
    [variable]
      name=mc_{MCVAR}_{SIDE}
      equals="trained"
    [/variable]
    [then]
      {VARIABLE unit_mc.movement_costs.{MCVAR} {COST}}
    [/then]
  [/if]
#enddef

#define SURVIVALX_UNIT_MOVEMENTS_RESTORE SIDE
  [store_unit]
    [filter]
      side={SIDE}
      canrecruit=yes
    [/filter]
    variable=unit_mc
  [/store_unit]
  [if]
    [variable]
      name=unit_mc.flying
      equals=yes
    [/variable]
    [then]
      {SURVIVALX_TERRAIN_CHECK_MOVEMENT "canyon" 1 {SIDE}}
    [/then]
    [else]
      {SURVIVALX_TERRAIN_CHECK_MOVEMENT "canyon" 2 {SIDE}}
    [/else]
  [/if]
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "castle" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "cave" 1 {SIDE}}
#   {SURVIVALX_TERRAIN_CHECK_MOVEMENT "cavewall"}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "deep_water" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "forest" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "fungus" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "grassland" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "hills" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "mountains" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "sand" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "shallow_water" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "swamp_water" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "tundra" 1 {SIDE}}
  {SURVIVALX_TERRAIN_CHECK_MOVEMENT "village" 1 {SIDE}}
  [unstore_unit]
    variable=unit_mc
  [/unstore_unit]
  {CLEAR_VARIABLE unit_mc}
#enddef

#define SURVIVALX_UNIT_WEAPONS_RESTORE SIDE
  [store_unit]
    [filter]
      side={SIDE}
      canrecruit=yes
    [/filter]
    variable=unit_wr
  [/store_unit]
  {VARIABLE wr_i 0}
  {VARIABLE wr_last unit_wr.attack.length}
  [while]
    [variable]
      name=wr_i
      less_than=$weapons_bought_count_{SIDE}
    [/variable]
    [do]
      {SURVIVALX_PLAYER_ADD_WEAPON unit_wr.attack $wr_i}
      {VARIABLE wr_j 0}
      [while]
        [variable]
          name=wr_j
          less_than=$weapons_sold_count_{SIDE}
        [/variable]
        [do]
          [if]
            [variable]
              name=weapon_sold_{SIDE}[$wr_j].name
              equals=$unit_wr.attack[$wr_last].name
            [/variable]
            [then]
              {VARIABLE unit_wr.attack[$wr_last].name removed}
            [/then]
          [/if]
          {VARIABLE_OP wr_j add 1}
        [/do]
      [/while]
      {VARIABLE_OP wr_i add 1}
      {VARIABLE_OP wr_last add 1}
    [/do]
  [/while]
  [unstore_unit]
    variable=unit_wr
  [/unstore_unit]
  {CLEAR_VARIABLE unit_wr}
  {CLEAR_VARIABLE wr_i}
  {CLEAR_VARIABLE wr_j}
  {CLEAR_VARIABLE wr_last}
#enddef

#define SURVIVALX_ARMORY_LIMIT SIDE
  {VARIABLE red_potion_store_{SIDE} 0}
  {VARIABLE blue_potion_store_{SIDE} 0}
  {VARIABLE yellow_potion_store_{SIDE} 0}
  {VARIABLE potions_total_store_{SIDE} 0}
  {VARIABLE ancient_shop_uses_{SIDE} 0}
  {VARIABLE resistance_upgrade_blade_{SIDE} 0}
  {VARIABLE resistance_upgrade_pierce_{SIDE} 0}
  {VARIABLE resistance_upgrade_impact_{SIDE} 0}
  {VARIABLE resistance_upgrade_fire_{SIDE} 0}
  {VARIABLE resistance_upgrade_cold_{SIDE} 0}
  {VARIABLE resistance_upgrade_arcane_{SIDE} 0}
  {VARIABLE extra_armor_bought_{SIDE} 0}
  {VARIABLE unit_defense_{SIDE} 0}
  {VARIABLE terrains_lefty_{SIDE} 4}
  {VARIABLE move_lefty_{SIDE} 20}
  {VARIABLE move_bought_shallow_{SIDE} 0}
  {VARIABLE move_bought_swamp_{SIDE} 0}
  {VARIABLE move_bought_grass_{SIDE} 0}
  {VARIABLE move_bought_sand_{SIDE} 0}
  {VARIABLE move_bought_forest_{SIDE} 0}
  {VARIABLE move_bought_hills_{SIDE} 0}
  {VARIABLE move_bought_mountain_{SIDE} 0}
  {VARIABLE move_bought_castle_{SIDE} 0}
  {VARIABLE move_bought_cave_{SIDE} 0}
  {VARIABLE move_bought_tundra_{SIDE} 0}
  {VARIABLE move_bought_fungus_{SIDE} 0}
  {VARIABLE weapons_bought_count_{SIDE} 0}

  [event]
    name=start
    {SURVIVALX_CHECK_ARMOR_TOTAL {SIDE}}
    [store_unit]
      [filter]
        side={SIDE}
        canrecruit=yes
        x,y=$x1,$y1
      [/filter]
      variable=leader_recruit
    [/store_unit]
    [disallow_recruit]
      side={SIDE}
      type=$leader_recruit.recruit
    [/disallow_recruit]
    [unstore_unit]
      variable=leader_recruit
    [/unstore_unit]
  [/event]

  [event]
    name=advance
    first_time_only=no
    [filter]
      side={SIDE}
      canrecruit=yes
      x,y=$x1,$y1
    [/filter]
    [store_unit]
      [filter]
        side={SIDE}
        canrecruit=yes
        x,y=$x1,$y1
      [/filter]
      variable=preadvance
    [/store_unit]
    {VARIABLE pre_advance $preadvance.hitpoints}
    {VARIABLE pre_id $preadvance.id}
    {CLEAR_VARIABLE preadvance}
  [/event]

  [event]
    name=post_advance
    first_time_only=no
    [filter]
      side={SIDE}
      carecruit=yes
      x,y=$x1,$y1
    [/filter]
    [store_unit]
      [filter]
        x,y=$x1,$y1
        side={SIDE}
        canrecruit=yes
      [/filter]
      variable=postadvance
    [/store_unit]
    [object]
      silent=yes
      [effect]
        apply_to=hitpoints
        heal_full=yes
        violate_maximum=yes
      [/effect]
    [/object]
    [if]
      [variable]
        name=pre_advance
        greater_than=$postadvance.hitpoints
      [/variable]
      [then]
        {VARIABLE_OP pre_advance add (-$postadvance.hitpoints)}
        [object]
          silent=yes
          [effect]
            apply_to=hitpoints
            increase=$pre_advance
            violate_maximum=yes
          [/effect]
        [/object]
      [/then]
    [/if]
    [if]
      [variable]
        name=pre_id
        not_equals=$postadvance.id
      [/variable]
      [then]
        {SURVIVALX_UNIT_DEFENSE {SIDE} $unit_defense_{SIDE}}
        {SURVIVALX_UNIT_RESISTANCE_RESTORE {SIDE}}
        {SURVIVALX_CHECK_ARMOR_TOTAL {SIDE}}
        {SURVIVALX_UNIT_MOVEMENTS_RESTORE {SIDE}}
        {SURVIVALX_UNIT_WEAPONS_RESTORE {SIDE}}
      [/then]
    [/if]
    {CLEAR_VARIABLE pre_advance}
    {CLEAR_VARIABLE pre_id}
    {CLEAR_VARIABLE postadvance}
  [/event]
#enddef

#--------------------------------------------------------------
# This macro sets an empty player slot's gold to 0, no matter
# how much it had before. Must be used inside an event-tag.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_NO_GOLD_FOR_NOBODY
  {VARIABLE arcane 0.2285714285714286}
  {VARIABLE blade 0.1163636363636364}
  {VARIABLE cold 0.1454545454545455}
  {VARIABLE fire 0.1818181818181819}
  {VARIABLE impact 0.1254901960784314}
  {VARIABLE pierce 0.1230769230769231}
  {VARIABLE melee 5}
  {VARIABLE ranged 4}
  [store_gold]
    side=1
    variable=gold_trans_1
  [/store_gold]
  [store_gold]
    side=2
    variable=gold_trans_2
  [/store_gold]
  [store_gold]
    side=3
    variable=gold_trans_3
  [/store_gold]
  [store_gold]
    side=4
    variable=gold_trans_4
  [/store_gold]
  [store_gold]
    side=5
    variable=gold_trans_5
  [/store_gold]
  [if]
    [not]
      [have_unit]
        side=1
        canrecruit=1
      [/have_unit]
    [/not]
    [then]
      [gold]
        amount=-$gold_trans_1
        side=1
      [/gold]
    [/then]
  [/if]
  [if]
    [not]
      [have_unit]
        side=2
        canrecruit=1
      [/have_unit]
    [/not]
    [then]
      [gold]
        amount=-$gold_trans_2
        side=2
      [/gold]
    [/then]
  [/if]
  [if]
    [not]
      [have_unit]
        side=3
        canrecruit=1
      [/have_unit]
    [/not]
    [then]
      [gold]
        amount=-$gold_trans_3
        side=3
      [/gold]
    [/then]
  [/if]
  [if]
    [not]
      [have_unit]
        side=4
        canrecruit=1
      [/have_unit]
    [/not]
    [then]
      [gold]
        amount=-$gold_trans_4
        side=4
      [/gold]
    [/then]
  [/if]
  [if]
    [not]
      [have_unit]
        side=5
        canrecruit=1
      [/have_unit]
    [/not]
    [then]
      [gold]
        amount=-$gold_trans_5
        side=5
      [/gold]
    [/then]
  [/if]
#enddef

#--------------------------------------------------------------
# This macro gives the players a bonus income if they manage to
# keep certain enemy leaders dead. This bonus is taken away
# again as soon as new creep leaders spawn.
# Usage: B6,B7,B8,B9 is the bonus income the players get if the
#        creep leader of the B-side is dead.
#--------------------------------------------------------------
#define SURVIVALX_INCOME_BONUS B6 B7 B8 B9
  [event]
    name=new turn
    first_time_only=no
    {VARIABLE income_bonus 0}
    [if]
      [not]
        [have_unit]
          side=6
          canrecruit=1
        [/have_unit]
      [/not]
      [then]
        {VARIABLE_OP income_bonus add "{B6}"}
      [/then]
    [/if]
    [if]
      [not]
        [have_unit]
          side=7
          canrecruit=1
        [/have_unit]
      [/not]
      [then]
        {VARIABLE_OP income_bonus add "{B7}"}
      [/then]
    [/if]
    [if]
      [not]
        [have_unit]
          side=8
          canrecruit=1
        [/have_unit]
      [/not]
      [then]
        {VARIABLE_OP income_bonus add "{B8}"}
      [/then]
    [/if]
    [if]
      [not]
        [have_unit]
          side=9
          canrecruit=1
        [/have_unit]
      [/not]
      [then]
        {VARIABLE_OP income_bonus add "{B9}"}
      [/then]
    [/if]
    [if]
      [variable]
        name=difficulty
        greater_than_equal_to=175
      [/variable]
      [then]
        {VARIABLE_OP income_bonus multiply 0.4}
      [/then]
      [else]
        [if]
          [variable]
            name=difficulty
            greater_than_equal_to=150
          [/variable]
          [then]
            {VARIABLE_OP income_bonus multiply 0.6}
          [/then]
          [else]
            [if]
              [variable]
                name=difficulty
                greater_than_equal_to=125
              [/variable]
              [then]
                {VARIABLE_OP income_bonus multiply 0.8}
              [/then]
              [else]
                [if]
                  [variable]
                    name=difficulty
                    greater_than_equal_to=100
                  [/variable]
                  [then]
                    {VARIABLE_OP income_bonus multiply 1.0}
                  [/then]
                  [else]
                    [if]
                      [variable]
                        name=difficulty
                        greater_than_equal_to=75
                      [/variable]
                      [then]
                        {VARIABLE_OP income_bonus multiply 1.2}
                      [/then]
                      [else]
                        [if]
                          [variable]
                            name=difficulty
                            greater_than_equal_to=50
                          [/variable]
                          [then]
                            {VARIABLE_OP income_bonus multiply 1.4}
                          [/then]
                        [/if]
                      [/else]
                    [/if]
                  [/else]
                [/if]
              [/else]
            [/if]
          [/else]
        [/if]
      [/else]
    [/if]
    [if]
      [have_unit]
        side=1
        canrecruit=1
      [/have_unit]
      [variable]
        name=income_bonus
        greater_than_equal_to=1
      [/variable]
      [then]
        [gold]
          side=1
          amount=$income_bonus
        [/gold]
        [store_unit]
          [filter]
            side=1
            canrecruit=1
          [/filter]
          variable=income_leader_1
        [/store_unit]
        [unstore_unit]
          variable=income_leader_1
          text=$income_bonus
          red,green,blue=255,255,0
        [/unstore_unit]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=2
        canrecruit=1
      [/have_unit]
      [variable]
        name=income_bonus
        greater_than_equal_to=1
      [/variable]
      [then]
        [gold]
          side=2
          amount=$income_bonus
        [/gold]
        [store_unit]
          [filter]
            side=2
            canrecruit=1
          [/filter]
          variable=income_leader_2
        [/store_unit]
        [unstore_unit]
          variable=income_leader_2
          text=$income_bonus
          red,green,blue=255,255,0
        [/unstore_unit]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=3
        canrecruit=1
      [/have_unit]
      [variable]
        name=income_bonus
        greater_than_equal_to=1
      [/variable]
      [then]
        [gold]
          side=3
          amount=$income_bonus
        [/gold]
        [store_unit]
          [filter]
            side=3
            canrecruit=1
          [/filter]
          variable=income_leader_3
        [/store_unit]
        [unstore_unit]
          variable=income_leader_3
          text=$income_bonus
          red,green,blue=255,255,0
        [/unstore_unit]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=4
        canrecruit=1
      [/have_unit]
      [variable]
        name=income_bonus
        greater_than_equal_to=1
      [/variable]
      [then]
        [gold]
          side=4
          amount=$income_bonus
        [/gold]
        [store_unit]
          [filter]
            side=4
            canrecruit=1
          [/filter]
          variable=income_leader_4
        [/store_unit]
        [unstore_unit]
          variable=income_leader_4
          text=$income_bonus
          red,green,blue=255,255,0
        [/unstore_unit]
      [/then]
    [/if]
    [if]
      [have_unit]
        side=5
        canrecruit=1
      [/have_unit]
      [variable]
        name=income_bonus
        greater_than_equal_to=1
      [/variable]
      [then]
        [gold]
          side=5
          amount=$income_bonus
        [/gold]
        [store_unit]
          [filter]
            side=5
            canrecruit=1
          [/filter]
          variable=income_leader_5
        [/store_unit]
        [unstore_unit]
          variable=income_leader_5
          text=$income_bonus
          red,green,blue=255,255,0
        [/unstore_unit]
      [/then]
    [/if]
    {CLEAR_VARIABLE income_bonus}
    {CLEAR_VARIABLE income_leader_1}
    {CLEAR_VARIABLE income_leader_2}
    {CLEAR_VARIABLE income_leader_3}
    {CLEAR_VARIABLE income_leader_4}
    {CLEAR_VARIABLE income_leader_5}
  [/event]
#enddef

#define SURVIVALX_ENEMY_WEAPON_ENCHANTED_DAGGER DAM SRK
  [effect]
    apply_to=new_attack
    name= _ "Enchanted Dagger"
    icon=attacks/dagger-human.png
    type=arcane
    range=melee
    damage={DAM}
    number={SRK}
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Enchanted Dagger"
      [/attack_filter]
      hits=no
      [frame]
        begin=-150
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=100
        sound={SOUND_LIST:MISS},{SOUND_LIST:HOLY_MISS}
      [/frame]
      [frame]
        begin=100
        end=150
      [/frame]
    [/attack_anim]
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Enchanted Dagger"
      [/attack_filter]
      hits=yes
      [frame]
        begin=-150
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=100
        sound=dagger-swish.wav,{SOUND_LIST:HOLY}
      [/frame]
      [frame]
        begin=100
        end=150
      [/frame]
    [/attack_anim]
  [/effect]
#enddef

#define SURVIVALX_ENEMY_WEAPON_FLAMING_DART DAM SRK
  [effect]
    apply_to=new_attack
    name= _ "Flaming Dart"
    icon=attacks/torch.png
    type=fire
    range=ranged
    damage={DAM}
    number={SRK}
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Flaming Dart"
      [/attack_filter]
      hits=no
      [missile_frame]
        begin=-150
        end=0
        image="projectiles/missile-fire-n.png"
        image_diagonal="projectiles/missile-fire-ne.png"
      [/missile_frame]
      [frame]
        begin=-400
        end=-350
        sound={SOUND_LIST:MISS}
      [/frame]
      [frame]
        begin=-350
        end=-300
      [/frame]
      [frame]
        begin=-300
        end=-250
      [/frame]
      [frame]
        begin=-250
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=-50
      [/frame]
      [frame]
        begin=-50
        end=100
      [/frame]
    [/attack_anim]
  [/effect]
  [effect]
    apply_to=new_animation
    [attack_anim]
      [attack_filter]
        name=_ "Flaming Dart"
      [/attack_filter]
      hits=yes
      [missile_frame]
        begin=-150
        end=0
        image="projectiles/missile-fire-n.png"
        image_diagonal="projectiles/missile-fire-ne.png"
      [/missile_frame]
      [frame]
        begin=-400
        end=-350
        sound=dart.ogg
      [/frame]
      [frame]
        begin=-350
        end=-300
      [/frame]
      [frame]
        begin=-300
        end=-250
      [/frame]
      [frame]
        begin=-250
        end=-100
      [/frame]
      [frame]
        begin=-100
        end=-50
      [/frame]
      [frame]
        begin=-50
        end=100
      [/frame]
    [/attack_anim]
  [/effect]
#enddef

#--------------------------------------------------------------
# This is just a little hack for me so I don't have to change
# around all version numbers in all scenarios whenever it goes
# up. Can only be used in a message (or something that shows
# a text). I doubt it will have any further use for you, dear
# reader.
# Usage: Just use it! You don't have to give any further
#        information for this to work.
#--------------------------------------------------------------
#define SURVIVALX_VERSION
SXCollection 0.0.24
#enddef